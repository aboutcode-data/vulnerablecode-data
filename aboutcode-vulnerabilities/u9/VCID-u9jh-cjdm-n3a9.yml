vulnerability_id: VCID-u9jh-cjdm-n3a9
aliases:
  - GHSA-hq75-xg7r-rx6c
summary: "Better Call routing bug can lead to Cache Deception\n### Summary\n\nUsing a CDN that\
  \ caches (`/**/*.png`, `/**/*.json`, `/**/*.css`, etc...) requests, a cache deception can\
  \ emerge. This could lead to unauthorized access to user sessions and personal data when cached\
  \ responses are served to other users.\n\n### Details\n\nThe vulnerability occurs in the request\
  \ processing logic where path sanitization is insufficient. The library splits the path using\
  \ `config.basePath` but doesn't properly validate the remaining path components. This allows\
  \ specially crafted requests that appear to be static assets (like `/api/auth/get-session/api/auth/image.png`\
  \ assuming `config.basePath`=`/api/auth`) to bypass typical CDN cache exclusion rules while\
  \ actually returning sensitive data.\n\nThe problematic code [here](https://github.com/Bekacru/better-call/blob/8b6f13e24fad7f4666a582601517bb3232d4f4af/src/router.ts#L124):\n\
  ```js\n\tconst processRequest = async (request: Request) => {\n\t\tconst url = new URL(request.url);\n\
  \t\tconst path = config?.basePath ? url.pathname.split(config.basePath)[1] : url.pathname;\n\
  ```\n\nSince this library is largely coupled with `better-auth`, it becomes more clear why\
  \ this can be dangerous with an example request:\n\n<img width=\"800\" alt=\"image\" src=\"\
  https://github.com/user-attachments/assets/2ab7c4dd-0700-4f59-863f-79f2b5edbb37\" />\n\n###\
  \ Impact\n\nThis is a cache deception vulnerability affecting `better-call` users with CDN\
  \ caching enabled. which can expose sensitive data."
severities:
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-hq75-xg7r-rx6c
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Bekacru/better-call
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Bekacru/better-call/commit/7c7d31b
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/Bekacru/better-call/security/advisories/GHSA-hq75-xg7r-rx6c
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Bekacru/better-call/security/advisories/GHSA-hq75-xg7r-rx6c
weaknesses:
  - CWE-1035
  - CWE-937
  - CWE-525
references:
  - url: https://github.com/Bekacru/better-call
    reference_type:
    reference_id:
  - url: https://github.com/Bekacru/better-call/commit/7c7d31b
    reference_type:
    reference_id:
  - url: https://github.com/Bekacru/better-call/security/advisories/GHSA-hq75-xg7r-rx6c
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-hq75-xg7r-rx6c
    reference_type:
    reference_id: GHSA-hq75-xg7r-rx6c
