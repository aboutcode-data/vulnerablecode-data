vulnerability_id: VCID-6jyk-cteb-d3hz
aliases:
  - CVE-2025-38468
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net/sched: Return NULL when htb_lookup_leaf encounters an empty rbtree

  htb_lookup_leaf has a BUG_ON that can trigger with the following:

  tc qdisc del dev lo root
  tc qdisc add dev lo root handle 1: htb default 1
  tc class add dev lo parent 1: classid 1:1 htb rate 64bit
  tc qdisc add dev lo parent 1:1 handle 2: netem
  tc qdisc add dev lo parent 2:1 handle 3: blackhole
  ping -I lo -c1 -W0.001 127.0.0.1

  The root cause is the following:

  1. htb_dequeue calls htb_dequeue_tree which calls the dequeue handler on
     the selected leaf qdisc
  2. netem_dequeue calls enqueue on the child qdisc
  3. blackhole_enqueue drops the packet and returns a value that is not
     just NET_XMIT_SUCCESS
  4. Because of this, netem_dequeue calls qdisc_tree_reduce_backlog, and
     since qlen is now 0, it calls htb_qlen_notify -> htb_deactivate ->
     htb_deactiviate_prios -> htb_remove_class_from_row -> htb_safe_rb_erase
  5. As this is the only class in the selected hprio rbtree,
     __rb_change_child in __rb_erase_augmented sets the rb_root pointer to
     NULL
  6. Because blackhole_dequeue returns NULL, netem_dequeue returns NULL,
     which causes htb_dequeue_tree to call htb_lookup_leaf with the same
     hprio rbtree, and fail the BUG_ON

  The function graph for this scenario is shown here:
   0)               |  htb_enqueue() {
   0) + 13.635 us   |    netem_enqueue();
   0)   4.719 us    |    htb_activate_prios();
   0) # 2249.199 us |  }
   0)               |  htb_dequeue() {
   0)   2.355 us    |    htb_lookup_leaf();
   0)               |    netem_dequeue() {
   0) + 11.061 us   |      blackhole_enqueue();
   0)               |      qdisc_tree_reduce_backlog() {
   0)               |        qdisc_lookup_rcu() {
   0)   1.873 us    |          qdisc_match_from_root();
   0)   6.292 us    |        }
   0)   1.894 us    |        htb_search();
   0)               |        htb_qlen_notify() {
   0)   2.655 us    |          htb_deactivate_prios();
   0)   6.933 us    |        }
   0) + 25.227 us   |      }
   0)   1.983 us    |      blackhole_dequeue();
   0) + 86.553 us   |    }
   0) # 2932.761 us |    qdisc_warn_nonwc();
   0)               |    htb_lookup_leaf() {
   0)               |      BUG_ON();
   ------------------------------------------

  The full original bug report can be seen here [1].

  We can fix this just by returning NULL instead of the BUG_ON,
  as htb_dequeue_tree returns NULL when htb_lookup_leaf returns
  NULL.

  [1] https://lore.kernel.org/netdev/pF5XOOIim0IuEfhI-SOxTgRvNoDwuux7UHKnE_Y5-zVd4wmGvNk2ceHjKb8ORnzw0cGwfmVu42g9dL7XyJLf1NEzaztboTWcm0Ogxuojoeo=@willsroot.io/
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-38468.json
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03845'
    published_at: '2026-01-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03847'
    published_at: '2026-01-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04594'
    published_at: '2025-08-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04539'
    published_at: '2025-08-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04528'
    published_at: '2025-08-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04559'
    published_at: '2025-08-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04529'
    published_at: '2025-08-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.0449'
    published_at: '2025-08-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.0452'
    published_at: '2025-08-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08906'
    published_at: '2025-09-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09076'
    published_at: '2025-09-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09057'
    published_at: '2025-09-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.0906'
    published_at: '2025-09-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.0921'
    published_at: '2025-10-01 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.092'
    published_at: '2025-10-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09255'
    published_at: '2025-10-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08575'
    published_at: '2025-09-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08595'
    published_at: '2025-09-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08587'
    published_at: '2025-09-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08678'
    published_at: '2025-09-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08661'
    published_at: '2025-09-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08751'
    published_at: '2025-09-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08812'
    published_at: '2025-09-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08865'
    published_at: '2025-09-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08816'
    published_at: '2025-09-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08928'
    published_at: '2025-09-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10242'
    published_at: '2025-10-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10287'
    published_at: '2025-10-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10284'
    published_at: '2025-10-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.1032'
    published_at: '2025-10-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10333'
    published_at: '2025-11-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.1031'
    published_at: '2025-10-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10276'
    published_at: '2025-10-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10233'
    published_at: '2025-10-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10204'
    published_at: '2025-10-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10282'
    published_at: '2025-10-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10231'
    published_at: '2025-10-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10228'
    published_at: '2025-10-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10222'
    published_at: '2025-10-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10211'
    published_at: '2025-10-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10281'
    published_at: '2025-11-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10271'
    published_at: '2025-10-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-754
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-38468.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2025-38468
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-38468
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/0e1d5d9b5c5966e2e42e298670808590db5ed628
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3691f84269a23f7edd263e9b6edbc27b7ae332f4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7ff2d83ecf2619060f30ecf9fad4f2a700fca344
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/890a5d423ef0a7bd13447ceaffad21189f557301
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e5c480dc62a3025b8428d4818e722da30ad6804f
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2383913
    reference_type:
    reference_id: 2383913
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38468
    reference_type:
    reference_id: CVE-2025-38468
  - url: https://access.redhat.com/errata/RHSA-2025:20095
    reference_type:
    reference_id: RHSA-2025:20095
  - url: https://usn.ubuntu.com/7879-1/
    reference_type:
    reference_id: USN-7879-1
  - url: https://usn.ubuntu.com/7879-2/
    reference_type:
    reference_id: USN-7879-2
  - url: https://usn.ubuntu.com/7879-3/
    reference_type:
    reference_id: USN-7879-3
  - url: https://usn.ubuntu.com/7879-4/
    reference_type:
    reference_id: USN-7879-4
  - url: https://usn.ubuntu.com/7880-1/
    reference_type:
    reference_id: USN-7880-1
  - url: https://usn.ubuntu.com/7909-1/
    reference_type:
    reference_id: USN-7909-1
  - url: https://usn.ubuntu.com/7909-2/
    reference_type:
    reference_id: USN-7909-2
  - url: https://usn.ubuntu.com/7909-3/
    reference_type:
    reference_id: USN-7909-3
  - url: https://usn.ubuntu.com/7909-4/
    reference_type:
    reference_id: USN-7909-4
  - url: https://usn.ubuntu.com/7909-5/
    reference_type:
    reference_id: USN-7909-5
  - url: https://usn.ubuntu.com/7910-1/
    reference_type:
    reference_id: USN-7910-1
  - url: https://usn.ubuntu.com/7910-2/
    reference_type:
    reference_id: USN-7910-2
  - url: https://usn.ubuntu.com/7933-1/
    reference_type:
    reference_id: USN-7933-1
  - url: https://usn.ubuntu.com/7934-1/
    reference_type:
    reference_id: USN-7934-1
  - url: https://usn.ubuntu.com/7938-1/
    reference_type:
    reference_id: USN-7938-1
