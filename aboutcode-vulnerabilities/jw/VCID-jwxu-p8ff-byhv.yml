vulnerability_id: VCID-jwxu-p8ff-byhv
aliases:
  - CVE-2024-50226
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  cxl/port: Fix use-after-free, permit out-of-order decoder shutdown

  In support of investigating an initialization failure report [1],
  cxl_test was updated to register mock memory-devices after the mock
  root-port/bus device had been registered. That led to cxl_test crashing
  with a use-after-free bug with the following signature:

      cxl_port_attach_region: cxl region3: cxl_host_bridge.0:port3 decoder3.0 add: mem0:decoder7.0 @ 0 next: cxl_switch_uport.0 nr_eps: 1 nr_targets: 1
      cxl_port_attach_region: cxl region3: cxl_host_bridge.0:port3 decoder3.0 add: mem4:decoder14.0 @ 1 next: cxl_switch_uport.0 nr_eps: 2 nr_targets: 1
      cxl_port_setup_targets: cxl region3: cxl_switch_uport.0:port6 target[0] = cxl_switch_dport.0 for mem0:decoder7.0 @ 0
  1)  cxl_port_setup_targets: cxl region3: cxl_switch_uport.0:port6 target[1] = cxl_switch_dport.4 for mem4:decoder14.0 @ 1
      [..]
      cxld_unregister: cxl decoder14.0:
      cxl_region_decode_reset: cxl_region region3:
      mock_decoder_reset: cxl_port port3: decoder3.0 reset
  2)  mock_decoder_reset: cxl_port port3: decoder3.0: out of order reset, expected decoder3.1
      cxl_endpoint_decoder_release: cxl decoder14.0:
      [..]
      cxld_unregister: cxl decoder7.0:
  3)  cxl_region_decode_reset: cxl_region region3:
      Oops: general protection fault, probably for non-canonical address 0x6b6b6b6b6b6b6bc3: 0000 [#1] PREEMPT SMP PTI
      [..]
      RIP: 0010:to_cxl_port+0x8/0x60 [cxl_core]
      [..]
      Call Trace:
       <TASK>
       cxl_region_decode_reset+0x69/0x190 [cxl_core]
       cxl_region_detach+0xe8/0x210 [cxl_core]
       cxl_decoder_kill_region+0x27/0x40 [cxl_core]
       cxld_unregister+0x5d/0x60 [cxl_core]

  At 1) a region has been established with 2 endpoint decoders (7.0 and
  14.0). Those endpoints share a common switch-decoder in the topology
  (3.0). At teardown, 2), decoder14.0 is the first to be removed and hits
  the "out of order reset case" in the switch decoder. The effect though
  is that region3 cleanup is aborted leaving it in-tact and
  referencing decoder14.0. At 3) the second attempt to teardown region3
  trips over the stale decoder14.0 object which has long since been
  deleted.

  The fix here is to recognize that the CXL specification places no
  mandate on in-order shutdown of switch-decoders, the driver enforces
  in-order allocation, and hardware enforces in-order commit. So, rather
  than fail and leave objects dangling, always remove them.

  In support of making cxl_region_decode_reset() always succeed,
  cxl_region_invalidate_memregion() failures are turned into warnings.
  Crashing the kernel is ok there since system integrity is at risk if
  caches cannot be managed around physical address mutation events like
  CXL region destruction.

  A new device_for_each_child_reverse_from() is added to cleanup
  port->commit_end after all dependent decoders have been disabled. In
  other words if decoders are allocated 0->1->2 and disabled 1->2->0 then
  port->commit_end only decrements from 2 after 2 has been disabled, and
  it decrements all the way to zero since 1 was disabled previously.
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-50226.json
  - score: '6.7'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-50226.json
  - score: '0.00023'
    scoring_system: epss
    scoring_elements: '0.04605'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00023'
    scoring_system: epss
    scoring_elements: '0.04573'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00023'
    scoring_system: epss
    scoring_elements: '0.04541'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00023'
    scoring_system: epss
    scoring_elements: '0.04586'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08562'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08394'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08398'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08461'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08406'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08323'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08408'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08477'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08522'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08412'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.08266'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.08246'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.08403'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.08424'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.08393'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.08423'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.08425'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.08426'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.05904'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04987'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05124'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05115'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05119'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05108'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05105'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05100'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05091'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05073'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05065'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05058'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04956'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05078'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09915'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.0986'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09938'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09969'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09995'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09974'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09961'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/101c268bd2f37e965a5468353e62d154db38838e
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:T/P:M/B:A/M:M/D:T/2024-12-11T14:28:17Z/
    published_at: None
    url: https://git.kernel.org/stable/c/101c268bd2f37e965a5468353e62d154db38838e
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/78c8454fdce0eeee962be004eb6d99860c80dad1
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:T/P:M/B:A/M:M/D:T/2024-12-11T14:28:17Z/
    published_at: None
    url: https://git.kernel.org/stable/c/78c8454fdce0eeee962be004eb6d99860c80dad1
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/8e1b52c15c81106456437f8e49575040e489e355
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:T/P:M/B:A/M:M/D:T/2024-12-11T14:28:17Z/
    published_at: None
    url: https://git.kernel.org/stable/c/8e1b52c15c81106456437f8e49575040e489e355
  - score: '7.8'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-50226
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-50226
weaknesses:
  - CWE-416
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-50226.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-50226
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/101c268bd2f37e965a5468353e62d154db38838e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/78c8454fdce0eeee962be004eb6d99860c80dad1
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8e1b52c15c81106456437f8e49575040e489e355
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2324876
    reference_type:
    reference_id: 2324876
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-50226
    reference_type:
    reference_id: CVE-2024-50226
  - url: https://access.redhat.com/errata/RHSA-2024:10274
    reference_type:
    reference_id: RHSA-2024:10274
  - url: https://usn.ubuntu.com/7276-1/
    reference_type:
    reference_id: USN-7276-1
  - url: https://usn.ubuntu.com/7277-1/
    reference_type:
    reference_id: USN-7277-1
  - url: https://usn.ubuntu.com/7310-1/
    reference_type:
    reference_id: USN-7310-1
  - url: https://usn.ubuntu.com/7449-1/
    reference_type:
    reference_id: USN-7449-1
  - url: https://usn.ubuntu.com/7449-2/
    reference_type:
    reference_id: USN-7449-2
  - url: https://usn.ubuntu.com/7450-1/
    reference_type:
    reference_id: USN-7450-1
  - url: https://usn.ubuntu.com/7451-1/
    reference_type:
    reference_id: USN-7451-1
  - url: https://usn.ubuntu.com/7452-1/
    reference_type:
    reference_id: USN-7452-1
  - url: https://usn.ubuntu.com/7453-1/
    reference_type:
    reference_id: USN-7453-1
  - url: https://usn.ubuntu.com/7468-1/
    reference_type:
    reference_id: USN-7468-1
