vulnerability_id: VCID-ep1q-98pb-aaac
aliases:
  - CVE-2024-42240
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  x86/bhi: Avoid warning in #DB handler due to BHI mitigation

  When BHI mitigation is enabled, if SYSENTER is invoked with the TF flag set
  then entry_SYSENTER_compat() uses CLEAR_BRANCH_HISTORY and calls the
  clear_bhb_loop() before the TF flag is cleared. This causes the #DB handler
  (exc_debug_kernel()) to issue a warning because single-step is used outside the
  entry_SYSENTER_compat() function.

  To address this issue, entry_SYSENTER_compat() should use CLEAR_BRANCH_HISTORY
  after making sure the TF flag is cleared.

  The problem can be reproduced with the following sequence:

    $ cat sysenter_step.c
    int main()
    { asm("pushf; pop %ax; bts $8,%ax; push %ax; popf; sysenter"); }

    $ gcc -o sysenter_step sysenter_step.c

    $ ./sysenter_step
    Segmentation fault (core dumped)

  The program is expected to crash, and the #DB handler will issue a warning.

  Kernel log:

    WARNING: CPU: 27 PID: 7000 at arch/x86/kernel/traps.c:1009 exc_debug_kernel+0xd2/0x160
    ...
    RIP: 0010:exc_debug_kernel+0xd2/0x160
    ...
    Call Trace:
    <#DB>
     ? show_regs+0x68/0x80
     ? __warn+0x8c/0x140
     ? exc_debug_kernel+0xd2/0x160
     ? report_bug+0x175/0x1a0
     ? handle_bug+0x44/0x90
     ? exc_invalid_op+0x1c/0x70
     ? asm_exc_invalid_op+0x1f/0x30
     ? exc_debug_kernel+0xd2/0x160
     exc_debug+0x43/0x50
     asm_exc_debug+0x1e/0x40
    RIP: 0010:clear_bhb_loop+0x0/0xb0
    ...
    </#DB>
    <TASK>
     ? entry_SYSENTER_compat_after_hwframe+0x6e/0x8d
    </TASK>

    [ bp: Massage commit message. ]
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-42240.json
  - score: '0.00033'
    scoring_system: epss
    scoring_elements: '0.08126'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00033'
    scoring_system: epss
    scoring_elements: '0.0817'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00033'
    scoring_system: epss
    scoring_elements: '0.08246'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00033'
    scoring_system: epss
    scoring_elements: '0.08262'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00033'
    scoring_system: epss
    scoring_elements: '0.08197'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00033'
    scoring_system: epss
    scoring_elements: '0.08083'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00033'
    scoring_system: epss
    scoring_elements: '0.08036'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00033'
    scoring_system: epss
    scoring_elements: '0.08104'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08805'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.0887'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08874'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08883'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08878'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08885'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05065'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05128'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05124'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05115'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05119'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05108'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05105'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05100'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05091'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05073'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05058'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04956'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04987'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05078'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18894'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18879'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18837'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18871'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18863'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18847'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18828'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18674'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18715'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18858'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.1884'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.18825'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00072'
    scoring_system: epss
    scoring_elements: '0.19161'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00072'
    scoring_system: epss
    scoring_elements: '0.19129'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00072'
    scoring_system: epss
    scoring_elements: '0.19186'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '0.00299'
    scoring_system: epss
    scoring_elements: '0.36916'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-42240
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-42240
weaknesses:
  - CWE-99
  - CWE-835
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-42240.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-42240
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-42240
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/08518d48e5b744620524f0acd7c26c19bda7f513
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a765679defe1dc1b8fa01928a6ad6361e72a1364
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ac8b270b61d48fcc61f052097777e3b5e11591e0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/dae3543db8f0cf8ac1a198c3bb4b6e3c24d576cf
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/db56615e96c439e13783d7715330e824b4fd4b84
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2303508
    reference_type:
    reference_id: 2303508
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-42240
    reference_type:
    reference_id: CVE-2024-42240
  - url: https://access.redhat.com/errata/RHSA-2024:10771
    reference_type:
    reference_id: RHSA-2024:10771
  - url: https://access.redhat.com/errata/RHSA-2024:10772
    reference_type:
    reference_id: RHSA-2024:10772
  - url: https://access.redhat.com/errata/RHSA-2024:10773
    reference_type:
    reference_id: RHSA-2024:10773
  - url: https://access.redhat.com/errata/RHSA-2024:7000
    reference_type:
    reference_id: RHSA-2024:7000
  - url: https://access.redhat.com/errata/RHSA-2024:7001
    reference_type:
    reference_id: RHSA-2024:7001
  - url: https://access.redhat.com/errata/RHSA-2024:9315
    reference_type:
    reference_id: RHSA-2024:9315
  - url: https://usn.ubuntu.com/7007-1/
    reference_type:
    reference_id: USN-7007-1
  - url: https://usn.ubuntu.com/7007-2/
    reference_type:
    reference_id: USN-7007-2
  - url: https://usn.ubuntu.com/7007-3/
    reference_type:
    reference_id: USN-7007-3
  - url: https://usn.ubuntu.com/7009-1/
    reference_type:
    reference_id: USN-7009-1
  - url: https://usn.ubuntu.com/7009-2/
    reference_type:
    reference_id: USN-7009-2
  - url: https://usn.ubuntu.com/7019-1/
    reference_type:
    reference_id: USN-7019-1
  - url: https://usn.ubuntu.com/7089-1/
    reference_type:
    reference_id: USN-7089-1
  - url: https://usn.ubuntu.com/7089-2/
    reference_type:
    reference_id: USN-7089-2
  - url: https://usn.ubuntu.com/7089-3/
    reference_type:
    reference_id: USN-7089-3
  - url: https://usn.ubuntu.com/7089-4/
    reference_type:
    reference_id: USN-7089-4
  - url: https://usn.ubuntu.com/7089-5/
    reference_type:
    reference_id: USN-7089-5
  - url: https://usn.ubuntu.com/7089-6/
    reference_type:
    reference_id: USN-7089-6
  - url: https://usn.ubuntu.com/7089-7/
    reference_type:
    reference_id: USN-7089-7
  - url: https://usn.ubuntu.com/7090-1/
    reference_type:
    reference_id: USN-7090-1
  - url: https://usn.ubuntu.com/7095-1/
    reference_type:
    reference_id: USN-7095-1
  - url: https://usn.ubuntu.com/7121-1/
    reference_type:
    reference_id: USN-7121-1
  - url: https://usn.ubuntu.com/7121-2/
    reference_type:
    reference_id: USN-7121-2
  - url: https://usn.ubuntu.com/7121-3/
    reference_type:
    reference_id: USN-7121-3
  - url: https://usn.ubuntu.com/7148-1/
    reference_type:
    reference_id: USN-7148-1
  - url: https://usn.ubuntu.com/7156-1/
    reference_type:
    reference_id: USN-7156-1
  - url: https://usn.ubuntu.com/7159-1/
    reference_type:
    reference_id: USN-7159-1
  - url: https://usn.ubuntu.com/7159-2/
    reference_type:
    reference_id: USN-7159-2
  - url: https://usn.ubuntu.com/7159-3/
    reference_type:
    reference_id: USN-7159-3
  - url: https://usn.ubuntu.com/7159-4/
    reference_type:
    reference_id: USN-7159-4
  - url: https://usn.ubuntu.com/7159-5/
    reference_type:
    reference_id: USN-7159-5
  - url: https://usn.ubuntu.com/7195-1/
    reference_type:
    reference_id: USN-7195-1
  - url: https://usn.ubuntu.com/7195-2/
    reference_type:
    reference_id: USN-7195-2
