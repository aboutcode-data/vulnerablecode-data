vulnerability_id: VCID-7knw-6ubv-aaad
aliases:
  - GHSA-q669-2vfg-cxcg
summary: |
  Nervos CKB Unaligned Pointer Dereference
  via bounty@nervos.org

  There are multiple type conversions in ckb that unsafely cast between byte pointers and other types of pointers. This results in unaligned pointers, which are not allowed by the Rust language, and are considered undefined behavior, meaning that the compiler is free to do anything with code. This can lead to unpredictable bugs that can become security vulnerabilities.

  Some of the bugs here could potentially lead to buffer overreads in malformed data (it's not clear to me as I haven't investigated the practical impact of these bugs).

  Two of these (in blockchain.rs) do not create unaligned data. They do though perform an unsafe operation that may not uphold the invariants of the safe function they are in, and could lead to undefined behavior and buffer overreads on malformed input.

  These are of the same nature as those in my previous report about the molecule crate.

  Patch attached for commit 1b09e37c8e1b7945495cd18d9782417fbe51e986 that fixes all cases I know of at this time.

  Please consider this report for reward under the terms of the bug bounty program.

  Related advisory: https://github.com/nervosnetwork/molecule/security/advisories/GHSA-rffv-8x7x-p7pw
severities:
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-q669-2vfg-cxcg
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/nervosnetwork/ckb/commit/adf8f0d08bc058383a0df658ea2c2ef6e7950335
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/nervosnetwork/ckb/security/advisories/GHSA-q669-2vfg-cxcg
weaknesses: []
references:
  - url: https://github.com/nervosnetwork/ckb/commit/adf8f0d08bc058383a0df658ea2c2ef6e7950335
    reference_type:
    reference_id:
  - url: https://github.com/nervosnetwork/ckb/security/advisories/GHSA-q669-2vfg-cxcg
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-q669-2vfg-cxcg
    reference_type:
    reference_id: GHSA-q669-2vfg-cxcg
