vulnerability_id: VCID-4g6j-1de4-aaas
aliases:
  - CVE-2021-47497
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  nvmem: Fix shift-out-of-bound (UBSAN) with byte size cells

  If a cell has 'nbits' equal to a multiple of BITS_PER_BYTE the logic

   *p &= GENMASK((cell->nbits%BITS_PER_BYTE) - 1, 0);

  will become undefined behavior because nbits modulo BITS_PER_BYTE is 0, and we
  subtract one from that making a large number that is then shifted more than the
  number of bits that fit into an unsigned long.

  UBSAN reports this problem:

   UBSAN: shift-out-of-bounds in drivers/nvmem/core.c:1386:8
   shift exponent 64 is too large for 64-bit type 'unsigned long'
   CPU: 6 PID: 7 Comm: kworker/u16:0 Not tainted 5.15.0-rc3+ #9
   Hardware name: Google Lazor (rev3+) with KB Backlight (DT)
   Workqueue: events_unbound deferred_probe_work_func
   Call trace:
    dump_backtrace+0x0/0x170
    show_stack+0x24/0x30
    dump_stack_lvl+0x64/0x7c
    dump_stack+0x18/0x38
    ubsan_epilogue+0x10/0x54
    __ubsan_handle_shift_out_of_bounds+0x180/0x194
    __nvmem_cell_read+0x1ec/0x21c
    nvmem_cell_read+0x58/0x94
    nvmem_cell_read_variable_common+0x4c/0xb0
    nvmem_cell_read_variable_le_u32+0x40/0x100
    a6xx_gpu_init+0x170/0x2f4
    adreno_bind+0x174/0x284
    component_bind_all+0xf0/0x264
    msm_drm_bind+0x1d8/0x7a0
    try_to_bring_up_master+0x164/0x1ac
    __component_add+0xbc/0x13c
    component_add+0x20/0x2c
    dp_display_probe+0x340/0x384
    platform_probe+0xc0/0x100
    really_probe+0x110/0x304
    __driver_probe_device+0xb8/0x120
    driver_probe_device+0x4c/0xfc
    __device_attach_driver+0xb0/0x128
    bus_for_each_drv+0x90/0xdc
    __device_attach+0xc8/0x174
    device_initial_probe+0x20/0x2c
    bus_probe_device+0x40/0xa4
    deferred_probe_work_func+0x7c/0xb8
    process_one_work+0x128/0x21c
    process_scheduled_works+0x40/0x54
    worker_thread+0x1ec/0x2a8
    kthread+0x138/0x158
    ret_from_fork+0x10/0x20

  Fix it by making sure there are any bits to mask out.
severities:
  - score: '4.4'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47497.json
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14083'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14371'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14461'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14482'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14548'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14541'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14556'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14611'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14691'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14976'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.15033'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.15128'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14714'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14726'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.15080'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14767'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35655'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31135'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35708'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35678'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31096'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31239'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31254'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31245'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31273'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31233'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31212'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31249'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31276'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.3128'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.31236'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35603'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35666'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35735'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35778'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35784'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35692'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35689'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35694'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35697'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00143'
    scoring_system: epss
    scoring_elements: '0.35716'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0.00602'
    scoring_system: epss
    scoring_elements: '0.53027'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
  - score: '0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:N
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-125
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47497.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-47497
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47497
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/0594f1d048d8dc338eb9a240021b1d00ae1eb082
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/0e822e5413da1af28cca350cb1cb42b6133bdcae
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2df6c023050205c4d04ffc121bc549f65cb8d1df
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/57e48886401b14cd351423fabfec2cfd18df4f66
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5d388fa01fa6eb310ac023a363a6cb216d9d8fe9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/60df06bbdf497e37ed25ad40572c362e5b0998df
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/abcb8d33e4d2215ccde5ab5ccf9f730a59d79d97
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/eb0fc8e7170e61eaf65d28dee4a8baf4e86b19ca
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2282918
    reference_type:
    reference_id: 2282918
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47497
    reference_type:
    reference_id: CVE-2021-47497
  - url: https://access.redhat.com/errata/RHSA-2024:7000
    reference_type:
    reference_id: RHSA-2024:7000
  - url: https://access.redhat.com/errata/RHSA-2024:7001
    reference_type:
    reference_id: RHSA-2024:7001
  - url: https://access.redhat.com/errata/RHSA-2024:9315
    reference_type:
    reference_id: RHSA-2024:9315
  - url: https://access.redhat.com/errata/RHSA-2025:2490
    reference_type:
    reference_id: RHSA-2025:2490
