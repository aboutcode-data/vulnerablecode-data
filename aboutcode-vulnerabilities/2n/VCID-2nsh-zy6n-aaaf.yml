vulnerability_id: VCID-2nsh-zy6n-aaaf
aliases:
  - CVE-2021-47192
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  scsi: core: sysfs: Fix hang when device state is set via sysfs

  This fixes a regression added with:

  commit f0f82e2476f6 ("scsi: core: Fix capacity set to zero after
  offlinining device")

  The problem is that after iSCSI recovery, iscsid will call into the kernel
  to set the dev's state to running, and with that patch we now call
  scsi_rescan_device() with the state_mutex held. If the SCSI error handler
  thread is just starting to test the device in scsi_send_eh_cmnd() then it's
  going to try to grab the state_mutex.

  We are then stuck, because when scsi_rescan_device() tries to send its I/O
  scsi_queue_rq() calls -> scsi_host_queue_ready() -> scsi_host_in_recovery()
  which will return true (the host state is still in recovery) and I/O will
  just be requeued. scsi_send_eh_cmnd() will then never be able to grab the
  state_mutex to finish error handling.

  To prevent the deadlock move the rescan-related code to after we drop the
  state_mutex.

  This also adds a check for if we are already in the running state. This
  prevents extra scans and helps the iscsid case where if the transport class
  has already onlined the device during its recovery process then we don't
  need userspace to do it again plus possibly block that daemon.
severities:
  - score: '4.4'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47192.json
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16666'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16947'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17624'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17338'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17315'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17350'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17830'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17732'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17041'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17069'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17147'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17142'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51624'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51714'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51718'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51639'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51648'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51658'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51669'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.5167'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51693'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51679'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51656'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.492'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49183'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49295'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49297'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49319'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49329'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49302'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49277'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49313'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49332'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49342'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49331'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.4931'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.49292'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51587'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51634'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00286'
    scoring_system: epss
    scoring_elements: '0.51692'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '0.00894'
    scoring_system: epss
    scoring_elements: '0.61183'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://git.kernel.org/stable/c/4edd8cd4e86dd3047e5294bbefcc0a08f66a430f
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-04-10T19:44:37Z/
    published_at: None
    url: https://git.kernel.org/stable/c/4edd8cd4e86dd3047e5294bbefcc0a08f66a430f
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://git.kernel.org/stable/c/a792e0128d232251edb5fdf42fb0f9fbb0b44a73
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-04-10T19:44:37Z/
    published_at: None
    url: https://git.kernel.org/stable/c/a792e0128d232251edb5fdf42fb0f9fbb0b44a73
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://git.kernel.org/stable/c/bcc0e3175a976b7fa9a353960808adb0bb49ead8
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-04-10T19:44:37Z/
    published_at: None
    url: https://git.kernel.org/stable/c/bcc0e3175a976b7fa9a353960808adb0bb49ead8
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://git.kernel.org/stable/c/edd783162bf2385b43de6764f2d4c6e9f4f6be27
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-04-10T19:44:37Z/
    published_at: None
    url: https://git.kernel.org/stable/c/edd783162bf2385b43de6764f2d4c6e9f4f6be27
weaknesses:
  - CWE-833
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47192.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-47192
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47192
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4edd8cd4e86dd3047e5294bbefcc0a08f66a430f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a792e0128d232251edb5fdf42fb0f9fbb0b44a73
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/bcc0e3175a976b7fa9a353960808adb0bb49ead8
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/edd783162bf2385b43de6764f2d4c6e9f4f6be27
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2274617
    reference_type:
    reference_id: 2274617
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47192
    reference_type:
    reference_id: CVE-2021-47192
