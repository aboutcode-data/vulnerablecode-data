vulnerability_id: VCID-8tw5-kdbb-jyha
aliases:
  - CVE-2025-38503
summary: 'In the Linux kernel, the following vulnerability has been resolved:  btrfs: fix assertion
  when building free space tree  When building the free space tree with the block group tree
  feature enabled, we can hit an assertion failure like this:    BTRFS info (device loop0 state
  M): rebuilding free space tree   assertion failed: ret == 0, in fs/btrfs/free-space-tree.c:1102   ------------[
  cut here ]------------   kernel BUG at fs/btrfs/free-space-tree.c:1102!   Internal error:
  Oops - BUG: 00000000f2000800 [#1]  SMP   Modules linked in:   CPU: 1 UID: 0 PID: 6592 Comm:
  syz-executor322 Not tainted 6.15.0-rc7-syzkaller-gd7fa1af5b33e #0 PREEMPT   Hardware name:
  Google Google Compute Engine/Google Compute Engine, BIOS Google 05/07/2025   pstate: 60400005
  (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)   pc : populate_free_space_tree+0x514/0x518
  fs/btrfs/free-space-tree.c:1102   lr : populate_free_space_tree+0x514/0x518 fs/btrfs/free-space-tree.c:1102   sp
  : ffff8000a4ce7600   x29: ffff8000a4ce76e0 x28: ffff0000c9bc6000 x27: ffff0000ddfff3d8   x26:
  ffff0000ddfff378 x25: dfff800000000000 x24: 0000000000000001   x23: ffff8000a4ce7660 x22:
  ffff70001499cecc x21: ffff0000e1d8c160   x20: ffff0000e1cb7800 x19: ffff0000e1d8c0b0 x18:
  00000000ffffffff   x17: ffff800092f39000 x16: ffff80008ad27e48 x15: ffff700011e740c0   x14:
  1ffff00011e740c0 x13: 0000000000000004 x12: ffffffffffffffff   x11: ffff700011e740c0 x10:
  0000000000ff0100 x9 : 94ef24f55d2dbc00   x8 : 94ef24f55d2dbc00 x7 : 0000000000000001 x6 :
  0000000000000001   x5 : ffff8000a4ce6f98 x4 : ffff80008f415ba0 x3 : ffff800080548ef0   x2
  : 0000000000000000 x1 : 0000000100000000 x0 : 000000000000003e   Call trace:    populate_free_space_tree+0x514/0x518
  fs/btrfs/free-space-tree.c:1102 (P)    btrfs_rebuild_free_space_tree+0x14c/0x54c fs/btrfs/free-space-tree.c:1337    btrfs_start_pre_rw_mount+0xa78/0xe10
  fs/btrfs/disk-io.c:3074    btrfs_remount_rw fs/btrfs/super.c:1319 [inline]    btrfs_reconfigure+0x828/0x2418
  fs/btrfs/super.c:1543    reconfigure_super+0x1d4/0x6f0 fs/super.c:1083    do_remount fs/namespace.c:3365
  [inline]    path_mount+0xb34/0xde0 fs/namespace.c:4200    do_mount fs/namespace.c:4221 [inline]    __do_sys_mount
  fs/namespace.c:4432 [inline]    __se_sys_mount fs/namespace.c:4409 [inline]    __arm64_sys_mount+0x3e8/0x468
  fs/namespace.c:4409    __invoke_syscall arch/arm64/kernel/syscall.c:35 [inline]    invoke_syscall+0x98/0x2b8
  arch/arm64/kernel/syscall.c:49    el0_svc_common+0x130/0x23c arch/arm64/kernel/syscall.c:132    do_el0_svc+0x48/0x58
  arch/arm64/kernel/syscall.c:151    el0_svc+0x58/0x17c arch/arm64/kernel/entry-common.c:767    el0t_64_sync_handler+0x78/0x108
  arch/arm64/kernel/entry-common.c:786    el0t_64_sync+0x198/0x19c arch/arm64/kernel/entry.S:600   Code:
  f0047182 91178042 528089c3 9771d47b (d4210000)   ---[ end trace 0000000000000000 ]---  This
  happens because we are processing an empty block group, which has no extents allocated from
  it, there are no items for this block group, including the block group item since block group
  items are stored in a dedicated tree when using the block group tree feature. It also means
  this is the block group with the highest start offset, so there are no higher keys in the
  extent root, hence btrfs_search_slot_for_read() returns 1 (no higher key found).  Fix this
  by asserting ''ret'' is 0 only if the block group tree feature is not enabled, in which case
  we should find a block group item for the block group since it''s stored in the extent root
  and block group item keys are greater than extent item keys (the value for BTRFS_BLOCK_GROUP_ITEM_KEY
  is 192 and for BTRFS_EXTENT_ITEM_KEY and BTRFS_METADATA_ITEM_KEY the values are 168 and 169
  respectively). In case ''ret'' is 1, we just need to add a record to the free space tree which
  spans the whole block group, and we can achieve this by making ''ret == 0'' as the while loop''s
  condition.'
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-38503.json
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04594'
    published_at: '2025-08-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04723'
    published_at: '2025-09-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04692'
    published_at: '2025-09-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04698'
    published_at: '2025-09-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04689'
    published_at: '2025-09-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04665'
    published_at: '2025-09-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04559'
    published_at: '2025-08-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04528'
    published_at: '2025-08-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05726'
    published_at: '2025-10-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05774'
    published_at: '2025-10-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05714'
    published_at: '2025-10-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05691'
    published_at: '2025-10-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05723'
    published_at: '2025-10-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05769'
    published_at: '2025-10-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05786'
    published_at: '2025-10-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.058'
    published_at: '2025-10-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05787'
    published_at: '2025-10-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05763'
    published_at: '2025-10-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05733'
    published_at: '2025-10-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.0575'
    published_at: '2025-10-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05564'
    published_at: '2025-09-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05579'
    published_at: '2025-09-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05619'
    published_at: '2025-09-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05521'
    published_at: '2025-09-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05515'
    published_at: '2025-09-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05484'
    published_at: '2025-09-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05578'
    published_at: '2025-09-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05738'
    published_at: '2025-10-01 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00027'
    scoring_system: epss
    scoring_elements: '0.06246'
    published_at: '2025-11-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00027'
    scoring_system: epss
    scoring_elements: '0.06183'
    published_at: '2025-10-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00027'
    scoring_system: epss
    scoring_elements: '0.06166'
    published_at: '2025-10-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00027'
    scoring_system: epss
    scoring_elements: '0.06163'
    published_at: '2025-10-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00027'
    scoring_system: epss
    scoring_elements: '0.06145'
    published_at: '2025-10-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00027'
    scoring_system: epss
    scoring_elements: '0.06144'
    published_at: '2025-10-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00027'
    scoring_system: epss
    scoring_elements: '0.06156'
    published_at: '2025-10-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00027'
    scoring_system: epss
    scoring_elements: '0.06222'
    published_at: '2025-11-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00047'
    scoring_system: epss
    scoring_elements: '0.14741'
    published_at: '2026-01-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '0.00047'
    scoring_system: epss
    scoring_elements: '0.14766'
    published_at: '2026-01-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-253
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-38503.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2025-38503
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-38503
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2391055
    reference_type:
    reference_id: 2391055
  - url: https://usn.ubuntu.com/7879-1/
    reference_type:
    reference_id: USN-7879-1
  - url: https://usn.ubuntu.com/7879-2/
    reference_type:
    reference_id: USN-7879-2
  - url: https://usn.ubuntu.com/7879-3/
    reference_type:
    reference_id: USN-7879-3
  - url: https://usn.ubuntu.com/7879-4/
    reference_type:
    reference_id: USN-7879-4
  - url: https://usn.ubuntu.com/7880-1/
    reference_type:
    reference_id: USN-7880-1
  - url: https://usn.ubuntu.com/7934-1/
    reference_type:
    reference_id: USN-7934-1
