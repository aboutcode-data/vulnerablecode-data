vulnerability_id: VCID-dx2j-parw-3qfx
aliases:
  - CVE-2023-52986
summary: 'In the Linux kernel, the following vulnerability has been resolved:  bpf, sockmap:
  Check for any of tcp_bpf_prots when cloning a listener  A listening socket linked to a sockmap
  has its sk_prot overridden. It points to one of the struct proto variants in tcp_bpf_prots.
  The variant depends on the socket''s family and which sockmap programs are attached.  A child
  socket cloned from a TCP listener initially inherits their sk_prot. But before cloning is
  finished, we restore the child''s proto to the listener''s original non-tcp_bpf_prots one.
  This happens in tcp_create_openreq_child -> tcp_bpf_clone.  Today, in tcp_bpf_clone we detect
  if the child''s proto should be restored by checking only for the TCP_BPF_BASE proto variant.
  This is not correct. The sk_prot of listening socket linked to a sockmap can point to to any
  variant in tcp_bpf_prots.  If the listeners sk_prot happens to be not the TCP_BPF_BASE variant,
  then the child socket unintentionally is left if the inherited sk_prot by tcp_bpf_clone.  This
  leads to issues like infinite recursion on close [1], because the child state is otherwise
  not set up for use with tcp_bpf_prot operations.  Adjust the check in tcp_bpf_clone to detect
  all of tcp_bpf_prots variants.  Note that it wouldn''t be sufficient to check the socket state
  when overriding the sk_prot in tcp_bpf_update_proto in order to always use the TCP_BPF_BASE
  variant for listening sockets. Since commit b8b8315e39ff ("bpf, sockmap: Remove unhash handler
  for BPF sockmap usage") it is possible for a socket to transition to TCP_LISTEN state while
  already linked to a sockmap, e.g. connect() -> insert into map -> connect(AF_UNSPEC) -> listen().  [1]:
  https://lore.kernel.org/all/00000000000073b14905ef2e7401@google.com/'
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2023-52986.json
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02167'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02077'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.0002'
    scoring_system: epss
    scoring_elements: '0.02029'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03416'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03422'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03425'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03441'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03476'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03484'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.0349'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03481'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03471'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04342'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04374'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04409'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04393'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04397'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04379'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04371'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.0433'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04328'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04336'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04337'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.0434'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04349'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03427'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03415'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.03414'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04862'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses: []
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2023-52986.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2023-52986
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-52986
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/12b0ec7c6953e1602957926439e5297095d7d065
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9bd6074e1872d22190a8da30e796cbf937d334f0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c681d7a4ed3d360de0574f4d6b7305a8de8dc54f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ddce1e091757d0259107c6c0c7262df201de2b66
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2355490
    reference_type:
    reference_id: 2355490
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-52986
    reference_type:
    reference_id: CVE-2023-52986
