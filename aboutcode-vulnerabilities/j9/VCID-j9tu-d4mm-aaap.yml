vulnerability_id: VCID-j9tu-d4mm-aaap
aliases:
  - CVE-2021-47553
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  sched/scs: Reset task stack state in bringup_cpu()

  To hot unplug a CPU, the idle task on that CPU calls a few layers of C
  code before finally leaving the kernel. When KASAN is in use, poisoned
  shadow is left around for each of the active stack frames, and when
  shadow call stacks are in use. When shadow call stacks (SCS) are in use
  the task's saved SCS SP is left pointing at an arbitrary point within
  the task's shadow call stack.

  When a CPU is offlined than onlined back into the kernel, this stale
  state can adversely affect execution. Stale KASAN shadow can alias new
  stackframes and result in bogus KASAN warnings. A stale SCS SP is
  effectively a memory leak, and prevents a portion of the shadow call
  stack being used. Across a number of hotplug cycles the idle task's
  entire shadow call stack can become unusable.

  We previously fixed the KASAN issue in commit:

    e1b77c92981a5222 ("sched/kasan: remove stale KASAN poison after hotplug")

  ... by removing any stale KASAN stack poison immediately prior to
  onlining a CPU.

  Subsequently in commit:

    f1a0a376ca0c4ef1 ("sched/core: Initialize the idle task with preemption disabled")

  ... the refactoring left the KASAN and SCS cleanup in one-time idle
  thread initialization code rather than something invoked prior to each
  CPU being onlined, breaking both as above.

  We fixed SCS (but not KASAN) in commit:

    63acd42c0d4942f7 ("sched/scs: Reset the shadow stack when idle_task_exit")

  ... but as this runs in the context of the idle task being offlined it's
  potentially fragile.

  To fix these consistently and more robustly, reset the SCS SP and KASAN
  shadow of a CPU's idle task immediately before we online that CPU in
  bringup_cpu(). This ensures the idle task always has a consistent state
  when it is running, and removes the need to so so when exiting an idle
  task.

  Whenever any thread is created, dup_task_struct() will give the task a
  stack which is free of KASAN shadow, and initialize the task's SCS SP,
  so there's no need to specially initialize either for idle thread within
  init_idle(), as this was only necessary to handle hotplug cycles.

  I've tested this on arm64 with:

  * gcc 11.1.0, defconfig +KASAN_INLINE, KASAN_STACK
  * clang 12.0.0, defconfig +KASAN_INLINE, KASAN_STACK, SHADOW_CALL_STACK

  ... offlining and onlining CPUS with:

  | while true; do
  |   for C in /sys/devices/system/cpu/cpu*/online; do
  |     echo 0 > $C;
  |     echo 1 > $C;
  |   done
  | done
severities:
  - score: '6.1'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:L
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47553.json
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16666'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16947'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17041'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17069'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17147'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17142'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17732'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17830'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17350'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17315'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17624'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17338'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19089'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15713'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19105'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19099'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.1567'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15838'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15855'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15878'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15911'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.1588'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15873'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15858'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15915'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15916'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15889'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15866'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15828'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.18901'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.18973'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19031'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19091'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19087'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.1908'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19063'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19057'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19069'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19079'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.19098'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '0.00273'
    scoring_system: epss
    scoring_elements: '0.34702'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-402
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47553.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-47553
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47553
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/229c555260cb9c1ccdab861e16f0410f1718f302
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/dce1ca0525bfdc8a69a9343bc714fbc19a2f04b3
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e6ee7abd6bfe559ad9989004b34c320fd638c526
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2283396
    reference_type:
    reference_id: 2283396
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47553
    reference_type:
    reference_id: CVE-2021-47553
