vulnerability_id: VCID-356k-6x3k-aaaj
aliases:
  - CVE-2021-46981
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  nbd: Fix NULL pointer in flush_workqueue

  Open /dev/nbdX first, the config_refs will be 1 and
  the pointers in nbd_device are still null. Disconnect
  /dev/nbdX, then reference a null recv_workq. The
  protection by config_refs in nbd_genl_disconnect is useless.

  [  656.366194] BUG: kernel NULL pointer dereference, address: 0000000000000020
  [  656.368943] #PF: supervisor write access in kernel mode
  [  656.369844] #PF: error_code(0x0002) - not-present page
  [  656.370717] PGD 10cc87067 P4D 10cc87067 PUD 1074b4067 PMD 0
  [  656.371693] Oops: 0002 [#1] SMP
  [  656.372242] CPU: 5 PID: 7977 Comm: nbd-client Not tainted 5.11.0-rc5-00040-g76c057c84d28 #1
  [  656.373661] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS ?-20190727_073836-buildvm-ppc64le-16.ppc.fedoraproject.org-3.fc31 04/01/2014
  [  656.375904] RIP: 0010:mutex_lock+0x29/0x60
  [  656.376627] Code: 00 0f 1f 44 00 00 55 48 89 fd 48 83 05 6f d7 fe 08 01 e8 7a c3 ff ff 48 83 05 6a d7 fe 08 01 31 c0 65 48 8b 14 25 00 6d 01 00 <f0> 48 0f b1 55 d
  [  656.378934] RSP: 0018:ffffc900005eb9b0 EFLAGS: 00010246
  [  656.379350] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 0000000000000000
  [  656.379915] RDX: ffff888104cf2600 RSI: ffffffffaae8f452 RDI: 0000000000000020
  [  656.380473] RBP: 0000000000000020 R08: 0000000000000000 R09: ffff88813bd6b318
  [  656.381039] R10: 00000000000000c7 R11: fefefefefefefeff R12: ffff888102710b40
  [  656.381599] R13: ffffc900005eb9e0 R14: ffffffffb2930680 R15: ffff88810770ef00
  [  656.382166] FS:  00007fdf117ebb40(0000) GS:ffff88813bd40000(0000) knlGS:0000000000000000
  [  656.382806] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
  [  656.383261] CR2: 0000000000000020 CR3: 0000000100c84000 CR4: 00000000000006e0
  [  656.383819] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
  [  656.384370] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
  [  656.384927] Call Trace:
  [  656.385111]  flush_workqueue+0x92/0x6c0
  [  656.385395]  nbd_disconnect_and_put+0x81/0xd0
  [  656.385716]  nbd_genl_disconnect+0x125/0x2a0
  [  656.386034]  genl_family_rcv_msg_doit.isra.0+0x102/0x1b0
  [  656.386422]  genl_rcv_msg+0xfc/0x2b0
  [  656.386685]  ? nbd_ioctl+0x490/0x490
  [  656.386954]  ? genl_family_rcv_msg_doit.isra.0+0x1b0/0x1b0
  [  656.387354]  netlink_rcv_skb+0x62/0x180
  [  656.387638]  genl_rcv+0x34/0x60
  [  656.387874]  netlink_unicast+0x26d/0x590
  [  656.388162]  netlink_sendmsg+0x398/0x6c0
  [  656.388451]  ? netlink_rcv_skb+0x180/0x180
  [  656.388750]  ____sys_sendmsg+0x1da/0x320
  [  656.389038]  ? ____sys_recvmsg+0x130/0x220
  [  656.389334]  ___sys_sendmsg+0x8e/0xf0
  [  656.389605]  ? ___sys_recvmsg+0xa2/0xf0
  [  656.389889]  ? handle_mm_fault+0x1671/0x21d0
  [  656.390201]  __sys_sendmsg+0x6d/0xe0
  [  656.390464]  __x64_sys_sendmsg+0x23/0x30
  [  656.390751]  do_syscall_64+0x45/0x70
  [  656.391017]  entry_SYSCALL_64_after_hwframe+0x44/0xa9

  To fix it, just add if (nbd->recv_workq) to nbd_disconnect_and_put().
severities:
  - score: '4.4'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-46981.json
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00704'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00702'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.007'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00703'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00705'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00492'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00494'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00497'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00502'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.005'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00706'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00699'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00713'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00711'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00696'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00697'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00011'
    scoring_system: epss
    scoring_elements: '0.00633'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05078'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04956'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04987'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16666'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16947'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17041'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17069'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17147'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17142'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17732'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17830'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00048'
    scoring_system: epss
    scoring_elements: '0.11973'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00048'
    scoring_system: epss
    scoring_elements: '0.11994'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00048'
    scoring_system: epss
    scoring_elements: '0.11956'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00048'
    scoring_system: epss
    scoring_elements: '0.11919'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00048'
    scoring_system: epss
    scoring_elements: '0.11914'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00048'
    scoring_system: epss
    scoring_elements: '0.11756'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00048'
    scoring_system: epss
    scoring_elements: '0.11793'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '0.00203'
    scoring_system: epss
    scoring_elements: '0.28394'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-46981
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-46981
weaknesses:
  - CWE-476
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-46981.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-46981
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-46981
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/1c4962df938891af9ab4775f5224ef8601764107
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/54b78ba7e96e5fe1edb8054e375d31a6c0dc60dc
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/79ebe9110fa458d58f1fceb078e2068d7ad37390
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b31d237796fd618379ec8e0f4de3370b5e4aeee7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cde4b55cfb24522dcbba80bbdb0c082303e76c43
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2266911
    reference_type:
    reference_id: 2266911
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-46981
    reference_type:
    reference_id: CVE-2021-46981
  - url: https://usn.ubuntu.com/6777-1/
    reference_type:
    reference_id: USN-6777-1
  - url: https://usn.ubuntu.com/6777-2/
    reference_type:
    reference_id: USN-6777-2
  - url: https://usn.ubuntu.com/6777-3/
    reference_type:
    reference_id: USN-6777-3
  - url: https://usn.ubuntu.com/6777-4/
    reference_type:
    reference_id: USN-6777-4
