vulnerability_id: VCID-qhgg-ag3c-2ke3
aliases:
  - CVE-2024-44946
summary: "In the Linux kernel, the following vulnerability has been resolved:\n\nkcm: Serialise\
  \ kcm_sendmsg() for the same socket.\n\nsyzkaller reported UAF in kcm_release(). [0]\n\nThe\
  \ scenario is\n\n  1. Thread A builds a skb with MSG_MORE and sets kcm->seq_skb.\n\n  2. Thread\
  \ A resumes building skb from kcm->seq_skb but is blocked\n     by sk_stream_wait_memory()\n\
  \n  3. Thread B calls sendmsg() concurrently, finishes building kcm->seq_skb\n     and puts\
  \ the skb to the write queue\n\n  4. Thread A faces an error and finally frees skb that is\
  \ already in the\n     write queue\n\n  5. kcm_release() does double-free the skb in the write\
  \ queue\n\nWhen a thread is building a MSG_MORE skb, another thread must not touch it.\n\n\
  Let's add a per-sk mutex and serialise kcm_sendmsg().\n\n[0]:\nBUG: KASAN: slab-use-after-free\
  \ in __skb_unlink include/linux/skbuff.h:2366 [inline]\nBUG: KASAN: slab-use-after-free in\
  \ __skb_dequeue include/linux/skbuff.h:2385 [inline]\nBUG: KASAN: slab-use-after-free in __skb_queue_purge_reason\
  \ include/linux/skbuff.h:3175 [inline]\nBUG: KASAN: slab-use-after-free in __skb_queue_purge\
  \ include/linux/skbuff.h:3181 [inline]\nBUG: KASAN: slab-use-after-free in kcm_release+0x170/0x4c8\
  \ net/kcm/kcmsock.c:1691\nRead of size 8 at addr ffff0000ced0fc80 by task syz-executor329/6167\n\
  \nCPU: 1 PID: 6167 Comm: syz-executor329 Tainted: G    B              6.8.0-rc5-syzkaller-g9abbc24128bc\
  \ #0\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/25/2024\n\
  Call trace:\n dump_backtrace+0x1b8/0x1e4 arch/arm64/kernel/stacktrace.c:291\n show_stack+0x2c/0x3c\
  \ arch/arm64/kernel/stacktrace.c:298\n __dump_stack lib/dump_stack.c:88 [inline]\n dump_stack_lvl+0xd0/0x124\
  \ lib/dump_stack.c:106\n print_address_description mm/kasan/report.c:377 [inline]\n print_report+0x178/0x518\
  \ mm/kasan/report.c:488\n kasan_report+0xd8/0x138 mm/kasan/report.c:601\n __asan_report_load8_noabort+0x20/0x2c\
  \ mm/kasan/report_generic.c:381\n __skb_unlink include/linux/skbuff.h:2366 [inline]\n __skb_dequeue\
  \ include/linux/skbuff.h:2385 [inline]\n __skb_queue_purge_reason include/linux/skbuff.h:3175\
  \ [inline]\n __skb_queue_purge include/linux/skbuff.h:3181 [inline]\n kcm_release+0x170/0x4c8\
  \ net/kcm/kcmsock.c:1691\n __sock_release net/socket.c:659 [inline]\n sock_close+0xa4/0x1e8\
  \ net/socket.c:1421\n __fput+0x30c/0x738 fs/file_table.c:376\n ____fput+0x20/0x30 fs/file_table.c:404\n\
  \ task_work_run+0x230/0x2e0 kernel/task_work.c:180\n exit_task_work include/linux/task_work.h:38\
  \ [inline]\n do_exit+0x618/0x1f64 kernel/exit.c:871\n do_group_exit+0x194/0x22c kernel/exit.c:1020\n\
  \ get_signal+0x1500/0x15ec kernel/signal.c:2893\n do_signal+0x23c/0x3b44 arch/arm64/kernel/signal.c:1249\n\
  \ do_notify_resume+0x74/0x1f4 arch/arm64/kernel/entry-common.c:148\n exit_to_user_mode_prepare\
  \ arch/arm64/kernel/entry-common.c:169 [inline]\n exit_to_user_mode arch/arm64/kernel/entry-common.c:178\
  \ [inline]\n el0_svc+0xac/0x168 arch/arm64/kernel/entry-common.c:713\n el0t_64_sync_handler+0x84/0xfc\
  \ arch/arm64/kernel/entry-common.c:730\n el0t_64_sync+0x190/0x194 arch/arm64/kernel/entry.S:598\n\
  \nAllocated by task 6166:\n kasan_save_stack mm/kasan/common.c:47 [inline]\n kasan_save_track+0x40/0x78\
  \ mm/kasan/common.c:68\n kasan_save_alloc_info+0x70/0x84 mm/kasan/generic.c:626\n unpoison_slab_object\
  \ mm/kasan/common.c:314 [inline]\n __kasan_slab_alloc+0x74/0x8c mm/kasan/common.c:340\n kasan_slab_alloc\
  \ include/linux/kasan.h:201 [inline]\n slab_post_alloc_hook mm/slub.c:3813 [inline]\n slab_alloc_node\
  \ mm/slub.c:3860 [inline]\n kmem_cache_alloc_node+0x204/0x4c0 mm/slub.c:3903\n __alloc_skb+0x19c/0x3d8\
  \ net/core/skbuff.c:641\n alloc_skb include/linux/skbuff.h:1296 [inline]\n kcm_sendmsg+0x1d3c/0x2124\
  \ net/kcm/kcmsock.c:783\n sock_sendmsg_nosec net/socket.c:730 [inline]\n __sock_sendmsg net/socket.c:745\
  \ [inline]\n sock_sendmsg+0x220/0x2c0 net/socket.c:768\n splice_to_socket+0x7cc/0xd58 fs/splice.c:889\n\
  \ do_splice_from fs/splice.c:941 [inline]\n direct_splice_actor+0xec/0x1d8 fs/splice.c:1164\n\
  \ splice_direct_to_actor+0x438/0xa0c fs/splice.c:1108\n do_splice_direct_actor \n---truncated---"
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-44946.json
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05128'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05078'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05124'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05115'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05119'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05108'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05105'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05100'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05091'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05073'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05065'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05058'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04987'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04956'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51882'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51837'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51884'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51943'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51967'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51973'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51892'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51903'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51912'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51921'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51924'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51947'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51933'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0029'
    scoring_system: epss
    scoring_elements: '0.51909'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72374'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72379'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72368'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.7236'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72358'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.7235'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72353'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72387'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72259'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72254'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.7234'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72344'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72362'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.00824'
    scoring_system: epss
    scoring_elements: '0.72375'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '0.0172'
    scoring_system: epss
    scoring_elements: '0.71027'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-44946
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-44946
weaknesses:
  - CWE-416
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-44946.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-44946
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-44946
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/00425508f30baa5ab6449a1f478480ca7cffa6da
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6633b17840bf828921254d788ccd15602843fe9b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/72da240aafb142630cf16adc803ccdacb3780849
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/807067bf014d4a3ae2cc55bd3de16f22a01eb580
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8c9cdbf600143bd6835c8b8351e5ac956da79aec
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9c8d544ed619f704e2b70e63e08ab75630c2ea23
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/eb06c8d3022ce6738711191c89f9b3e9cfb91914
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/fa6c23fe6dcac8c8bd63920ee8681292a2bd544e
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2308807
    reference_type:
    reference_id: 2308807
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-44946
    reference_type:
    reference_id: CVE-2024-44946
  - url: https://usn.ubuntu.com/7088-1/
    reference_type:
    reference_id: USN-7088-1
  - url: https://usn.ubuntu.com/7088-2/
    reference_type:
    reference_id: USN-7088-2
  - url: https://usn.ubuntu.com/7088-3/
    reference_type:
    reference_id: USN-7088-3
  - url: https://usn.ubuntu.com/7088-4/
    reference_type:
    reference_id: USN-7088-4
  - url: https://usn.ubuntu.com/7088-5/
    reference_type:
    reference_id: USN-7088-5
  - url: https://usn.ubuntu.com/7100-1/
    reference_type:
    reference_id: USN-7100-1
  - url: https://usn.ubuntu.com/7100-2/
    reference_type:
    reference_id: USN-7100-2
  - url: https://usn.ubuntu.com/7119-1/
    reference_type:
    reference_id: USN-7119-1
  - url: https://usn.ubuntu.com/7123-1/
    reference_type:
    reference_id: USN-7123-1
  - url: https://usn.ubuntu.com/7144-1/
    reference_type:
    reference_id: USN-7144-1
  - url: https://usn.ubuntu.com/7154-1/
    reference_type:
    reference_id: USN-7154-1
  - url: https://usn.ubuntu.com/7154-2/
    reference_type:
    reference_id: USN-7154-2
  - url: https://usn.ubuntu.com/7155-1/
    reference_type:
    reference_id: USN-7155-1
  - url: https://usn.ubuntu.com/7156-1/
    reference_type:
    reference_id: USN-7156-1
  - url: https://usn.ubuntu.com/7194-1/
    reference_type:
    reference_id: USN-7194-1
  - url: https://usn.ubuntu.com/7196-1/
    reference_type:
    reference_id: USN-7196-1
