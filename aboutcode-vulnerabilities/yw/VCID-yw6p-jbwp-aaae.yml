vulnerability_id: VCID-yw6p-jbwp-aaae
aliases:
  - CVE-2021-47274
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  tracing: Correct the length check which causes memory corruption

  We've suffered from severe kernel crashes due to memory corruption on
  our production environment, like,

  Call Trace:
  [1640542.554277] general protection fault: 0000 [#1] SMP PTI
  [1640542.554856] CPU: 17 PID: 26996 Comm: python Kdump: loaded Tainted:G
  [1640542.556629] RIP: 0010:kmem_cache_alloc+0x90/0x190
  [1640542.559074] RSP: 0018:ffffb16faa597df8 EFLAGS: 00010286
  [1640542.559587] RAX: 0000000000000000 RBX: 0000000000400200 RCX:
  0000000006e931bf
  [1640542.560323] RDX: 0000000006e931be RSI: 0000000000400200 RDI:
  ffff9a45ff004300
  [1640542.560996] RBP: 0000000000400200 R08: 0000000000023420 R09:
  0000000000000000
  [1640542.561670] R10: 0000000000000000 R11: 0000000000000000 R12:
  ffffffff9a20608d
  [1640542.562366] R13: ffff9a45ff004300 R14: ffff9a45ff004300 R15:
  696c662f65636976
  [1640542.563128] FS:  00007f45d7c6f740(0000) GS:ffff9a45ff840000(0000)
  knlGS:0000000000000000
  [1640542.563937] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
  [1640542.564557] CR2: 00007f45d71311a0 CR3: 000000189d63e004 CR4:
  00000000003606e0
  [1640542.565279] DR0: 0000000000000000 DR1: 0000000000000000 DR2:
  0000000000000000
  [1640542.566069] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7:
  0000000000000400
  [1640542.566742] Call Trace:
  [1640542.567009]  anon_vma_clone+0x5d/0x170
  [1640542.567417]  __split_vma+0x91/0x1a0
  [1640542.567777]  do_munmap+0x2c6/0x320
  [1640542.568128]  vm_munmap+0x54/0x70
  [1640542.569990]  __x64_sys_munmap+0x22/0x30
  [1640542.572005]  do_syscall_64+0x5b/0x1b0
  [1640542.573724]  entry_SYSCALL_64_after_hwframe+0x44/0xa9
  [1640542.575642] RIP: 0033:0x7f45d6e61e27

  James Wang has reproduced it stably on the latest 4.19 LTS.
  After some debugging, we finally proved that it's due to ftrace
  buffer out-of-bound access using a debug tool as follows:
  [   86.775200] BUG: Out-of-bounds write at addr 0xffff88aefe8b7000
  [   86.780806]  no_context+0xdf/0x3c0
  [   86.784327]  __do_page_fault+0x252/0x470
  [   86.788367]  do_page_fault+0x32/0x140
  [   86.792145]  page_fault+0x1e/0x30
  [   86.795576]  strncpy_from_unsafe+0x66/0xb0
  [   86.799789]  fetch_memory_string+0x25/0x40
  [   86.804002]  fetch_deref_string+0x51/0x60
  [   86.808134]  kprobe_trace_func+0x32d/0x3a0
  [   86.812347]  kprobe_dispatcher+0x45/0x50
  [   86.816385]  kprobe_ftrace_handler+0x90/0xf0
  [   86.820779]  ftrace_ops_assist_func+0xa1/0x140
  [   86.825340]  0xffffffffc00750bf
  [   86.828603]  do_sys_open+0x5/0x1f0
  [   86.832124]  do_syscall_64+0x5b/0x1b0
  [   86.835900]  entry_SYSCALL_64_after_hwframe+0x44/0xa9

  commit b220c049d519 ("tracing: Check length before giving out
  the filter buffer") adds length check to protect trace data
  overflow introduced in 0fc1b09ff1ff, seems that this fix can't prevent
  overflow entirely, the length check should also take the sizeof
  entry->array[0] into account, since this array[0] is filled the
  length of trace data and occupy addtional space and risk overflow.
severities:
  - score: '6.4'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47274.json
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11214'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11518'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11609'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11632'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11700'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11696'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11709'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11764'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11819'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12119'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12177'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12271'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11828'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11841'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12225'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11891'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.62907'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.62935'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.62941'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.62905'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.62903'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.62909'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.6292'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.62924'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.6144'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.61418'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.61408'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.61412'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.61433'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.61449'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.61472'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.61471'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.61468'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.6145'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.62833'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.62872'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00461'
    scoring_system: epss
    scoring_elements: '0.6291'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00623'
    scoring_system: epss
    scoring_elements: '0.67757'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00623'
    scoring_system: epss
    scoring_elements: '0.67764'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00623'
    scoring_system: epss
    scoring_elements: '0.67779'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00623'
    scoring_system: epss
    scoring_elements: '0.67654'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.00623'
    scoring_system: epss
    scoring_elements: '0.67674'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '0.01721'
    scoring_system: epss
    scoring_elements: '0.71034'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-787
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47274.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-47274
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47274
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2d598902799886d67947406f26ee8e5fd2ca097f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/31ceae385556c37e4d286cb6378696448f566883
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3e08a9f9760f4a70d633c328a76408e62d6f80a3
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/43c32c22254b9328d7abb1c2b0f689dc67838e60
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b16a249eca2230c2cd66fa1d4b94743bd9b6ef92
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d63f00ec908b3be635ead5d6029cc94246e1f38d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/edcce01e0e50840a9aa6a70baed21477bdd2c9f9
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2282525
    reference_type:
    reference_id: 2282525
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47274
    reference_type:
    reference_id: CVE-2021-47274
