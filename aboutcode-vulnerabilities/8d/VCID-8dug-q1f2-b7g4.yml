vulnerability_id: VCID-8dug-q1f2-b7g4
aliases:
  - CVE-2024-53102
summary: 'In the Linux kernel, the following vulnerability has been resolved:  nvme: make keep-alive
  synchronous operation  The nvme keep-alive operation, which executes at a periodic interval,
  could potentially sneak in while shutting down a fabric controller. This may lead to a race
  between the fabric controller admin queue destroy code path (invoked while shutting down controller)
  and hw/hctx queue dispatcher called from the nvme keep-alive async request queuing operation.
  This race could lead to the kernel crash shown below:  Call Trace:     autoremove_wake_function+0x0/0xbc
  (unreliable)     __blk_mq_sched_dispatch_requests+0x114/0x24c     blk_mq_sched_dispatch_requests+0x44/0x84     blk_mq_run_hw_queue+0x140/0x220     nvme_keep_alive_work+0xc8/0x19c
  [nvme_core]     process_one_work+0x200/0x4e0     worker_thread+0x340/0x504     kthread+0x138/0x140     start_kernel_thread+0x14/0x18  While
  shutting down fabric controller, if nvme keep-alive request sneaks in then it would be flushed
  off. The nvme_keep_alive_end_io function is then invoked to handle the end of the keep-alive
  operation which decrements the admin->q_usage_counter and assuming this is the last/only request
  in the admin queue then the admin->q_usage_counter becomes zero. If that happens then blk-mq
  destroy queue operation (blk_mq_destroy_ queue()) which could be potentially running simultaneously
  on another cpu (as this is the controller shutdown code path) would forward progress and deletes
  the admin queue. So, now from this point onward we are not supposed to access the admin queue
  resources. However the issue here''s that the nvme keep-alive thread running hw/hctx queue
  dispatch operation hasn''t yet finished its work and so it could still potentially access
  the admin queue resource while the admin queue had been already deleted and that causes the
  above crash.  This fix helps avoid the observed crash by implementing keep-alive as a synchronous
  operation so that we decrement admin->q_usage_counter only after keep-alive command finished
  its execution and returns the command status back up to its caller (blk_execute_rq()). This
  would ensure that fabric shutdown code path doesn''t destroy the fabric admin queue until
  keep-alive request finished execution and also keep-alive thread is not running hw/hctx queue
  dispatch operation.'
severities:
  - score: '4.7'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-53102.json
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.11287'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
  - score: '0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:N
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '4.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-362
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-53102.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-53102
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-53102
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/1a1bcca5c9efd2c72c8d2fcbadf2d673cceb2ea7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/afa229465399f89d3af9d72ced865144c9748846
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ccc1d82dfaad0ad27d21139da22e57add73d2a5e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d06923670b5a5f609603d4a9fee4dec02d38de9c
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2328796
    reference_type:
    reference_id: 2328796
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-53102
    reference_type:
    reference_id: CVE-2024-53102
