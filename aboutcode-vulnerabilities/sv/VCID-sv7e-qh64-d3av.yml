vulnerability_id: VCID-sv7e-qh64-d3av
aliases:
  - CVE-2025-38389
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  drm/i915/gt: Fix timeline left held on VMA alloc error

  The following error has been reported sporadically by CI when a test
  unbinds the i915 driver on a ring submission platform:

  <4> [239.330153] ------------[ cut here ]------------
  <4> [239.330166] i915 0000:00:02.0: [drm] drm_WARN_ON(dev_priv->mm.shrink_count)
  <4> [239.330196] WARNING: CPU: 1 PID: 18570 at drivers/gpu/drm/i915/i915_gem.c:1309 i915_gem_cleanup_early+0x13e/0x150 [i915]
  ...
  <4> [239.330640] RIP: 0010:i915_gem_cleanup_early+0x13e/0x150 [i915]
  ...
  <4> [239.330942] Call Trace:
  <4> [239.330944]  <TASK>
  <4> [239.330949]  i915_driver_late_release+0x2b/0xa0 [i915]
  <4> [239.331202]  i915_driver_release+0x86/0xa0 [i915]
  <4> [239.331482]  devm_drm_dev_init_release+0x61/0x90
  <4> [239.331494]  devm_action_release+0x15/0x30
  <4> [239.331504]  release_nodes+0x3d/0x120
  <4> [239.331517]  devres_release_all+0x96/0xd0
  <4> [239.331533]  device_unbind_cleanup+0x12/0x80
  <4> [239.331543]  device_release_driver_internal+0x23a/0x280
  <4> [239.331550]  ? bus_find_device+0xa5/0xe0
  <4> [239.331563]  device_driver_detach+0x14/0x20
  ...
  <4> [357.719679] ---[ end trace 0000000000000000 ]---

  If the test also unloads the i915 module then that's followed with:

  <3> [357.787478] =============================================================================
  <3> [357.788006] BUG i915_vma (Tainted: G     U  W        N ): Objects remaining on __kmem_cache_shutdown()
  <3> [357.788031] -----------------------------------------------------------------------------
  <3> [357.788204] Object 0xffff888109e7f480 @offset=29824
  <3> [357.788670] Allocated in i915_vma_instance+0xee/0xc10 [i915] age=292729 cpu=4 pid=2244
  <4> [357.788994]  i915_vma_instance+0xee/0xc10 [i915]
  <4> [357.789290]  init_status_page+0x7b/0x420 [i915]
  <4> [357.789532]  intel_engines_init+0x1d8/0x980 [i915]
  <4> [357.789772]  intel_gt_init+0x175/0x450 [i915]
  <4> [357.790014]  i915_gem_init+0x113/0x340 [i915]
  <4> [357.790281]  i915_driver_probe+0x847/0xed0 [i915]
  <4> [357.790504]  i915_pci_probe+0xe6/0x220 [i915]
  ...

  Closer analysis of CI results history has revealed a dependency of the
  error on a few IGT tests, namely:
  - igt@api_intel_allocator@fork-simple-stress-signal,
  - igt@api_intel_allocator@two-level-inception-interruptible,
  - igt@gem_linear_blits@interruptible,
  - igt@prime_mmap_coherency@ioctl-errors,
  which invisibly trigger the issue, then exhibited with first driver unbind
  attempt.

  All of the above tests perform actions which are actively interrupted with
  signals.  Further debugging has allowed to narrow that scope down to
  DRM_IOCTL_I915_GEM_EXECBUFFER2, and ring_context_alloc(), specific to ring
  submission, in particular.

  If successful then that function, or its execlists or GuC submission
  equivalent, is supposed to be called only once per GEM context engine,
  followed by raise of a flag that prevents the function from being called
  again.  The function is expected to unwind its internal errors itself, so
  it may be safely called once more after it returns an error.

  In case of ring submission, the function first gets a reference to the
  engine's legacy timeline and then allocates a VMA.  If the VMA allocation
  fails, e.g. when i915_vma_instance() called from inside is interrupted
  with a signal, then ring_context_alloc() fails, leaving the timeline held
  referenced.  On next I915_GEM_EXECBUFFER2 IOCTL, another reference to the
  timeline is got, and only that last one is put on successful completion.
  As a consequence, the legacy timeline, with its underlying engine status
  page's VMA object, is still held and not released on driver unbind.

  Get the legacy timeline only after successful allocation of the context
  engine's VMA.

  v2: Add a note on other submission methods (Krzysztof Karas):
      Both execlists and GuC submission use lrc_alloc() which seems free
      from a similar issue.

  (cherry picked from commit cc43422b3cc79eacff4c5a8ba0d224688ca9dd4f)
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-38389.json
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.04011'
    published_at: '2026-01-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.04'
    published_at: '2026-01-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07359'
    published_at: '2025-08-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07204'
    published_at: '2025-08-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.0726'
    published_at: '2025-08-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07277'
    published_at: '2025-08-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07239'
    published_at: '2025-08-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07276'
    published_at: '2025-08-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07331'
    published_at: '2025-08-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08906'
    published_at: '2025-09-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09076'
    published_at: '2025-09-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09057'
    published_at: '2025-09-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.0906'
    published_at: '2025-09-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08575'
    published_at: '2025-09-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08595'
    published_at: '2025-09-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08587'
    published_at: '2025-09-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08678'
    published_at: '2025-09-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08661'
    published_at: '2025-09-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08751'
    published_at: '2025-09-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08812'
    published_at: '2025-09-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08865'
    published_at: '2025-09-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08816'
    published_at: '2025-09-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08928'
    published_at: '2025-09-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10267'
    published_at: '2025-10-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10299'
    published_at: '2025-10-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10271'
    published_at: '2025-10-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10242'
    published_at: '2025-10-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10287'
    published_at: '2025-10-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10284'
    published_at: '2025-10-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.1032'
    published_at: '2025-10-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10333'
    published_at: '2025-11-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.1031'
    published_at: '2025-10-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10276'
    published_at: '2025-10-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10233'
    published_at: '2025-10-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10204'
    published_at: '2025-10-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10282'
    published_at: '2025-10-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10231'
    published_at: '2025-10-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10228'
    published_at: '2025-10-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10222'
    published_at: '2025-10-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10211'
    published_at: '2025-10-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10281'
    published_at: '2025-11-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10279'
    published_at: '2025-10-01 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses: []
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-38389.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2025-38389
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-38389
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/40e09506aea1fde1f3e0e04eca531bbb23404baf
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4c778c96e469fb719b11683e0a3be8ea68052fa2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5a7ae7bebdc4c2ecd48a2c061319956f65c09473
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/60b757730884e4a223152a68d9b5f625dac94119
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a5aa7bc1fca78c7fa127d9e33aa94a0c9066c1d6
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c542d62883f62ececafcb630a1c5010133826bea
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e47d7d6edc40a6ace7cc04e5893759fee68569f5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f10af34261448610d4048ac6e6af87f80e3881a4
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2383393
    reference_type:
    reference_id: 2383393
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38389
    reference_type:
    reference_id: CVE-2025-38389
  - url: https://usn.ubuntu.com/7774-1/
    reference_type:
    reference_id: USN-7774-1
  - url: https://usn.ubuntu.com/7774-2/
    reference_type:
    reference_id: USN-7774-2
  - url: https://usn.ubuntu.com/7774-3/
    reference_type:
    reference_id: USN-7774-3
  - url: https://usn.ubuntu.com/7774-4/
    reference_type:
    reference_id: USN-7774-4
  - url: https://usn.ubuntu.com/7774-5/
    reference_type:
    reference_id: USN-7774-5
  - url: https://usn.ubuntu.com/7775-1/
    reference_type:
    reference_id: USN-7775-1
  - url: https://usn.ubuntu.com/7775-2/
    reference_type:
    reference_id: USN-7775-2
  - url: https://usn.ubuntu.com/7775-3/
    reference_type:
    reference_id: USN-7775-3
  - url: https://usn.ubuntu.com/7776-1/
    reference_type:
    reference_id: USN-7776-1
  - url: https://usn.ubuntu.com/7833-1/
    reference_type:
    reference_id: USN-7833-1
  - url: https://usn.ubuntu.com/7833-2/
    reference_type:
    reference_id: USN-7833-2
  - url: https://usn.ubuntu.com/7833-3/
    reference_type:
    reference_id: USN-7833-3
  - url: https://usn.ubuntu.com/7833-4/
    reference_type:
    reference_id: USN-7833-4
  - url: https://usn.ubuntu.com/7834-1/
    reference_type:
    reference_id: USN-7834-1
  - url: https://usn.ubuntu.com/7856-1/
    reference_type:
    reference_id: USN-7856-1
