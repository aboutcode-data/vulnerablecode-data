vulnerability_id: VCID-sv1j-ubyr-53b8
aliases:
  - CVE-2025-61927
  - GHSA-37j7-fg3j-429f
summary: "Happy DOM: VM Context Escape can lead to Remote Code Execution\n# Escape of VM Context\
  \ gives access to process level functionality\n\n## Summary\nHappy DOM v19 and lower contains\
  \ a security vulnerability that puts the owner system at the risk of RCE (Remote Code Execution)\
  \ attacks.\n\nA Node.js VM Context is not an isolated environment, and if the user runs untrusted\
  \ JavaScript code within the Happy DOM VM Context, it may escape the VM and get access to\
  \ process level functionality.\n\nIt seems like what the attacker can get control over depends\
  \ on if the process is using ESM or CommonJS. With CommonJS the attacker can get hold of the\
  \ `require()` function to import modules.\n\nHappy DOM has JavaScript evaluation enabled by\
  \ default. This may not be obvious to the consumer of Happy DOM and can potentially put the\
  \ user at risk if untrusted code is executed within the environment.\n\n## Reproduce\n\n###\
  \ CommonJS (Possible to get hold of require)\n\n```javascript\nconst { Window } = require('happy-dom');\n\
  const window = new Window({ console });\n\nwindow.document.write(`\n  <script>\n     const\
  \ process = this.constructor.constructor('return process')();\n     const require = process.mainModule.require;\n\
  \  \n     console.log('Files:', require('fs').readdirSync('.').slice(0,3));\n  </script>\n\
  `);\n```\n### ESM (Not possible to get hold of import or require)\n\n```javascript\nconst\
  \ { Window } = require('happy-dom');\nconst window = new Window({ console });\n\nwindow.document.write(`\n\
  \  <script>\n     const process = this.constructor.constructor('return process')();\n  \n\
  \     console.log('PID:', process.pid);\n  </script>\n`);\n```\n\n## Potential Impact\n\n\
  #### Server-Side Rendering (SSR)\n```javascript\nconst { Window } = require('happy-dom');\n\
  const window = new Window();\nwindow.document.innerHTML = userControlledHTML;\n```\n\n####\
  \ Testing Frameworks\nAny test suite using Happy-DOM with untrusted content may be at risk\n\
  \n## Attack Scenarios\n\n1. **Data Exfiltration**: Access to environment variables, configuration\
  \ files, secrets\n2. **Lateral Movement**: Network access for connecting to internal systems.\
  \ Happy DOM already gives access to the network by fetch, but has protections in place (such\
  \ as CORS and header validation etc.).\n3. **Code Execution**: Child process access for running\
  \ arbitrary commands\n4. **Persistence**: File system access\n\n## Recommended Immediate Actions\n\
  \n1. Update Happy DOM to v20 or above\n    - This version has JavaScript evaluation disabled\
  \ by default\n    - This version will output a warning if JavaScript is enabled in an insecure\
  \ environment\n2. Run Node.js with the \"--disallow-code-generation-from-strings\" if you\
  \ need JavaScript evaluation enabled\n    - This makes sure that evaluation can't be used\
  \ at process level to escape the VM\n    - `eval()` and `Function()` can still be used within\
  \ the Happy DOM VM without any known security risk\n    - Happy DOM v20 and above will output\
  \ a warning if this flag is not in use\n4. If you can't update Happy DOM right now, it's recommended\
  \ to disable JavaScript evaluation, unless you completely trust the content within the environment\n\
  \n## Technical Root Cause\n\nAll classes and functions inherit from [Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function).\
  \ By walking the constructor chain it's possible to get hold of [Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function)\
  \ at process level. As [Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function)\
  \ can evaluate code from strings, it's possible to execute code at process level.\n\nRunning\
  \ Node with the \"--disallow-code-generation-from-strings\" flag protects against this."
severities:
  - score: '8.3'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:L
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-61927.json
  - score: '0.00304'
    scoring_system: epss
    scoring_elements: '0.53156'
    published_at: '2025-10-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.00304'
    scoring_system: epss
    scoring_elements: '0.532'
    published_at: '2025-10-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.5998'
    published_at: '2025-10-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.5997'
    published_at: '2025-10-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.59968'
    published_at: '2025-10-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.59969'
    published_at: '2025-10-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.59951'
    published_at: '2025-10-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.59902'
    published_at: '2025-10-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.59917'
    published_at: '2025-10-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.59934'
    published_at: '2025-10-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.59942'
    published_at: '2025-10-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.59962'
    published_at: '2025-10-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.60125'
    published_at: '2025-11-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.004'
    scoring_system: epss
    scoring_elements: '0.60132'
    published_at: '2025-11-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.00455'
    scoring_system: epss
    scoring_elements: '0.63286'
    published_at: '2026-01-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: '0.00455'
    scoring_system: epss
    scoring_elements: '0.63301'
    published_at: '2026-01-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
  - score: CRITICAL
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-37j7-fg3j-429f
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/capricorn86/happy-dom
  - score: '7.2'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:H/UI:A/VC:L/VI:H/VA:H/SC:H/SI:H/SA:H
    published_at: None
    url: https://github.com/capricorn86/happy-dom/commit/819d15ba289495439eda8be360d92a614ce22405
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/capricorn86/happy-dom/commit/819d15ba289495439eda8be360d92a614ce22405
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:N/T:P/P:M/B:A/M:M/D:T/2025-10-10T19:58:56Z/
    published_at: None
    url: https://github.com/capricorn86/happy-dom/commit/819d15ba289495439eda8be360d92a614ce22405
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/capricorn86/happy-dom/commit/de438ad72921c69793584aa657b48d3655dfac97
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/capricorn86/happy-dom/releases/tag/v20.0.0
  - score: CRITICAL
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/capricorn86/happy-dom/security/advisories/GHSA-37j7-fg3j-429f
  - score: '7.2'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:H/UI:A/VC:L/VI:H/VA:H/SC:H/SI:H/SA:H
    published_at: None
    url: https://github.com/capricorn86/happy-dom/security/advisories/GHSA-37j7-fg3j-429f
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/capricorn86/happy-dom/security/advisories/GHSA-37j7-fg3j-429f
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:N/T:P/P:M/B:A/M:M/D:T/2025-10-10T19:58:56Z/
    published_at: None
    url: https://github.com/capricorn86/happy-dom/security/advisories/GHSA-37j7-fg3j-429f
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-61927
weaknesses:
  - CWE-94
  - CWE-1035
  - CWE-937
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-61927.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2025-61927
    reference_type:
    reference_id:
  - url: https://github.com/capricorn86/happy-dom
    reference_type:
    reference_id:
  - url: https://github.com/capricorn86/happy-dom/commit/819d15ba289495439eda8be360d92a614ce22405
    reference_type:
    reference_id:
  - url: https://github.com/capricorn86/happy-dom/commit/de438ad72921c69793584aa657b48d3655dfac97
    reference_type:
    reference_id:
  - url: https://github.com/capricorn86/happy-dom/releases/tag/v20.0.0
    reference_type:
    reference_id:
  - url: https://github.com/capricorn86/happy-dom/security/advisories/GHSA-37j7-fg3j-429f
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-61927
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2403177
    reference_type:
    reference_id: 2403177
  - url: https://github.com/advisories/GHSA-37j7-fg3j-429f
    reference_type:
    reference_id: GHSA-37j7-fg3j-429f
  - url: https://access.redhat.com/errata/RHSA-2025:23225
    reference_type:
    reference_id: RHSA-2025:23225
