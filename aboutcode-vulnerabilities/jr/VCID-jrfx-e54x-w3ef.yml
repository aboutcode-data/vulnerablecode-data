vulnerability_id: VCID-jrfx-e54x-w3ef
aliases:
  - GHSA-cffc-mxrf-mhh4
summary: |
  Picklescan is vulnerable to RCE via missing detection when calling numpy.f2py.crackfortran.param_eval
  ### Summary
  Picklescan uses numpy.f2py.crackfortran.param_eval, which is a function in numpy to execute remote pickle files.

  ### Details
  The attack payload executes in the following steps:

  - First, the attacker crafts the payload by calling the numpy.f2py.crackfortran.param_eval function via reduce method.
  - Then, when the victim checks whether the pickle file is safe by using the Picklescan library and this library doesn't detect any dangerous functions, they decide to use pickle.load() on this malicious pickle file, thus leading to remote code execution.


  ### PoC
  ```
  class RCE:
      def __reduce__(self):
          from numpy.f2py.crackfortran import param_eval
          return (param_eval,("os.system('ls')",None,None,None))
  ```


  ### Impact
  Any organization or individual relying on picklescan to detect malicious pickle files inside PyTorch models.
  Attackers can embed malicious code in pickle file that remains undetected but executes when the pickle file is loaded.
  Attackers can distribute infected pickle files across ML models, APIs, or saved Python objects.

  ### Report by
  Pinji Chen (cpj24@mails.tsinghua.edu.cn) from the NISL lab (https://netsec.ccert.edu.cn/about) at Tsinghua University, Guanheng Liu (coolwind326@gmail.com).
severities:
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-cffc-mxrf-mhh4
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan/commit/70c1c6c31beb6baaf52c8db1b6c3c0e84a6f9dab
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan/pull/53
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan/releases/tag/v0.0.33
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan/security/advisories/GHSA-cffc-mxrf-mhh4
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan/security/advisories/GHSA-cffc-mxrf-mhh4
weaknesses:
  - CWE-94
  - CWE-502
references:
  - url: https://github.com/mmaitre314/picklescan
    reference_type:
    reference_id:
  - url: https://github.com/mmaitre314/picklescan/commit/70c1c6c31beb6baaf52c8db1b6c3c0e84a6f9dab
    reference_type:
    reference_id:
  - url: https://github.com/mmaitre314/picklescan/pull/53
    reference_type:
    reference_id:
  - url: https://github.com/mmaitre314/picklescan/releases/tag/v0.0.33
    reference_type:
    reference_id:
  - url: https://github.com/mmaitre314/picklescan/security/advisories/GHSA-cffc-mxrf-mhh4
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-cffc-mxrf-mhh4
    reference_type:
    reference_id: GHSA-cffc-mxrf-mhh4
