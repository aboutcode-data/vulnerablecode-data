vulnerability_id: VCID-y9ej-6qzq-aaaj
aliases:
  - CVE-2024-38636
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  f2fs: multidev: fix to recognize valid zero block address

  As reported by Yi Zhang in mailing list [1], kernel warning was catched
  during zbd/010 test as below:

  ./check zbd/010
  zbd/010 (test gap zone support with F2FS)                    [failed]
      runtime    ...  3.752s
      something found in dmesg:
      [ 4378.146781] run blktests zbd/010 at 2024-02-18 11:31:13
      [ 4378.192349] null_blk: module loaded
      [ 4378.209860] null_blk: disk nullb0 created
      [ 4378.413285] scsi_debug:sdebug_driver_probe: scsi_debug: trim
  poll_queues to 0. poll_q/nr_hw = (0/1)
      [ 4378.422334] scsi host15: scsi_debug: version 0191 [20210520]
                       dev_size_mb=1024, opts=0x0, submit_queues=1, statistics=0
      [ 4378.434922] scsi 15:0:0:0: Direct-Access-ZBC Linux
  scsi_debug       0191 PQ: 0 ANSI: 7
      [ 4378.443343] scsi 15:0:0:0: Power-on or device reset occurred
      [ 4378.449371] sd 15:0:0:0: Attached scsi generic sg5 type 20
      [ 4378.449418] sd 15:0:0:0: [sdf] Host-managed zoned block device
      ...
      (See '/mnt/tests/gitlab.com/api/v4/projects/19168116/repository/archive.zip/storage/blktests/blk/blktests/results/nodev/zbd/010.dmesg'

  WARNING: CPU: 22 PID: 44011 at fs/iomap/iter.c:51
  CPU: 22 PID: 44011 Comm: fio Not tainted 6.8.0-rc3+ #1
  RIP: 0010:iomap_iter+0x32b/0x350
  Call Trace:
   <TASK>
   __iomap_dio_rw+0x1df/0x830
   f2fs_file_read_iter+0x156/0x3d0 [f2fs]
   aio_read+0x138/0x210
   io_submit_one+0x188/0x8c0
   __x64_sys_io_submit+0x8c/0x1a0
   do_syscall_64+0x86/0x170
   entry_SYSCALL_64_after_hwframe+0x6e/0x76

  Shinichiro Kawasaki helps to analyse this issue and proposes a potential
  fixing patch in [2].

  Quoted from reply of Shinichiro Kawasaki:

  "I confirmed that the trigger commit is dbf8e63f48af as Yi reported. I took a
  look in the commit, but it looks fine to me. So I thought the cause is not
  in the commit diff.

  I found the WARN is printed when the f2fs is set up with multiple devices,
  and read requests are mapped to the very first block of the second device in the
  direct read path. In this case, f2fs_map_blocks() and f2fs_map_blocks_cached()
  modify map->m_pblk as the physical block address from each block device. It
  becomes zero when it is mapped to the first block of the device. However,
  f2fs_iomap_begin() assumes that map->m_pblk is the physical block address of the
  whole f2fs, across the all block devices. It compares map->m_pblk against
  NULL_ADDR == 0, then go into the unexpected branch and sets the invalid
  iomap->length. The WARN catches the invalid iomap->length.

  This WARN is printed even for non-zoned block devices, by following steps.

   - Create two (non-zoned) null_blk devices memory backed with 128MB size each:
     nullb0 and nullb1.
   # mkfs.f2fs /dev/nullb0 -c /dev/nullb1
   # mount -t f2fs /dev/nullb0 "${mount_dir}"
   # dd if=/dev/zero of="${mount_dir}/test.dat" bs=1M count=192
   # dd if="${mount_dir}/test.dat" of=/dev/null bs=1M count=192 iflag=direct

  ..."

  So, the root cause of this issue is: when multi-devices feature is on,
  f2fs_map_blocks() may return zero blkaddr in non-primary device, which is
  a verified valid block address, however, f2fs_iomap_begin() treats it as
  an invalid block address, and then it triggers the warning in iomap
  framework code.

  Finally, as discussed, we decide to use a more simple and direct way that
  checking (map.m_flags & F2FS_MAP_MAPPED) condition instead of
  (map.m_pblk != NULL_ADDR) to fix this issue.

  Thanks a lot for the effort of Yi Zhang and Shinichiro Kawasaki on this
  issue.

  [1] https://lore.kernel.org/linux-f2fs-devel/CAHj4cs-kfojYC9i0G73PRkYzcxCTex=-vugRFeP40g_URGvnfQ@mail.gmail.com/
  [2] https://lore.kernel.org/linux-f2fs-devel/gngdj77k4picagsfdtiaa7gpgnup6fsgwzsltx6milmhegmjff@iax2n4wvrqye/
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-38636.json
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16666'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16947'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17041'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17069'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17147'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17142'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17732'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17830'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17350'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17315'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17624'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17338'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00124'
    scoring_system: epss
    scoring_elements: '0.33002'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00124'
    scoring_system: epss
    scoring_elements: '0.3294'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.34037'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.34131'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.3417'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.34175'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.34091'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.34076'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.34078'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.3408'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.34097'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.34089'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00131'
    scoring_system: epss
    scoring_elements: '0.34062'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00171'
    scoring_system: epss
    scoring_elements: '0.35198'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00171'
    scoring_system: epss
    scoring_elements: '0.35331'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00171'
    scoring_system: epss
    scoring_elements: '0.35349'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00171'
    scoring_system: epss
    scoring_elements: '0.35347'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00171'
    scoring_system: epss
    scoring_elements: '0.3534'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00171'
    scoring_system: epss
    scoring_elements: '0.35231'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00171'
    scoring_system: epss
    scoring_elements: '0.35373'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00172'
    scoring_system: epss
    scoring_elements: '0.35432'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00172'
    scoring_system: epss
    scoring_elements: '0.35405'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00172'
    scoring_system: epss
    scoring_elements: '0.35382'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00172'
    scoring_system: epss
    scoring_elements: '0.35363'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00172'
    scoring_system: epss
    scoring_elements: '0.35393'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00172'
    scoring_system: epss
    scoring_elements: '0.35437'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00172'
    scoring_system: epss
    scoring_elements: '0.35346'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00172'
    scoring_system: epss
    scoring_elements: '0.3536'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '0.00723'
    scoring_system: epss
    scoring_elements: '0.57053'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
  - score: '3.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:L
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-20
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-38636.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-38636
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/1a9225fdd0ec95fcf32936bcea9ceef0cf1512dc
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2b2611a42462c6c685d40b5f3aedcd8d21c27065
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/33e62cd7b4c281cd737c62e5d8c4f0e602a8c5c5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e8b485e39b4d17afa9a2821fc778d5a67abfc03a
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2293692
    reference_type:
    reference_id: 2293692
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-38636
    reference_type:
    reference_id: CVE-2024-38636
  - url: https://usn.ubuntu.com/6999-1/
    reference_type:
    reference_id: USN-6999-1
  - url: https://usn.ubuntu.com/6999-2/
    reference_type:
    reference_id: USN-6999-2
  - url: https://usn.ubuntu.com/7004-1/
    reference_type:
    reference_id: USN-7004-1
  - url: https://usn.ubuntu.com/7005-1/
    reference_type:
    reference_id: USN-7005-1
  - url: https://usn.ubuntu.com/7005-2/
    reference_type:
    reference_id: USN-7005-2
  - url: https://usn.ubuntu.com/7008-1/
    reference_type:
    reference_id: USN-7008-1
  - url: https://usn.ubuntu.com/7029-1/
    reference_type:
    reference_id: USN-7029-1
