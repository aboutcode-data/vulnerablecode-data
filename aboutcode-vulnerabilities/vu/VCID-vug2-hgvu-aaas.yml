vulnerability_id: VCID-vug2-hgvu-aaas
aliases:
  - CVE-2021-47277
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  kvm: avoid speculation-based attacks from out-of-range memslot accesses

  KVM's mechanism for accessing guest memory translates a guest physical
  address (gpa) to a host virtual address using the right-shifted gpa
  (also known as gfn) and a struct kvm_memory_slot.  The translation is
  performed in __gfn_to_hva_memslot using the following formula:

        hva = slot->userspace_addr + (gfn - slot->base_gfn) * PAGE_SIZE

  It is expected that gfn falls within the boundaries of the guest's
  physical memory.  However, a guest can access invalid physical addresses
  in such a way that the gfn is invalid.

  __gfn_to_hva_memslot is called from kvm_vcpu_gfn_to_hva_prot, which first
  retrieves a memslot through __gfn_to_memslot.  While __gfn_to_memslot
  does check that the gfn falls within the boundaries of the guest's
  physical memory or not, a CPU can speculate the result of the check and
  continue execution speculatively using an illegal gfn. The speculation
  can result in calculating an out-of-bounds hva.  If the resulting host
  virtual address is used to load another guest physical address, this
  is effectively a Spectre gadget consisting of two consecutive reads,
  the second of which is data dependent on the first.

  Right now it's not clear if there are any cases in which this is
  exploitable.  One interesting case was reported by the original author
  of this patch, and involves visiting guest page tables on x86.  Right
  now these are not vulnerable because the hva read goes through get_user(),
  which contains an LFENCE speculation barrier.  However, there are
  patches in progress for x86 uaccess.h to mask kernel addresses instead of
  using LFENCE; once these land, a guest could use speculation to read
  from the VMM's ring 3 address space.  Other architectures such as ARM
  already use the address masking method, and would be susceptible to
  this same kind of data-dependent access gadgets.  Therefore, this patch
  proactively protects from these attacks by masking out-of-bounds gfns
  in __gfn_to_hva_memslot, which blocks speculation of invalid hvas.

  Sean Christopherson noted that this patch does not cover
  kvm_read_guest_offset_cached.  This however is limited to a few bytes
  past the end of the cache, and therefore it is unlikely to be useful in
  the context of building a chain of data dependent accesses.
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47277.json
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14083'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14371'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14461'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14482'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14548'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14541'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14556'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14611'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14691'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14976'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.15033'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.15128'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14714'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14726'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.15080'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14767'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29158'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25099'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29188'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29203'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25037'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25181'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25206'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25211'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.2522'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25175'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25144'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25154'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25184'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25215'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25202'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25168'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25156'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.25132'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29127'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29189'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29254'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29301'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.293'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29239'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29221'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29183'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00101'
    scoring_system: epss
    scoring_elements: '0.29182'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '0.00463'
    scoring_system: epss
    scoring_elements: '0.47176'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-118
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47277.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-47277
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47277
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/22b87fb17a28d37331bb9c1110737627b17f6781
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3098b86390a6b9ea52657689f08410baf130ceff
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/361ce3b917aff93123e9e966d8608655c967f438
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/740621309b25bbf619b8a0ba5fd50a8e58989441
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7af299b97734c7e7f465b42a2139ce4d77246975
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/bff1fbf0cf0712686f1df59a83fba6e31d2746a0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/da27a83fd6cc7780fea190e1f5c19e87019da65c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ed0e2a893092c7fcb4ff7ba74e5efce53a6f5940
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2282520
    reference_type:
    reference_id: 2282520
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47277
    reference_type:
    reference_id: CVE-2021-47277
