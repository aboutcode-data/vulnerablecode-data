vulnerability_id: VCID-yz6r-878t-uqgw
aliases:
  - CVE-2024-43855
summary: "In the Linux kernel, the following vulnerability has been resolved:\n\nmd: fix deadlock\
  \ between mddev_suspend and flush bio\n\nDeadlock occurs when mddev is being suspended while\
  \ some flush bio is in\nprogress. It is a complex issue.\n\nT1. the first flush is at the\
  \ ending stage, it clears 'mddev->flush_bio'\n    and tries to submit data, but is blocked\
  \ because mddev is suspended\n    by T4.\nT2. the second flush sets 'mddev->flush_bio', and\
  \ attempts to queue\n    md_submit_flush_data(), which is already running (T1) and won't\n\
  \    execute again if on the same CPU as T1.\nT3. the third flush inc active_io and tries\
  \ to flush, but is blocked because\n    'mddev->flush_bio' is not NULL (set by T2).\nT4. mddev_suspend()\
  \ is called and waits for active_io dec to 0 which is inc\n    by T3.\n\n  T1\t\tT2\t\tT3\t\
  \tT4\n  (flush 1)\t(flush 2)\t(third 3)\t(suspend)\n  md_submit_flush_data\n   mddev->flush_bio\
  \ = NULL;\n   .\n   .\t \tmd_flush_request\n   .\t  \t mddev->flush_bio = bio\n   .\t  \t\
  \ queue submit_flushes\n   .\t\t .\n   .\t\t .\t\tmd_handle_request\n   .\t\t .\t\t active_io\
  \ + 1\n   .\t\t .\t\t md_flush_request\n   .\t\t .\t\t  wait !mddev->flush_bio\n   .\t\t .\n\
  \   .\t\t .\t\t\t\tmddev_suspend\n   .\t\t .\t\t\t\t wait !active_io\n   .\t\t .\n   .\t\t\
  \ submit_flushes\n   .\t\t queue_work md_submit_flush_data\n   .\t\t //md_submit_flush_data\
  \ is already running (T1)\n   .\n   md_handle_request\n    wait resume\n\nThe root issue is\
  \ non-atomic inc/dec of active_io during flush process.\nactive_io is dec before md_submit_flush_data\
  \ is queued, and inc soon\nafter md_submit_flush_data() run.\n  md_flush_request\n    active_io\
  \ + 1\n    submit_flushes\n      active_io - 1\n      md_submit_flush_data\n        md_handle_request\n\
  \        active_io + 1\n          make_request\n        active_io - 1\n\nIf active_io is dec\
  \ after md_handle_request() instead of within\nsubmit_flushes(), make_request() can be called\
  \ directly intead of\nmd_handle_request() in md_submit_flush_data(), and active_io will\n\
  only inc and dec once in the whole flush process. Deadlock will be\nfixed.\n\nAdditionally,\
  \ the only difference between fixing the issue and before is\nthat there is no return error\
  \ handling of make_request(). But after\nprevious patch cleaned md_write_start(), make_requst()\
  \ only return error\nin raid5_make_request() by dm-raid, see commit 41425f96d7aa (\"dm-raid456,\n\
  md/raid456: fix a deadlock for dm-raid456 while io concurrent with\nreshape)\". Since dm always\
  \ splits data and flush operation into two\nseparate io, io size of flush submitted by dm\
  \ always is 0, make_request()\nwill not be called in md_submit_flush_data(). To prevent future\n\
  modifications from introducing issues, add WARN_ON to ensure\nmake_request() no error is returned\
  \ in this context."
severities:
  - score: '4.4'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-43855.json
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.054'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.05396'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.05406'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.05395'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.05389'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.05378'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.0534'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.06954'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.06983'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.07077'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.07087'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.07075'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.07054'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.0003'
    scoring_system: epss
    scoring_elements: '0.07035'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00031'
    scoring_system: epss
    scoring_elements: '0.07113'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00031'
    scoring_system: epss
    scoring_elements: '0.07177'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00031'
    scoring_system: epss
    scoring_elements: '0.07171'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00031'
    scoring_system: epss
    scoring_elements: '0.07164'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00031'
    scoring_system: epss
    scoring_elements: '0.0717'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00031'
    scoring_system: epss
    scoring_elements: '0.07163'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00031'
    scoring_system: epss
    scoring_elements: '0.07183'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00031'
    scoring_system: epss
    scoring_elements: '0.05715'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00031'
    scoring_system: epss
    scoring_elements: '0.05702'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05091'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05128'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05124'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05115'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05119'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05108'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05105'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05100'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05073'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05065'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05058'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04956'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04987'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05078'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00056'
    scoring_system: epss
    scoring_elements: '0.14424'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00056'
    scoring_system: epss
    scoring_elements: '0.14547'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00056'
    scoring_system: epss
    scoring_elements: '0.14539'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00056'
    scoring_system: epss
    scoring_elements: '0.14376'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00056'
    scoring_system: epss
    scoring_elements: '0.14567'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '0.00237'
    scoring_system: epss
    scoring_elements: '0.31717'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-43855
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-43855
weaknesses:
  - CWE-476
  - CWE-833
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-43855.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-43855
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-43855
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2d0738a8322bf4e5bfe693d16b3111928a9ccfbf
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/32226070813140234b6c507084738e8e8385c5c6
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/611d5cbc0b35a752e657a83eebadf40d814d006b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ca963eefbc3331222b6121baa696d49ba2008811
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2305513
    reference_type:
    reference_id: 2305513
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-43855
    reference_type:
    reference_id: CVE-2024-43855
  - url: https://access.redhat.com/errata/RHSA-2025:3506
    reference_type:
    reference_id: RHSA-2025:3506
  - url: https://usn.ubuntu.com/7089-1/
    reference_type:
    reference_id: USN-7089-1
  - url: https://usn.ubuntu.com/7089-2/
    reference_type:
    reference_id: USN-7089-2
  - url: https://usn.ubuntu.com/7089-3/
    reference_type:
    reference_id: USN-7089-3
  - url: https://usn.ubuntu.com/7089-4/
    reference_type:
    reference_id: USN-7089-4
  - url: https://usn.ubuntu.com/7089-5/
    reference_type:
    reference_id: USN-7089-5
  - url: https://usn.ubuntu.com/7089-6/
    reference_type:
    reference_id: USN-7089-6
  - url: https://usn.ubuntu.com/7089-7/
    reference_type:
    reference_id: USN-7089-7
  - url: https://usn.ubuntu.com/7090-1/
    reference_type:
    reference_id: USN-7090-1
  - url: https://usn.ubuntu.com/7095-1/
    reference_type:
    reference_id: USN-7095-1
  - url: https://usn.ubuntu.com/7156-1/
    reference_type:
    reference_id: USN-7156-1
