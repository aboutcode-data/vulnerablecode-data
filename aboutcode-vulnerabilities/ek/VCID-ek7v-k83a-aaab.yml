vulnerability_id: VCID-ek7v-k83a-aaab
aliases:
  - CVE-2024-38540
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  bnxt_re: avoid shift undefined behavior in bnxt_qplib_alloc_init_hwq

  Undefined behavior is triggered when bnxt_qplib_alloc_init_hwq is called
  with hwq_attr->aux_depth != 0 and hwq_attr->aux_stride == 0.
  In that case, "roundup_pow_of_two(hwq_attr->aux_stride)" gets called.
  roundup_pow_of_two is documented as undefined for 0.

  Fix it in the one caller that had this combination.

  The undefined behavior was detected by UBSAN:
    UBSAN: shift-out-of-bounds in ./include/linux/log2.h:57:13
    shift exponent 64 is too large for 64-bit type 'long unsigned int'
    CPU: 24 PID: 1075 Comm: (udev-worker) Not tainted 6.9.0-rc6+ #4
    Hardware name: Abacus electric, s.r.o. - servis@abacus.cz Super Server/H12SSW-iN, BIOS 2.7 10/25/2023
    Call Trace:
     <TASK>
     dump_stack_lvl+0x5d/0x80
     ubsan_epilogue+0x5/0x30
     __ubsan_handle_shift_out_of_bounds.cold+0x61/0xec
     __roundup_pow_of_two+0x25/0x35 [bnxt_re]
     bnxt_qplib_alloc_init_hwq+0xa1/0x470 [bnxt_re]
     bnxt_qplib_create_qp+0x19e/0x840 [bnxt_re]
     bnxt_re_create_qp+0x9b1/0xcd0 [bnxt_re]
     ? srso_alias_return_thunk+0x5/0xfbef5
     ? srso_alias_return_thunk+0x5/0xfbef5
     ? __kmalloc+0x1b6/0x4f0
     ? create_qp.part.0+0x128/0x1c0 [ib_core]
     ? __pfx_bnxt_re_create_qp+0x10/0x10 [bnxt_re]
     create_qp.part.0+0x128/0x1c0 [ib_core]
     ib_create_qp_kernel+0x50/0xd0 [ib_core]
     create_mad_qp+0x8e/0xe0 [ib_core]
     ? __pfx_qp_event_handler+0x10/0x10 [ib_core]
     ib_mad_init_device+0x2be/0x680 [ib_core]
     add_client_context+0x10d/0x1a0 [ib_core]
     enable_device_and_get+0xe0/0x1d0 [ib_core]
     ib_register_device+0x53c/0x630 [ib_core]
     ? srso_alias_return_thunk+0x5/0xfbef5
     bnxt_re_probe+0xbd8/0xe50 [bnxt_re]
     ? __pfx_bnxt_re_probe+0x10/0x10 [bnxt_re]
     auxiliary_bus_probe+0x49/0x80
     ? driver_sysfs_add+0x57/0xc0
     really_probe+0xde/0x340
     ? pm_runtime_barrier+0x54/0x90
     ? __pfx___driver_attach+0x10/0x10
     __driver_probe_device+0x78/0x110
     driver_probe_device+0x1f/0xa0
     __driver_attach+0xba/0x1c0
     bus_for_each_dev+0x8f/0xe0
     bus_add_driver+0x146/0x220
     driver_register+0x72/0xd0
     __auxiliary_driver_register+0x6e/0xd0
     ? __pfx_bnxt_re_mod_init+0x10/0x10 [bnxt_re]
     bnxt_re_mod_init+0x3e/0xff0 [bnxt_re]
     ? __pfx_bnxt_re_mod_init+0x10/0x10 [bnxt_re]
     do_one_initcall+0x5b/0x310
     do_init_module+0x90/0x250
     init_module_from_file+0x86/0xc0
     idempotent_init_module+0x121/0x2b0
     __x64_sys_finit_module+0x5e/0xb0
     do_syscall_64+0x82/0x160
     ? srso_alias_return_thunk+0x5/0xfbef5
     ? syscall_exit_to_user_mode_prepare+0x149/0x170
     ? srso_alias_return_thunk+0x5/0xfbef5
     ? syscall_exit_to_user_mode+0x75/0x230
     ? srso_alias_return_thunk+0x5/0xfbef5
     ? do_syscall_64+0x8e/0x160
     ? srso_alias_return_thunk+0x5/0xfbef5
     ? __count_memcg_events+0x69/0x100
     ? srso_alias_return_thunk+0x5/0xfbef5
     ? count_memcg_events.constprop.0+0x1a/0x30
     ? srso_alias_return_thunk+0x5/0xfbef5
     ? handle_mm_fault+0x1f0/0x300
     ? srso_alias_return_thunk+0x5/0xfbef5
     ? do_user_addr_fault+0x34e/0x640
     ? srso_alias_return_thunk+0x5/0xfbef5
     ? srso_alias_return_thunk+0x5/0xfbef5
     entry_SYSCALL_64_after_hwframe+0x76/0x7e
    RIP: 0033:0x7f4e5132821d
    Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d e3 db 0c 00 f7 d8 64 89 01 48
    RSP: 002b:00007ffca9c906a8 EFLAGS: 00000246 ORIG_RAX: 0000000000000139
    RAX: ffffffffffffffda RBX: 0000563ec8a8f130 RCX: 00007f4e5132821d
    RDX: 0000000000000000 RSI: 00007f4e518fa07d RDI: 000000000000003b
    RBP: 00007ffca9c90760 R08: 00007f4e513f6b20 R09: 00007ffca9c906f0
    R10: 0000563ec8a8faa0 R11: 0000000000000246 R12: 00007f4e518fa07d
    R13: 0000000000020000 R14: 0000563ec8409e90 R15: 0000563ec8a8fa60
     </TASK>
    ---[ end trace ]---
severities:
  - score: '4.4'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-38540.json
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16666'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16947'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17624'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17338'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17315'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17350'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17830'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17732'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17041'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17069'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17142'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17147'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19532'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19315'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.1939'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19442'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19504'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19498'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19491'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19475'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19474'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19488'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19497'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19516'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19525'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.19531'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00081'
    scoring_system: epss
    scoring_elements: '0.20978'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00081'
    scoring_system: epss
    scoring_elements: '0.21028'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.21542'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.21578'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.21532'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.21494'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.21533'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.21573'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.21567'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.21523'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.21509'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.2148'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.21514'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00083'
    scoring_system: epss
    scoring_elements: '0.2153'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '0.00343'
    scoring_system: epss
    scoring_elements: '0.40166'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '4.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/627493443f3a8458cb55cdae1da254a7001123bc
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-06-24T15:37:42Z/
    published_at: None
    url: https://git.kernel.org/stable/c/627493443f3a8458cb55cdae1da254a7001123bc
  - score: '4.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/78cfd17142ef70599d6409cbd709d94b3da58659
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-06-24T15:37:42Z/
    published_at: None
    url: https://git.kernel.org/stable/c/78cfd17142ef70599d6409cbd709d94b3da58659
  - score: '4.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/84d2f29152184f0d72ed7c9648c4ee6927df4e59
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-06-24T15:37:42Z/
    published_at: None
    url: https://git.kernel.org/stable/c/84d2f29152184f0d72ed7c9648c4ee6927df4e59
  - score: '4.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/8b799c00cea6fcfe5b501bbaeb228c8821acb753
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-06-24T15:37:42Z/
    published_at: None
    url: https://git.kernel.org/stable/c/8b799c00cea6fcfe5b501bbaeb228c8821acb753
  - score: '4.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/a658f011d89dd20cf2c7cb4760ffd79201700b98
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-06-24T15:37:42Z/
    published_at: None
    url: https://git.kernel.org/stable/c/a658f011d89dd20cf2c7cb4760ffd79201700b98
weaknesses:
  - CWE-125
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-38540.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-38540
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-38540
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/627493443f3a8458cb55cdae1da254a7001123bc
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/78cfd17142ef70599d6409cbd709d94b3da58659
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8b799c00cea6fcfe5b501bbaeb228c8821acb753
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a658f011d89dd20cf2c7cb4760ffd79201700b98
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2293459
    reference_type:
    reference_id: 2293459
  - url: https://git.kernel.org/stable/c/84d2f29152184f0d72ed7c9648c4ee6927df4e59
    reference_type:
    reference_id: 84d2f29152184f0d72ed7c9648c4ee6927df4e59
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-38540
    reference_type:
    reference_id: CVE-2024-38540
  - url: https://access.redhat.com/errata/RHSA-2024:5928
    reference_type:
    reference_id: RHSA-2024:5928
  - url: https://access.redhat.com/errata/RHSA-2024:6206
    reference_type:
    reference_id: RHSA-2024:6206
  - url: https://access.redhat.com/errata/RHSA-2024:6267
    reference_type:
    reference_id: RHSA-2024:6267
  - url: https://access.redhat.com/errata/RHSA-2024:6268
    reference_type:
    reference_id: RHSA-2024:6268
  - url: https://access.redhat.com/errata/RHSA-2024:6297
    reference_type:
    reference_id: RHSA-2024:6297
  - url: https://access.redhat.com/errata/RHSA-2024:8856
    reference_type:
    reference_id: RHSA-2024:8856
  - url: https://access.redhat.com/errata/RHSA-2024:8870
    reference_type:
    reference_id: RHSA-2024:8870
  - url: https://usn.ubuntu.com/6949-1/
    reference_type:
    reference_id: USN-6949-1
  - url: https://usn.ubuntu.com/6949-2/
    reference_type:
    reference_id: USN-6949-2
  - url: https://usn.ubuntu.com/6952-1/
    reference_type:
    reference_id: USN-6952-1
  - url: https://usn.ubuntu.com/6952-2/
    reference_type:
    reference_id: USN-6952-2
  - url: https://usn.ubuntu.com/6955-1/
    reference_type:
    reference_id: USN-6955-1
