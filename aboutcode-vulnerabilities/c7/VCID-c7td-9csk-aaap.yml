vulnerability_id: VCID-c7td-9csk-aaap
aliases:
  - CVE-2024-35980
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  arm64: tlb: Fix TLBI RANGE operand

  KVM/arm64 relies on TLBI RANGE feature to flush TLBs when the dirty
  pages are collected by VMM and the page table entries become write
  protected during live migration. Unfortunately, the operand passed
  to the TLBI RANGE instruction isn't correctly sorted out due to the
  commit 117940aa6e5f ("KVM: arm64: Define kvm_tlb_flush_vmid_range()").
  It leads to crash on the destination VM after live migration because
  TLBs aren't flushed completely and some of the dirty pages are missed.

  For example, I have a VM where 8GB memory is assigned, starting from
  0x40000000 (1GB). Note that the host has 4KB as the base page size.
  In the middile of migration, kvm_tlb_flush_vmid_range() is executed
  to flush TLBs. It passes MAX_TLBI_RANGE_PAGES as the argument to
  __kvm_tlb_flush_vmid_range() and __flush_s2_tlb_range_op(). SCALE#3
  and NUM#31, corresponding to MAX_TLBI_RANGE_PAGES, isn't supported
  by __TLBI_RANGE_NUM(). In this specific case, -1 has been returned
  from __TLBI_RANGE_NUM() for SCALE#3/2/1/0 and rejected by the loop
  in the __flush_tlb_range_op() until the variable @scale underflows
  and becomes -9, 0xffff708000040000 is set as the operand. The operand
  is wrong since it's sorted out by __TLBI_VADDR_RANGE() according to
  invalid @scale and @num.

  Fix it by extending __TLBI_RANGE_NUM() to support the combination of
  SCALE#3 and NUM#31. With the changes, [-1 31] instead of [-1 30] can
  be returned from the macro, meaning the TLBs for 0x200000 pages in the
  above example can be flushed in one shoot with SCALE#3 and NUM#31. The
  macro TLBI_RANGE_MASK is dropped since no one uses it any more. The
  comments are also adjusted accordingly.
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-35980.json
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.11059'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.11079'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.11104'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.11098'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.11088'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.11089'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.11102'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.1112'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.11153'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.11168'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.1116'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.11087'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.10982'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.1093'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17624'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16666'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16947'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17041'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17069'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17147'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17142'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17732'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17830'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17350'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17315'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17338'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.1936'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19422'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19508'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19519'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19485'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19471'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19456'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19466'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19504'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19506'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19313'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19475'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19489'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.19473'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '0.0031'
    scoring_system: epss
    scoring_elements: '0.37801'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-35980
weaknesses:
  - CWE-191
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-35980.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-35980
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/944db7b536baaf49d7e576af36a94f4719552b07
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ac4ad513de4fba18b4ac0ace132777d0910e8cfa
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e3ba51ab24fddef79fc212f9840de54db8fd1685
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2281870
    reference_type:
    reference_id: 2281870
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-35980
    reference_type:
    reference_id: CVE-2024-35980
  - url: https://usn.ubuntu.com/6893-1/
    reference_type:
    reference_id: USN-6893-1
  - url: https://usn.ubuntu.com/6893-2/
    reference_type:
    reference_id: USN-6893-2
  - url: https://usn.ubuntu.com/6893-3/
    reference_type:
    reference_id: USN-6893-3
  - url: https://usn.ubuntu.com/6918-1/
    reference_type:
    reference_id: USN-6918-1
