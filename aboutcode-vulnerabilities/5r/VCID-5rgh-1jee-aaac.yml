vulnerability_id: VCID-5rgh-1jee-aaac
aliases:
  - GHSA-3227-r97m-8j95
summary: |
  Relative Path Traversal in afire serve_static
  ### Impact
  This vulnerability effects the built-in afire serve_static extension allowing paths containing `//....` to bypass the previous path sanitation and request files in higher directories that should not be accessible.

  ### Patches
  The issue has been fixed in [afire 1.1.0](https://crates.io/crates/afire/1.1.0).
  If you can, just update to the newest version of afire.

  ### Workarounds
  If you can't update afire you can simply disallow paths containing `/..` with the following middleware.
  Make sure this is the last middleware added to the server so it runs first, stopping the bad requests.
  ```rust
  use afire::prelude::*;

  struct PathTraversalFix;

  impl Middleware for PathTraversalFix {
      fn pre(&self, req: Request) -> MiddleRequest {
          if req.path.replace("\\", "/").contains("/..") {
              return MiddleRequest::Send(
                  Response::new()
                      .status(400)
                      .text("Paths containing `..` are not allowed"),
              );
          }

          MiddleRequest::Continue
      }
  }
  ```
  ```rust
  let mut server = Server::new(host, port);
  PathTraversalFix.attach(&mut server);
  ```

  ### References
  You can read about the new changes to afire in 1.1.0 [here](https://connorcode.com/writing/afire/update-3)

  ### For more information
  If you have any questions or comments about this advisory you can email me or message me on discord.
  [[https://connorcode.com/contact](https://connorcode.com/contact)]
severities:
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-3227-r97m-8j95
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Basicprogrammer10/afire
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Basicprogrammer10/afire/commit/da7904c04f82e1cb43cc42eaf6a1dba072b5c921
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Basicprogrammer10/afire/releases/tag/v1.1.0
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Basicprogrammer10/afire/security/advisories/GHSA-3227-r97m-8j95
weaknesses:
  - CWE-34
  - CWE-22
references:
  - url: https://github.com/Basicprogrammer10/afire
    reference_type:
    reference_id:
  - url: https://github.com/Basicprogrammer10/afire/commit/da7904c04f82e1cb43cc42eaf6a1dba072b5c921
    reference_type:
    reference_id:
  - url: https://github.com/Basicprogrammer10/afire/releases/tag/v1.1.0
    reference_type:
    reference_id:
  - url: https://github.com/Basicprogrammer10/afire/security/advisories/GHSA-3227-r97m-8j95
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-3227-r97m-8j95
    reference_type:
    reference_id: GHSA-3227-r97m-8j95
