vulnerability_id: VCID-bpnz-pbnv-aaas
aliases:
  - CVE-2024-32886
  - GHSA-649x-hxfx-57j2
summary: "Vitess vulnerable to infinite memory consumption and vtgate crash\n### Summary\n\n\
  When executing the following simple query, the `vtgate` will go into an endless loop that\
  \ also keeps consuming memory and eventually will OOM.\n\n### Details\n\nWhen running the\
  \ following query, the `evalengine` will try evaluate it and runs forever.\n\n```\nselect\
  \ _utf16 0xFF\n```\n\nThe source of the bug lies in the collation logic that we have. The\
  \ bug applies to all `utf16`,  `utf32` and `ucs2` encodings.  In general, the bug is there\
  \ for any encoding where the minimal byte length for a single character is more than 1 byte.\n\
  \nThe decoding functions for these collations all implement logic like the following to enforce\
  \ the minimal character length:\n\nhttps://github.com/vitessio/vitess/blob/8f6cfaaa643a08dc111395a75a2d250ee746cfa8/go/mysql/collations/charset/unicode/utf16.go#L69-L71\n\
  \nThe problem is that all the callers of `DecodeRune` expect progress by returning the number\
  \ of bytes consumed. This means that if there's only 1 byte left in an input, it will here\
  \ return still `0` and the caller(s) don't consume the character. \n\nOne example of such\
  \ a caller is the following:\n\nhttps://github.com/vitessio/vitess/blob/8f6cfaaa643a08dc111395a75a2d250ee746cfa8/go/mysql/collations/charset/convert.go#L73-L79\n\
  \nThe logic here moves forward the pointer in the input `[]byte` but if `DecodeRune` returns\
  \ `0` in case of error, it will keep running forever. The OOM happens since it keeps adding\
  \ the `?` as the invalid character to the destination buffer infinitely, growing forever until\
  \ it runs out of memory.\n\nThe fix here would be to always return forward progress also on\
  \ invalid strings. \n\nThere's also a separate bug here that even if progress is guaranteed,\
  \ `select _utf16 0xFF` will return the wrong result currently. MySQL will pad here the input\
  \ when the `_utf16` introducer is used with leading `0x00` bytes and then decode to UTF-16,\
  \ resulting in the output of `Ã¿` here. \n\n### PoC\n\n```\nselect _utf16 0xFF\n```\n\n###\
  \ Impact\n\nDenial of service attack by triggering unbounded memory usage."
severities:
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11214'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12225'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11891'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11841'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11828'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12271'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12177'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12119'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11819'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11764'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11709'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11696'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11700'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11632'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11609'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11518'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.19732'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.19517'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.19592'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.19644'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.19706'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.19702'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.197'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.19683'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.19681'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.19694'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.19722'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.1973'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67485'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.6746'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67475'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67481'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67494'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67469'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67449'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67341'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67323'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67427'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67432'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67447'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67467'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.67456'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.00612'
    scoring_system: epss
    scoring_elements: '0.6745'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '0.01069'
    scoring_system: epss
    scoring_elements: '0.64306'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
  - score: '4.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/vitessio/vitess
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vitessio/vitess
  - score: '4.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/vitessio/vitess/blob/8f6cfaaa643a08dc111395a75a2d250ee746cfa8/go/mysql/collations/charset/convert.go#L73-L79
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vitessio/vitess/blob/8f6cfaaa643a08dc111395a75a2d250ee746cfa8/go/mysql/collations/charset/convert.go#L73-L79
  - score: '4.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/vitessio/vitess/blob/8f6cfaaa643a08dc111395a75a2d250ee746cfa8/go/mysql/collations/charset/unicode/utf16.go#L69-L71
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vitessio/vitess/blob/8f6cfaaa643a08dc111395a75a2d250ee746cfa8/go/mysql/collations/charset/unicode/utf16.go#L69-L71
  - score: '4.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/vitessio/vitess/commit/2fd5ba1dbf6e9b32fdfdaf869d130066b1b5c0df
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vitessio/vitess/commit/2fd5ba1dbf6e9b32fdfdaf869d130066b1b5c0df
  - score: '4.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/vitessio/vitess/commit/9df4b66550e46b5d7079e21ed0e1b0f49f92b055
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vitessio/vitess/commit/9df4b66550e46b5d7079e21ed0e1b0f49f92b055
  - score: '4.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/vitessio/vitess/commit/c46dc5b6a4329a10589ca928392218d96031ac8d
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vitessio/vitess/commit/c46dc5b6a4329a10589ca928392218d96031ac8d
  - score: '4.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/vitessio/vitess/commit/d438adf7e34a6cf00fe441db80842ec669a99202
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vitessio/vitess/commit/d438adf7e34a6cf00fe441db80842ec669a99202
  - score: '4.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/vitessio/vitess/security/advisories/GHSA-649x-hxfx-57j2
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vitessio/vitess/security/advisories/GHSA-649x-hxfx-57j2
  - score: '4.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-32886
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-32886
weaknesses:
  - CWE-835
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-32886
    reference_type:
    reference_id:
  - url: https://github.com/vitessio/vitess
    reference_type:
    reference_id:
  - url: https://github.com/vitessio/vitess/blob/8f6cfaaa643a08dc111395a75a2d250ee746cfa8/go/mysql/collations/charset/convert.go#L73-L79
    reference_type:
    reference_id:
  - url: https://github.com/vitessio/vitess/blob/8f6cfaaa643a08dc111395a75a2d250ee746cfa8/go/mysql/collations/charset/unicode/utf16.go#L69-L71
    reference_type:
    reference_id:
  - url: https://github.com/vitessio/vitess/commit/2fd5ba1dbf6e9b32fdfdaf869d130066b1b5c0df
    reference_type:
    reference_id:
  - url: https://github.com/vitessio/vitess/commit/9df4b66550e46b5d7079e21ed0e1b0f49f92b055
    reference_type:
    reference_id:
  - url: https://github.com/vitessio/vitess/commit/c46dc5b6a4329a10589ca928392218d96031ac8d
    reference_type:
    reference_id:
  - url: https://github.com/vitessio/vitess/commit/d438adf7e34a6cf00fe441db80842ec669a99202
    reference_type:
    reference_id:
  - url: https://github.com/vitessio/vitess/security/advisories/GHSA-649x-hxfx-57j2
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-32886
    reference_type:
    reference_id:
