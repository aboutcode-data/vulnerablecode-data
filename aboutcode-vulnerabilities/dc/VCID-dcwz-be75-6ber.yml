vulnerability_id: VCID-dcwz-be75-6ber
aliases:
  - CVE-2024-49932
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  btrfs: don't readahead the relocation inode on RST

  On relocation we're doing readahead on the relocation inode, but if the
  filesystem is backed by a RAID stripe tree we can get ENOENT (e.g. due to
  preallocated extents not being mapped in the RST) from the lookup.

  But readahead doesn't handle the error and submits invalid reads to the
  device, causing an assertion in the scatter-gather list code:

    BTRFS info (device nvme1n1): balance: start -d -m -s
    BTRFS info (device nvme1n1): relocating block group 6480920576 flags data|raid0
    BTRFS error (device nvme1n1): cannot find raid-stripe for logical [6481928192, 6481969152] devid 2, profile raid0
    ------------[ cut here ]------------
    kernel BUG at include/linux/scatterlist.h:115!
    Oops: invalid opcode: 0000 [#1] PREEMPT SMP PTI
    CPU: 0 PID: 1012 Comm: btrfs Not tainted 6.10.0-rc7+ #567
    RIP: 0010:__blk_rq_map_sg+0x339/0x4a0
    RSP: 0018:ffffc90001a43820 EFLAGS: 00010202
    RAX: 0000000000000000 RBX: 0000000000000000 RCX: ffffea00045d4802
    RDX: 0000000117520000 RSI: 0000000000000000 RDI: ffff8881027d1000
    RBP: 0000000000003000 R08: ffffea00045d4902 R09: 0000000000000000
    R10: 0000000000000000 R11: 0000000000001000 R12: ffff8881003d10b8
    R13: ffffc90001a438f0 R14: 0000000000000000 R15: 0000000000003000
    FS:  00007fcc048a6900(0000) GS:ffff88813bc00000(0000) knlGS:0000000000000000
    CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    CR2: 000000002cd11000 CR3: 00000001109ea001 CR4: 0000000000370eb0
    Call Trace:
     <TASK>
     ? __die_body.cold+0x14/0x25
     ? die+0x2e/0x50
     ? do_trap+0xca/0x110
     ? do_error_trap+0x65/0x80
     ? __blk_rq_map_sg+0x339/0x4a0
     ? exc_invalid_op+0x50/0x70
     ? __blk_rq_map_sg+0x339/0x4a0
     ? asm_exc_invalid_op+0x1a/0x20
     ? __blk_rq_map_sg+0x339/0x4a0
     nvme_prep_rq.part.0+0x9d/0x770
     nvme_queue_rq+0x7d/0x1e0
     __blk_mq_issue_directly+0x2a/0x90
     ? blk_mq_get_budget_and_tag+0x61/0x90
     blk_mq_try_issue_list_directly+0x56/0xf0
     blk_mq_flush_plug_list.part.0+0x52b/0x5d0
     __blk_flush_plug+0xc6/0x110
     blk_finish_plug+0x28/0x40
     read_pages+0x160/0x1c0
     page_cache_ra_unbounded+0x109/0x180
     relocate_file_extent_cluster+0x611/0x6a0
     ? btrfs_search_slot+0xba4/0xd20
     ? balance_dirty_pages_ratelimited_flags+0x26/0xb00
     relocate_data_extent.constprop.0+0x134/0x160
     relocate_block_group+0x3f2/0x500
     btrfs_relocate_block_group+0x250/0x430
     btrfs_relocate_chunk+0x3f/0x130
     btrfs_balance+0x71b/0xef0
     ? kmalloc_trace_noprof+0x13b/0x280
     btrfs_ioctl+0x2c2e/0x3030
     ? kvfree_call_rcu+0x1e6/0x340
     ? list_lru_add_obj+0x66/0x80
     ? mntput_no_expire+0x3a/0x220
     __x64_sys_ioctl+0x96/0xc0
     do_syscall_64+0x54/0x110
     entry_SYSCALL_64_after_hwframe+0x76/0x7e
    RIP: 0033:0x7fcc04514f9b
    Code: Unable to access opcode bytes at 0x7fcc04514f71.
    RSP: 002b:00007ffeba923370 EFLAGS: 00000246 ORIG_RAX: 0000000000000010
    RAX: ffffffffffffffda RBX: 0000000000000003 RCX: 00007fcc04514f9b
    RDX: 00007ffeba923460 RSI: 00000000c4009420 RDI: 0000000000000003
    RBP: 0000000000000000 R08: 0000000000000013 R09: 0000000000000001
    R10: 00007fcc043fbba8 R11: 0000000000000246 R12: 00007ffeba924fc5
    R13: 00007ffeba923460 R14: 0000000000000002 R15: 00000000004d4bb0
     </TASK>
    Modules linked in:
    ---[ end trace 0000000000000000 ]---
    RIP: 0010:__blk_rq_map_sg+0x339/0x4a0
    RSP: 0018:ffffc90001a43820 EFLAGS: 00010202
    RAX: 0000000000000000 RBX: 0000000000000000 RCX: ffffea00045d4802
    RDX: 0000000117520000 RSI: 0000000000000000 RDI: ffff8881027d1000
    RBP: 0000000000003000 R08: ffffea00045d4902 R09: 0000000000000000
    R10: 0000000000000000 R11: 0000000000001000 R12: ffff8881003d10b8
    R13: ffffc90001a438f0 R14: 0000000000000000 R15: 0000000000003000
    FS:  00007fcc048a6900(0000) GS:ffff88813bc00000(0000) knlGS:0000000000000000
    CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    CR2: 00007fcc04514f71 CR3: 00000001109ea001 CR4: 0000000000370eb0
    Kernel p
  ---truncated---
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-49932.json
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01386'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01382'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01376'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01387'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01375'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01365'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01392'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01407'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01398'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01396'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01404'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01391'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.06524'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.05168'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.06505'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.11287'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10183'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10193'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10224'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10259'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10249'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.1026'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10273'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10305'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10271'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10236'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10211'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10153'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10285'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09902'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10302'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10364'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10366'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10377'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10429'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10484'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-49932
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-49932
weaknesses:
  - CWE-617
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-49932.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-49932
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-49932
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/04915240e2c3a018e4c7f23418478d27226c8957
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f7a1218a983ab98aba140dc20b25f60b39ee4033
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2320542
    reference_type:
    reference_id: 2320542
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-49932
    reference_type:
    reference_id: CVE-2024-49932
  - url: https://usn.ubuntu.com/7276-1/
    reference_type:
    reference_id: USN-7276-1
  - url: https://usn.ubuntu.com/7277-1/
    reference_type:
    reference_id: USN-7277-1
  - url: https://usn.ubuntu.com/7310-1/
    reference_type:
    reference_id: USN-7310-1
