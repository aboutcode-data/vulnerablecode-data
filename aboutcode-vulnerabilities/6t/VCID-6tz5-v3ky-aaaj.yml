vulnerability_id: VCID-6tz5-v3ky-aaaj
aliases:
  - GHSA-cx7h-h87r-jpgr
summary: |
  The kstring integration in gix-attributes is unsound
  `gix-attributes` (in [`state::ValueRef`](https://github.com/Byron/gitoxide/blob/gix-attributes-v0.22.2/gix-attributes/src/state.rs#L19-L27)) unsafely creates a `&str` from a `&[u8]` containing non-UTF8 data, with the justification that so long as nothing reads the `&str` and relies on it being UTF-8 in the `&str`, there is no UB:

  ```rust
  // SAFETY: our API makes accessing that value as `str` impossible, so illformed UTF8 is never exposed as such.
  ```

  The problem is that the non-UTF8 `str` **is** exposed to outside code: first to the `kstring` crate itself, which requires UTF-8 in its documentation and may have UB as a consequence of this, but also to `serde`, where it propagates to e.g. `serde_json`, `serde_yaml`, etc., where the same problems occur.

  This is not sound, and it could cause further UB down the line in these places that can view the `&str`.
severities:
  - score: LOW
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-cx7h-h87r-jpgr
  - score: '2.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:N/UI:R/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/Byron/gitoxide
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Byron/gitoxide
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Byron/gitoxide/issues/1460
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/GitoxideLabs/gitoxide/issues/1460
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/rustsec/advisory-db/commit/884aaa1646132bc3a27ba058197d6ef039bec294
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2024-0359.html
weaknesses:
  - CWE-172
references:
  - url: https://github.com/Byron/gitoxide
    reference_type:
    reference_id:
  - url: https://github.com/Byron/gitoxide/issues/1460
    reference_type:
    reference_id:
  - url: https://github.com/GitoxideLabs/gitoxide/issues/1460
    reference_type:
    reference_id:
  - url: https://github.com/rustsec/advisory-db/commit/884aaa1646132bc3a27ba058197d6ef039bec294
    reference_type:
    reference_id:
  - url: https://rustsec.org/advisories/RUSTSEC-2024-0359.html
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-cx7h-h87r-jpgr
    reference_type:
    reference_id: GHSA-cx7h-h87r-jpgr
