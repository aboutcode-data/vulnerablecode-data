vulnerability_id: VCID-wy5x-bruh-gbhg
aliases:
  - CVE-2021-4442
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  tcp: add sanity tests to TCP_QUEUE_SEQ

  Qingyu Li reported a syzkaller bug where the repro
  changes RCV SEQ _after_ restoring data in the receive queue.

  mprotect(0x4aa000, 12288, PROT_READ)    = 0
  mmap(0x1ffff000, 4096, PROT_NONE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x1ffff000
  mmap(0x20000000, 16777216, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x20000000
  mmap(0x21000000, 4096, PROT_NONE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x21000000
  socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 3
  setsockopt(3, SOL_TCP, TCP_REPAIR, [1], 4) = 0
  connect(3, {sa_family=AF_INET6, sin6_port=htons(0), sin6_flowinfo=htonl(0), inet_pton(AF_INET6, "::1", &sin6_addr), sin6_scope_id=0}, 28) = 0
  setsockopt(3, SOL_TCP, TCP_REPAIR_QUEUE, [1], 4) = 0
  sendmsg(3, {msg_name=NULL, msg_namelen=0, msg_iov=[{iov_base="0x0000000000000003\0\0", iov_len=20}], msg_iovlen=1, msg_controllen=0, msg_flags=0}, 0) = 20
  setsockopt(3, SOL_TCP, TCP_REPAIR, [0], 4) = 0
  setsockopt(3, SOL_TCP, TCP_QUEUE_SEQ, [128], 4) = 0
  recvfrom(3, NULL, 20, 0, NULL, NULL)    = -1 ECONNRESET (Connection reset by peer)

  syslog shows:
  [  111.205099] TCP recvmsg seq # bug 2: copied 80, seq 0, rcvnxt 80, fl 0
  [  111.207894] WARNING: CPU: 1 PID: 356 at net/ipv4/tcp.c:2343 tcp_recvmsg_locked+0x90e/0x29a0

  This should not be allowed. TCP_QUEUE_SEQ should only be used
  when queues are empty.

  This patch fixes this case, and the tx path as well.
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-4442.json
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12392'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09851'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09863'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09874'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09894'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09865'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09834'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09815'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09758'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12258'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12312'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12415'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12485'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12489'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12465'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12422'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12409'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.1239'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12391'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12407'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12403'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09726'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09679'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09781'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09796'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09825'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.09852'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.0984'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.18127'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.19021'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.18998'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.19000'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.19281'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.18425'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.18523'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.18559'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.18649'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.18642'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.18659'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.18697'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.18760'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.19070'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.19143'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.19247'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '0.00384'
    scoring_system: epss
    scoring_elements: '0.42703'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-4442
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-4442
weaknesses:
  - CWE-20
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-4442.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-4442
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-4442
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/046f3c1c2ff450fb7ae53650e9a95e0074a61f3e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/319f460237fc2965a80aa9a055044e1da7b3692a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3b72d5a703842f582502d97906f17d6ee122dac2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3bf899438c123c444f6b644a57784dfbb6b15ad6
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8811f4a9836e31c14ecdf79d9f3cb7c5d463265d
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2308455
    reference_type:
    reference_id: 2308455
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.12:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.12:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.12:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.12:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-4442
    reference_type:
    reference_id: CVE-2021-4442
  - url: https://access.redhat.com/errata/RHSA-2021:4356
    reference_type:
    reference_id: RHSA-2021:4356
