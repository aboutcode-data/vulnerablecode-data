vulnerability_id: VCID-mubq-7n8h-cbcj
aliases:
  - CVE-2025-39738
summary: 'In the Linux kernel, the following vulnerability has been resolved:  btrfs: do not
  allow relocation of partially dropped subvolumes  [BUG] There is an internal report that balance
  triggered transaction abort, with the following call trace:    item 85 key (594509824 169
  0) itemoff 12599 itemsize 33           extent refs 1 gen 197740 flags 2           ref#0: tree
  block backref root 7   item 86 key (594558976 169 0) itemoff 12566 itemsize 33           extent
  refs 1 gen 197522 flags 2           ref#0: tree block backref root 7  ...  BTRFS error (device
  loop0): extent item not found for insert, bytenr 594526208 num_bytes 16384 parent 449921024
  root_objectid 934 owner 1 offset 0  BTRFS error (device loop0): failed to run delayed ref
  for logical 594526208 num_bytes 16384 type 182 action 1 ref_mod 1: -117  ------------[ cut
  here ]------------  BTRFS: Transaction aborted (error -117)  WARNING: CPU: 1 PID: 6963 at
  ../fs/btrfs/extent-tree.c:2168 btrfs_run_delayed_refs+0xfa/0x110 [btrfs]  And btrfs check
  doesn''t report anything wrong related to the extent tree.  [CAUSE] The cause is a little
  complex, firstly the extent tree indeed doesn''t have the backref for 594526208.  The extent
  tree only have the following two backrefs around that bytenr on-disk:          item 65 key
  (594509824 METADATA_ITEM 0) itemoff 13880 itemsize 33                 refs 1 gen 197740 flags
  TREE_BLOCK                 tree block skinny level 0                 (176 0x7) tree block
  backref root CSUM_TREE         item 66 key (594558976 METADATA_ITEM 0) itemoff 13847 itemsize
  33                 refs 1 gen 197522 flags TREE_BLOCK                 tree block skinny level
  0                 (176 0x7) tree block backref root CSUM_TREE  But the such missing backref
  item is not an corruption on disk, as the offending delayed ref belongs to subvolume 934,
  and that subvolume is being dropped:          item 0 key (934 ROOT_ITEM 198229) itemoff 15844
  itemsize 439                 generation 198229 root_dirid 256 bytenr 10741039104 byte_limit
  0 bytes_used 345571328                 last_snapshot 198229 flags 0x1000000000001(RDONLY)
  refs 0                 drop_progress key (206324 EXTENT_DATA 2711650304) drop_level 2                 level
  2 generation_v2 198229  And that offending tree block 594526208 is inside the dropped range
  of that subvolume.  That explains why there is no backref item for that bytenr and why btrfs
  check is not reporting anything wrong.  But this also shows another problem, as btrfs will
  do all the orphan subvolume cleanup at a read-write mount.  So half-dropped subvolume should
  not exist after an RW mount, and balance itself is also exclusive to subvolume cleanup, meaning
  we shouldn''t hit a subvolume half-dropped during relocation.  The root cause is, there is
  no orphan item for this subvolume. In fact there are 5 subvolumes from around 2021 that have
  the same problem.  It looks like the original report has some older kernels running, and caused
  those zombie subvolumes.  Thankfully upstream commit 8d488a8c7ba2 ("btrfs: fix subvolume/snapshot
  deletion not triggered on mount") has long fixed the bug.  [ENHANCEMENT] For repairing such
  old fs, btrfs-progs will be enhanced.  Considering how delayed the problem will show up (at
  run delayed ref time) and at that time we have to abort transaction already, it is too late.  Instead
  here we reject any half-dropped subvolume for reloc tree at the earliest time, preventing
  confusion and extra time wasted on debugging similar bugs.'
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-39738.json
  - score: '0.00023'
    scoring_system: epss
    scoring_elements: '0.05469'
    published_at: '2026-01-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04997'
    published_at: '2025-09-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05016'
    published_at: '2025-09-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07772'
    published_at: '2025-09-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07843'
    published_at: '2025-09-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.0783'
    published_at: '2025-09-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.0801'
    published_at: '2025-09-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.08001'
    published_at: '2025-09-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.08009'
    published_at: '2025-09-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.08145'
    published_at: '2025-10-01 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.0808'
    published_at: '2025-10-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.08136'
    published_at: '2025-10-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.08117'
    published_at: '2025-10-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.08148'
    published_at: '2025-10-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.08106'
    published_at: '2025-10-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07738'
    published_at: '2025-09-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07777'
    published_at: '2025-09-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.0781'
    published_at: '2025-09-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09305'
    published_at: '2025-10-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09348'
    published_at: '2025-10-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09362'
    published_at: '2025-10-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09374'
    published_at: '2025-10-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09308'
    published_at: '2025-10-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09293'
    published_at: '2025-10-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09402'
    published_at: '2025-10-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.0934'
    published_at: '2025-10-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09352'
    published_at: '2025-10-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09363'
    published_at: '2025-10-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09383'
    published_at: '2025-10-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09511'
    published_at: '2025-11-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09468'
    published_at: '2025-11-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10603'
    published_at: '2026-01-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
  - score: '4.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-166
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-39738.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2025-39738
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-39738
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2394629
    reference_type:
    reference_id: 2394629
  - url: https://usn.ubuntu.com/7909-1/
    reference_type:
    reference_id: USN-7909-1
  - url: https://usn.ubuntu.com/7909-2/
    reference_type:
    reference_id: USN-7909-2
  - url: https://usn.ubuntu.com/7909-3/
    reference_type:
    reference_id: USN-7909-3
  - url: https://usn.ubuntu.com/7909-4/
    reference_type:
    reference_id: USN-7909-4
  - url: https://usn.ubuntu.com/7909-5/
    reference_type:
    reference_id: USN-7909-5
  - url: https://usn.ubuntu.com/7910-1/
    reference_type:
    reference_id: USN-7910-1
  - url: https://usn.ubuntu.com/7910-2/
    reference_type:
    reference_id: USN-7910-2
  - url: https://usn.ubuntu.com/7933-1/
    reference_type:
    reference_id: USN-7933-1
  - url: https://usn.ubuntu.com/7938-1/
    reference_type:
    reference_id: USN-7938-1
