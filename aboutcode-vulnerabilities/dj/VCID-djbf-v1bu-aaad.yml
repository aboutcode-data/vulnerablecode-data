vulnerability_id: VCID-djbf-v1bu-aaad
aliases:
  - CVE-2024-32971
  - GHSA-q9p4-hw9m-fj2v
summary: "Apollo Router vulnerable to Critical Regression In Query Plan Cache\n### Impact\n\
  Any instance of Apollo Router 1.44.0 or 1.45.0 that is using Distributed Query Plan Caching\
  \ is impacted. These versions were released on 2024-04-12 and 2024-04-22 respectively.\n\n\
  The affected versions of Apollo Router contain a bug that could lead to unexpected operations\
  \ being executed, which can result in unintended data or effects. This only affects Router\
  \ instances configured to use distributed query plan caching. Router versions other than the\
  \ ones listed above, and all Router deployments that are not using distributed query plan\
  \ caching, are unaffected by this defect.\n\nIf you are using the affected versions, you can\
  \ check your router’s configuration YAML to verify if you are impacted:\n\n\n```yaml\nsupergraph:\n\
  \  query_planning:\n    cache:\n      # Look for this config below\n      redis:\n       \
  \ urls: [\"redis://...\"]\n```\nA full reference on the[ Distributed Query Plan Caching feature\
  \ is available here.](https://www.apollographql.com/docs/router/configuration/distributed-caching/#distributed-query-plan-caching)\n\
  \n### Impact detail\nThe root cause of this defect is a bug in Apollo Router’s cache retrieval\
  \ logic: When this defect is present and distributed query planning caching is enabled, asking\
  \ the Router to execute an operation (whether it is a query, a mutation, or a subscription)\
  \ may result in an unexpected variation of that operation being executed or the generation\
  \ of unexpected errors.  \n\nThe issue stems from inadvertently executing a modified version\
  \ of a previously executed operation, whose query plan is stored in the underlying cache (specifically,\
  \ Redis). Depending on the type of the operation, the result may vary.  For a query, results\
  \ may be fetched that don’t match what was requested (e.g., rather than running `fetchUsers(type:\
  \ ENTERPRISE)` the Router may run `fetchUsers(type: TRIAL)`.  For a mutation, this may result\
  \ in incorrect mutations being sent to underlying subgraph servers (e.g., rather than sending\
  \ `deleteUser(id: 10)` to a subgraph, the Router may run `deleteUser(id: 12)`.\n\n### Patches\n\
  Apollo Router 1.45.1\n\nIf you are using distributed query plan caching, please either upgrade\
  \ to version 1.45.1 or above or downgrade to version 1.43.2 of the Apollo Router. We do not\
  \ recommend Apollo Router versions 1.44.0 or 1.45.0 for use and have withdrawn these releases.\
  \ If you use impacted versions in production, we recommend that you migrate away immediately\
  \ by redeploying to an unaffected Router version. For non-production use cases, we recommend\
  \ you migrate at your earliest convenience.\n\n### Workarounds\nIf you cannot upgrade or downgrade,\
  \ you can disable distributed query plan caching by removing the `supergraph.query_planning.cache.redis.urls`\
  \ configuration. Please note that when distributed query plan caching is disabled, each Router\
  \ instance will maintain its own in-memory query plan cache. This may increase resource utilization\
  \ for each Router instance and could increase cold-start times as each Router instance builds\
  \ its query plan cache.\n\n### References\n[Apollo Router 1.45.1 Release Notes](https://github.com/apollographql/router/releases/tag/v1.45.1)"
severities:
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17069'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17624'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17338'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17315'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17350'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17830'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17732'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17142'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17147'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16666'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16947'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17041'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.3987'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.39865'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.39936'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.39999'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.40035'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.40039'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.39935'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.3993'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.39941'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.39929'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.39945'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.39928'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00177'
    scoring_system: epss
    scoring_elements: '0.39905'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.6325'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.63226'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.63322'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.63324'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.63345'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.6336'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.63337'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.63336'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.63334'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.6331'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.63342'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.63331'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00502'
    scoring_system: epss
    scoring_elements: '0.63318'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: '0.00974'
    scoring_system: epss
    scoring_elements: '0.62707'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
  - score: CRITICAL
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-q9p4-hw9m-fj2v
  - score: '5.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/apollographql/router
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/apollographql/router
  - score: '9.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/apollographql/router/commit/ff9f666598cd17661880fe7fc6e9c9611316e529
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/apollographql/router/commit/ff9f666598cd17661880fe7fc6e9c9611316e529
  - score: '9.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/apollographql/router/releases/tag/v1.45.1
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/apollographql/router/releases/tag/v1.45.1
  - score: '9.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/apollographql/router/security/advisories/GHSA-q9p4-hw9m-fj2v
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/apollographql/router/security/advisories/GHSA-q9p4-hw9m-fj2v
  - score: '9.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-32971
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-32971
  - score: '9.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://www.apollographql.com/docs/router/configuration/distributed-caching/#distributed-query-plan-caching
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://www.apollographql.com/docs/router/configuration/distributed-caching/#distributed-query-plan-caching
weaknesses:
  - CWE-670
  - CWE-440
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-32971
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/router
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/router/commit/ff9f666598cd17661880fe7fc6e9c9611316e529
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/router/releases/tag/v1.45.1
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/router/security/advisories/GHSA-q9p4-hw9m-fj2v
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-32971
    reference_type:
    reference_id:
  - url: https://www.apollographql.com/docs/router/configuration/distributed-caching/#distributed-query-plan-caching
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-q9p4-hw9m-fj2v
    reference_type:
    reference_id: GHSA-q9p4-hw9m-fj2v
