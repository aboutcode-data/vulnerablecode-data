vulnerability_id: VCID-cn6x-y3az-syf5
aliases:
  - CVE-2024-46789
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mm/slub: add check for s->flags in the alloc_tagging_slab_free_hook

  When enable CONFIG_MEMCG & CONFIG_KFENCE & CONFIG_KMEMLEAK, the following
  warning always occurs,This is because the following call stack occurred:
  mem_pool_alloc
      kmem_cache_alloc_noprof
          slab_alloc_node
              kfence_alloc

  Once the kfence allocation is successful,slab->obj_exts will not be empty,
  because it has already been assigned a value in kfence_init_pool.

  Since in the prepare_slab_obj_exts_hook function,we perform a check for
  s->flags & (SLAB_NO_OBJ_EXT | SLAB_NOLEAKTRACE),the alloc_tag_add function
  will not be called as a result.Therefore,ref->ct remains NULL.

  However,when we call mem_pool_free,since obj_ext is not empty, it
  eventually leads to the alloc_tag_sub scenario being invoked.  This is
  where the warning occurs.

  So we should add corresponding checks in the alloc_tagging_slab_free_hook.
  For __GFP_NO_OBJ_EXT case,I didn't see the specific case where it's using
  kfence,so I won't add the corresponding check in
  alloc_tagging_slab_free_hook for now.

  [    3.734349] ------------[ cut here ]------------
  [    3.734807] alloc_tag was not set
  [    3.735129] WARNING: CPU: 4 PID: 40 at ./include/linux/alloc_tag.h:130 kmem_cache_free+0x444/0x574
  [    3.735866] Modules linked in: autofs4
  [    3.736211] CPU: 4 UID: 0 PID: 40 Comm: ksoftirqd/4 Tainted: G        W          6.11.0-rc3-dirty #1
  [    3.736969] Tainted: [W]=WARN
  [    3.737258] Hardware name: QEMU KVM Virtual Machine, BIOS unknown 2/2/2022
  [    3.737875] pstate: 60400005 (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
  [    3.738501] pc : kmem_cache_free+0x444/0x574
  [    3.738951] lr : kmem_cache_free+0x444/0x574
  [    3.739361] sp : ffff80008357bb60
  [    3.739693] x29: ffff80008357bb70 x28: 0000000000000000 x27: 0000000000000000
  [    3.740338] x26: ffff80008207f000 x25: ffff000b2eb2fd60 x24: ffff0000c0005700
  [    3.740982] x23: ffff8000804229e4 x22: ffff800082080000 x21: ffff800081756000
  [    3.741630] x20: fffffd7ff8253360 x19: 00000000000000a8 x18: ffffffffffffffff
  [    3.742274] x17: ffff800ab327f000 x16: ffff800083398000 x15: ffff800081756df0
  [    3.742919] x14: 0000000000000000 x13: 205d344320202020 x12: 5b5d373038343337
  [    3.743560] x11: ffff80008357b650 x10: 000000000000005d x9 : 00000000ffffffd0
  [    3.744231] x8 : 7f7f7f7f7f7f7f7f x7 : ffff80008237bad0 x6 : c0000000ffff7fff
  [    3.744907] x5 : ffff80008237ba78 x4 : ffff8000820bbad0 x3 : 0000000000000001
  [    3.745580] x2 : 68d66547c09f7800 x1 : 68d66547c09f7800 x0 : 0000000000000000
  [    3.746255] Call trace:
  [    3.746530]  kmem_cache_free+0x444/0x574
  [    3.746931]  mem_pool_free+0x44/0xf4
  [    3.747306]  free_object_rcu+0xc8/0xdc
  [    3.747693]  rcu_do_batch+0x234/0x8a4
  [    3.748075]  rcu_core+0x230/0x3e4
  [    3.748424]  rcu_core_si+0x14/0x1c
  [    3.748780]  handle_softirqs+0x134/0x378
  [    3.749189]  run_ksoftirqd+0x70/0x9c
  [    3.749560]  smpboot_thread_fn+0x148/0x22c
  [    3.749978]  kthread+0x10c/0x118
  [    3.750323]  ret_from_fork+0x10/0x20
  [    3.750696] ---[ end trace 0000000000000000 ]---
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-46789.json
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06095'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06129'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06137'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06124'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06125'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06115'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06117'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06158'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06178'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06198'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06248'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06157'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00028'
    scoring_system: epss
    scoring_elements: '0.06134'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07117'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.0696'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.05428'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06935'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07069'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07078'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07083'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07116'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07097'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07096'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07101'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07106'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07076'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.07057'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00039'
    scoring_system: epss
    scoring_elements: '0.08399'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09902'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10366'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10364'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10302'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.11287'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10484'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10429'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10377'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-46789
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-46789
weaknesses:
  - CWE-401
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-46789.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-46789
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2d476c86ba4745fcbc912ce4627df4fa80caa9ad
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ab7ca09520e9c41c219a4427fe0dae24024bfe7f
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2313137
    reference_type:
    reference_id: 2313137
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-46789
    reference_type:
    reference_id: CVE-2024-46789
