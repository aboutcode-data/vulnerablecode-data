vulnerability_id: VCID-q6s2-rbcx-aaaa
aliases:
  - CVE-2022-24791
  - GHSA-gwc9-348x-qwv2
summary: |
  Use After Free
  Wasmtime is a standalone JIT-style runtime for WebAssembly, using Cranelift. There is a use after free vulnerability in Wasmtime when both running Wasm that uses externrefs and enabling epoch interruption in Wasmtime. If you are not explicitly enabling epoch interruption (it is disabled by default) then you are not affected. If you are explicitly disabling the Wasm reference types proposal (it is enabled by default) then you are also not affected. The use after free is caused by Cranelift failing to emit stack maps when there are safepoints inside cold blocks. Cold blocks occur when epoch interruption is enabled. Cold blocks are emitted at the end of compiled functions, and change the order blocks are emitted versus defined. This reordering accidentally caused Cranelift to skip emitting some stack maps because it expected to emit the stack maps in block definition order, rather than block emission order. When Wasmtime would eventually collect garbage, it would fail to find live references on the stack because of the missing stack maps, think that they were unreferenced garbage, and therefore reclaim them. Then after the collection ended, the Wasm code could use the reclaimed-too-early references, which is a use after free. Patches have been released in versions 0.34.2 and 0.35.2, which fix the vulnerability. All Wasmtime users are recommended to upgrade to these patched versions. If upgrading is not an option for you at this time, you can avoid the vulnerability by either: disabling the Wasm reference types proposal, config.wasm_reference_types(false); or by disabling epoch interruption if you were previously enabling it. config.epoch_interruption(false).
severities:
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.29834'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.29996'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.30001'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.2999'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.29882'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.30028'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00141'
    scoring_system: epss
    scoring_elements: '0.30973'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00156'
    scoring_system: epss
    scoring_elements: '0.33107'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00156'
    scoring_system: epss
    scoring_elements: '0.33097'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00156'
    scoring_system: epss
    scoring_elements: '0.33143'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.60068'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.60063'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.60086'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.60114'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.60263'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.60224'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.59782'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.59943'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.60005'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.60021'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00213'
    scoring_system: epss
    scoring_elements: '0.60077'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00217'
    scoring_system: epss
    scoring_elements: '0.59385'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00217'
    scoring_system: epss
    scoring_elements: '0.59658'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00217'
    scoring_system: epss
    scoring_elements: '0.59359'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00235'
    scoring_system: epss
    scoring_elements: '0.62570'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00325'
    scoring_system: epss
    scoring_elements: '0.52603'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57941'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.5618'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.56166'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57853'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57895'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57942'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57969'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57983'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57929'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57924'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57927'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57935'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.5794'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.57953'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00373'
    scoring_system: epss
    scoring_elements: '0.5795'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00375'
    scoring_system: epss
    scoring_elements: '0.5636'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00375'
    scoring_system: epss
    scoring_elements: '0.56375'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '0.00545'
    scoring_system: epss
    scoring_elements: '0.50858'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
  - score: '8.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.epoch_interruption
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.epoch_interruption
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-gwc9-348x-qwv2
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime
  - score: '8.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime/commit/666c2554ea0e1728c35aa41178cf235920db888a
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime/commit/666c2554ea0e1728c35aa41178cf235920db888a
  - score: '8.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-gwc9-348x-qwv2
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-gwc9-348x-qwv2
  - score: '6.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:L/A:L
    published_at: None
    url: https://github.com/WebAssembly/reference-types
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/WebAssembly/reference-types
  - score: '6.8'
    scoring_system: cvssv2
    scoring_elements: AV:N/AC:M/Au:N/C:P/I:P/A:P
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-24791
  - score: '9.8'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-24791
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-24791
  - score: '8.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2022-0016.html
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2022-0016.html
weaknesses:
  - CWE-937
  - CWE-1035
  - CWE-416
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2022-24791
    reference_type:
    reference_id:
  - url: https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.epoch_interruption
    reference_type:
    reference_id:
  - url: https://github.com/bytecodealliance/wasmtime
    reference_type:
    reference_id:
  - url: https://github.com/bytecodealliance/wasmtime/commit/666c2554ea0e1728c35aa41178cf235920db888a
    reference_type:
    reference_id:
  - url: https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-gwc9-348x-qwv2
    reference_type:
    reference_id:
  - url: https://github.com/WebAssembly/reference-types
    reference_type:
    reference_id:
  - url: https://rustsec.org/advisories/RUSTSEC-2022-0016.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:a:bytecodealliance:wasmtime:*:*:*:*:*:rust:*:*
    reference_type:
    reference_id: cpe:2.3:a:bytecodealliance:wasmtime:*:*:*:*:*:rust:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-24791
    reference_type:
    reference_id: CVE-2022-24791
  - url: https://github.com/advisories/GHSA-gwc9-348x-qwv2
    reference_type:
    reference_id: GHSA-gwc9-348x-qwv2
