vulnerability_id: VCID-72ep-faks-aaae
aliases:
  - CVE-2024-26639
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mm, kmsan: fix infinite recursion due to RCU critical section

  Alexander Potapenko writes in [1]: "For every memory access in the code
  instrumented by KMSAN we call kmsan_get_metadata() to obtain the metadata
  for the memory being accessed.  For virtual memory the metadata pointers
  are stored in the corresponding `struct page`, therefore we need to call
  virt_to_page() to get them.

  According to the comment in arch/x86/include/asm/page.h,
  virt_to_page(kaddr) returns a valid pointer iff virt_addr_valid(kaddr) is
  true, so KMSAN needs to call virt_addr_valid() as well.

  To avoid recursion, kmsan_get_metadata() must not call instrumented code,
  therefore ./arch/x86/include/asm/kmsan.h forks parts of
  arch/x86/mm/physaddr.c to check whether a virtual address is valid or not.

  But the introduction of rcu_read_lock() to pfn_valid() added instrumented
  RCU API calls to virt_to_page_or_null(), which is called by
  kmsan_get_metadata(), so there is an infinite recursion now.  I do not
  think it is correct to stop that recursion by doing
  kmsan_enter_runtime()/kmsan_exit_runtime() in kmsan_get_metadata(): that
  would prevent instrumented functions called from within the runtime from
  tracking the shadow values, which might introduce false positives."

  Fix the issue by switching pfn_valid() to the _sched() variant of
  rcu_read_lock/unlock(), which does not require calling into RCU.  Given
  the critical section in pfn_valid() is very small, this is a reasonable
  trade-off (with preemptible RCU).

  KMSAN further needs to be careful to suppress calls into the scheduler,
  which would be another source of recursion.  This can be done by wrapping
  the call to pfn_valid() into preempt_disable/enable_no_resched().  The
  downside is that this sacrifices breaking scheduling guarantees; however,
  a kernel compiled with KMSAN has already given up any performance
  guarantees due to being heavily instrumented.

  Note, KMSAN code already disables tracing via Makefile, and since mmzone.h
  is included, it is not necessary to use the notrace variant, which is
  generally preferred in all other cases.
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-26639.json
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09902'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10302'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10364'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10366'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10377'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10429'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10484'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.11287'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
  - score: '4.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-400
  - CWE-674
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-26639.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-26639
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-26639
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5a33420599fa0288792537e6872fd19cc8607ea6
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6335c0cdb2ea0ea02c999e04d34fd84f69fb27ff
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/dc904345e3771aa01d0b8358b550802fdc6fe00b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f6564fce256a3944aa1bc76cb3c40e792d97c1eb
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2270102
    reference_type:
    reference_id: 2270102
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-26639
    reference_type:
    reference_id: CVE-2024-26639
