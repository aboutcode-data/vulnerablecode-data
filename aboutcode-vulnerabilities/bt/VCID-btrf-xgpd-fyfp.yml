vulnerability_id: VCID-btrf-xgpd-fyfp
aliases:
  - CVE-2024-44952
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  driver core: Fix uevent_show() vs driver detach race

  uevent_show() wants to de-reference dev->driver->name. There is no clean
  way for a device attribute to de-reference dev->driver unless that
  attribute is defined via (struct device_driver).dev_groups. Instead, the
  anti-pattern of taking the device_lock() in the attribute handler risks
  deadlocks with code paths that remove device attributes while holding
  the lock.

  This deadlock is typically invisible to lockdep given the device_lock()
  is marked lockdep_set_novalidate_class(), but some subsystems allocate a
  local lockdep key for @dev->mutex to reveal reports of the form:

   ======================================================
   WARNING: possible circular locking dependency detected
   6.10.0-rc7+ #275 Tainted: G           OE    N
   ------------------------------------------------------
   modprobe/2374 is trying to acquire lock:
   ffff8c2270070de0 (kn->active#6){++++}-{0:0}, at: __kernfs_remove+0xde/0x220

   but task is already holding lock:
   ffff8c22016e88f8 (&cxl_root_key){+.+.}-{3:3}, at: device_release_driver_internal+0x39/0x210

   which lock already depends on the new lock.

   the existing dependency chain (in reverse order) is:

   -> #1 (&cxl_root_key){+.+.}-{3:3}:
          __mutex_lock+0x99/0xc30
          uevent_show+0xac/0x130
          dev_attr_show+0x18/0x40
          sysfs_kf_seq_show+0xac/0xf0
          seq_read_iter+0x110/0x450
          vfs_read+0x25b/0x340
          ksys_read+0x67/0xf0
          do_syscall_64+0x75/0x190
          entry_SYSCALL_64_after_hwframe+0x76/0x7e

   -> #0 (kn->active#6){++++}-{0:0}:
          __lock_acquire+0x121a/0x1fa0
          lock_acquire+0xd6/0x2e0
          kernfs_drain+0x1e9/0x200
          __kernfs_remove+0xde/0x220
          kernfs_remove_by_name_ns+0x5e/0xa0
          device_del+0x168/0x410
          device_unregister+0x13/0x60
          devres_release_all+0xb8/0x110
          device_unbind_cleanup+0xe/0x70
          device_release_driver_internal+0x1c7/0x210
          driver_detach+0x47/0x90
          bus_remove_driver+0x6c/0xf0
          cxl_acpi_exit+0xc/0x11 [cxl_acpi]
          __do_sys_delete_module.isra.0+0x181/0x260
          do_syscall_64+0x75/0x190
          entry_SYSCALL_64_after_hwframe+0x76/0x7e

  The observation though is that driver objects are typically much longer
  lived than device objects. It is reasonable to perform lockless
  de-reference of a @driver pointer even if it is racing detach from a
  device. Given the infrequency of driver unregistration, use
  synchronize_rcu() in module_remove_driver() to close any potential
  races.  It is potentially overkill to suffer synchronize_rcu() just to
  handle the rare module removal racing uevent_show() event.

  Thanks to Tetsuo Handa for the debug analysis of the syzbot report [1].
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-44952.json
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05128'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.11287'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10302'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10364'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10366'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10377'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10429'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10484'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-44952
weaknesses:
  - CWE-667
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-44952.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-44952
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-44952
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/15fffc6a5624b13b428bb1c6e9088e32a55eb82c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/49ea4e0d862632d51667da5e7a9c88a560e9c5a1
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4a7c2a8387524942171037e70b80e969c3b5c05b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4d035c743c3e391728a6f81cbf0f7f9ca700cf62
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9c23fc327d6ec67629b4ad323bd64d3834c0417d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cd490a247ddf325325fd0de8898659400c9237ef
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/dd98c9630b7ee273da87e9a244f94ddf947161e2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f098e8fc7227166206256c18d56ab622039108b1
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2309783
    reference_type:
    reference_id: 2309783
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-44952
    reference_type:
    reference_id: CVE-2024-44952
  - url: https://usn.ubuntu.com/7088-1/
    reference_type:
    reference_id: USN-7088-1
  - url: https://usn.ubuntu.com/7088-2/
    reference_type:
    reference_id: USN-7088-2
  - url: https://usn.ubuntu.com/7088-3/
    reference_type:
    reference_id: USN-7088-3
  - url: https://usn.ubuntu.com/7088-4/
    reference_type:
    reference_id: USN-7088-4
  - url: https://usn.ubuntu.com/7088-5/
    reference_type:
    reference_id: USN-7088-5
  - url: https://usn.ubuntu.com/7100-1/
    reference_type:
    reference_id: USN-7100-1
  - url: https://usn.ubuntu.com/7100-2/
    reference_type:
    reference_id: USN-7100-2
