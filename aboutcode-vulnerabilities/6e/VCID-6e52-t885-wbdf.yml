vulnerability_id: VCID-6e52-t885-wbdf
aliases:
  - GHSA-fj2x-735w-74vq
summary: "gnark-crypto allows unchecked memory allocation during vector deserialization\nThe\
  \ issue has been reported by @raefko from @fuzzinglabs. Excerpts from the report:\n> A critical\
  \ vulnerability exists in the gnark-crypto library's `Vector.ReadFrom()` function that allows\
  \ an attacker to trigger arbitrary memory allocation by crafting malicious input data. An\
  \ attacker can cause the verifier to attempt allocating up to 128 GB of memory with a minimal\
  \ malicious input, leading to out-of-memory crashes and denial of service.\n> ### **Root Cause**\n\
  > \n> \n> The vulnerability stems from **unchecked deserialization** of attacker-controlled\
  \ length fields in the gnark-crypto library's `Vector.ReadFrom()` function. The function reads\
  \ a 4-byte unsigned integer from untrusted input and directly uses it to allocate memory without\
  \ any validation or bounds checking.\n> \n> ### **Vulnerable Code Path**\n> \n> ```\n> User\
  \ Input (Malicious Proof/Data)\n>          ↓\n> gnark Proof/Data Deserialization\n>      \
  \    ↓\n> Vector.ReadFrom() (ecc/bn254/fr/vector.go:136-144)\n>   → sliceLen := binary.BigEndian.Uint32(buf[:4])\
  \   // ← ATTACKER-CONTROLLED\n>   → (*vector) = make(Vector, sliceLen)             // ← UNCHECKED\
  \ ALLOCATION\n>          ↓\n> runtime.makeslice attempts 100+ GB allocation\n>          ↓\n\
  > fatal error: runtime: out of memory → SIGABRT\n> \n> ```\n>\n> ### **Vulnerable Code**\n\
  > \n> **File**: [`gnark-crypto@v0.14.0+/ecc/bn254/fr/vector.go:136-144`](https://github.com/Consensys/gnark-crypto/blob/8310aae2de6104d3fe3610e3370b2bed10c63111/ecc/bn254/fr/vector.go#L136)\n\
  > \n> The code reads a 4-byte big-endian unsigned integer (`sliceLen`) directly from the input\
  \ stream and uses it to allocate a slice without any bounds checking or validation. Each element\
  \ is 32 bytes (fr.Element for BN254 curve), so an attacker can request up to:\n> \n> **Maximum\
  \ Allocation**: `2^32 elements × 32 bytes = 137,438,953,472 bytes ≈ 128 GB`\n> \n> ## **Root\
  \ Cause Analysis**\n> \n> The gnark-crypto library implements a generic serialization format\
  \ for field element vectors. The format is:\n> \n> ```\n> [4 bytes: length (n)] [n × 32 bytes:\
  \ elements]\n> ```\n> \n> The deserialization code **trusts** the length field implicitly\
  \ without any validation. This is a classic **integer-to-allocation vulnerability** pattern,\
  \ similar to issues that have affected many serialization libraries over the years.\n\n###\
  \ Impact\n\nThe issue impacts users deserializing vectors directly from untrusted sources.\
  \ In case of malicious input it would lead to OOM in case the server doesn't have sufficient\
  \ memory (depending on the field, but could allocate from 32GB to 196GB).\n\n### Patches\n\
  \nThe issue is patched in https://github.com/Consensys/gnark-crypto/pull/759. It will be backported\
  \ to gnark-crypto v0.18 and v0.19.\n\n### Workarounds\n\nThe user could manually peek into\
  \ the first 4 bytes of the serialized data to estimate if the header would allocate large\
  \ amounts of memory."
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/Consensys/gnark-crypto
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Consensys/gnark-crypto
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/Consensys/gnark-crypto/commit/2e7bf9190a0aac896eeec3876c87c77a35661be7
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Consensys/gnark-crypto/commit/2e7bf9190a0aac896eeec3876c87c77a35661be7
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/Consensys/gnark-crypto/pull/759
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Consensys/gnark-crypto/pull/759
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/Consensys/gnark-crypto/security/advisories/GHSA-fj2x-735w-74vq
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Consensys/gnark-crypto/security/advisories/GHSA-fj2x-735w-74vq
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://pkg.go.dev/vuln/GO-2025-4087
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://pkg.go.dev/vuln/GO-2025-4087
weaknesses:
  - CWE-400
references:
  - url: https://github.com/Consensys/gnark-crypto
    reference_type:
    reference_id:
  - url: https://github.com/Consensys/gnark-crypto/commit/2e7bf9190a0aac896eeec3876c87c77a35661be7
    reference_type:
    reference_id:
  - url: https://github.com/Consensys/gnark-crypto/pull/759
    reference_type:
    reference_id:
  - url: https://github.com/Consensys/gnark-crypto/security/advisories/GHSA-fj2x-735w-74vq
    reference_type:
    reference_id:
  - url: https://pkg.go.dev/vuln/GO-2025-4087
    reference_type:
    reference_id:
