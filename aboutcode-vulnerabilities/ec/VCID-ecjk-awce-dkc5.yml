vulnerability_id: VCID-ecjk-awce-dkc5
aliases:
  - CVE-2025-39821
summary: 'In the Linux kernel, the following vulnerability has been resolved:  perf: Avoid undefined
  behavior from stopping/starting inactive events  Calling pmu->start()/stop() on perf events
  in PERF_EVENT_STATE_OFF can leave event->hw.idx at -1. When PMU drivers later attempt to use
  this negative index as a shift exponent in bitwise operations, it leads to UBSAN shift-out-of-bounds
  reports.  The issue is a logical flaw in how event groups handle throttling when some members
  are intentionally disabled. Based on the analysis and the reproducer provided by Mark Rutland
  (this issue on both arm64 and x86-64).  The scenario unfolds as follows:   1. A group leader
  event is configured with a very aggressive sampling     period (e.g., sample_period = 1).
  This causes frequent interrupts and     triggers the throttling mechanism.  2. A child event
  in the same group is created in a disabled state     (.disabled = 1). This event remains in
  PERF_EVENT_STATE_OFF.     Since it hasn''t been scheduled onto the PMU, its event->hw.idx
  remains     initialized at -1.  3. When throttling occurs, perf_event_throttle_group() and
  later     perf_event_unthrottle_group() iterate through all siblings, including     the disabled
  child event.  4. perf_event_throttle()/unthrottle() are called on this inactive child     event,
  which then call event->pmu->start()/stop().  5. The PMU driver receives the event with hw.idx
  == -1 and attempts to     use it as a shift exponent. e.g., in macros like PMCNTENSET(idx),     leading
  to the UBSAN report.  The throttling mechanism attempts to start/stop events that are not
  actively scheduled on the hardware.  Move the state check into perf_event_throttle()/perf_event_unthrottle()
  so that inactive events are skipped entirely. This ensures only active events with a valid
  hw.idx are processed, preventing undefined behavior and silencing UBSAN warnings. The corrected
  check ensures true before proceeding with PMU operations.  The problem can be reproduced with
  the syzkaller reproducer:'
severities:
  - score: '7.0'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-39821.json
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03304'
    published_at: '2025-09-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03233'
    published_at: '2025-09-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03261'
    published_at: '2025-09-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00019'
    scoring_system: epss
    scoring_elements: '0.04336'
    published_at: '2026-01-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00019'
    scoring_system: epss
    scoring_elements: '0.04347'
    published_at: '2026-01-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05107'
    published_at: '2025-09-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05268'
    published_at: '2025-10-01 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05271'
    published_at: '2025-10-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05307'
    published_at: '2025-10-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05221'
    published_at: '2025-10-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05206'
    published_at: '2025-10-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05277'
    published_at: '2025-10-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05283'
    published_at: '2025-10-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05297'
    published_at: '2025-10-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05275'
    published_at: '2025-10-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05228'
    published_at: '2025-10-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04968'
    published_at: '2025-09-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04977'
    published_at: '2025-09-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04965'
    published_at: '2025-09-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05098'
    published_at: '2025-09-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05105'
    published_at: '2025-09-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05958'
    published_at: '2025-10-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05946'
    published_at: '2025-10-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05952'
    published_at: '2025-10-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05934'
    published_at: '2025-10-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.0593'
    published_at: '2025-10-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05912'
    published_at: '2025-10-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.0604'
    published_at: '2025-11-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.06016'
    published_at: '2025-11-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '0.00026'
    scoring_system: epss
    scoring_elements: '0.05978'
    published_at: '2025-10-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses: []
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-39821.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2025-39821
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2395793
    reference_type:
    reference_id: 2395793
