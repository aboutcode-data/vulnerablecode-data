vulnerability_id: VCID-5xdz-ybf2-aaad
aliases:
  - GHSA-fvv5-h29g-f6w5
summary: |
  User with ci:ReadAction permissions and write permissions to one path in a repository may copy objects from any path in the repository
  ### Impact

  A bug in permissions validation allows a user with the `ci:ReadAction` permission to skip read checks when copying an object.  If they additionally have read and write permission to path in the repository, they can copy an otherwise unreadable object and read it.

  In order to be affected and exploitable, the following conditions must ALL occur on the same user:
  1. `ci:ReadAction` enabled for the repository.  Predefined policies RepoManagementRead and RepoManagementFullAccess allow this action.
  2. `fs:ReadObject` and `fs:WriteObject` enabled for some path.
  3. `fs:ReadObject` _not_ available for some path

  Such a user can use (1) to copy the unreadable object (3) to a path that they can read and write (2).  At that point they can read the object copy.

  ### Patches

  Releases >= 1.12.1 fix this issue in lakeFS.

  ### Workarounds

  As a workaround, use RBAC to deny `ci:*` permissions to all users, or to all users who have limited read access.

  Many installations are unaffected:

  * **Installations using ACLs are _not_ affected.** This includes all OSS installations that have not implemented an external authorization server.  We do not know of any OSS installations that have implemented such a server.  ACLs that allow ci:ReadAction also allow reading repositories, so no capabilities are granted.
  * **Installations using RBAC that use only predefined policies with "all" ARNs ("*") are _not_ affected.**  This includes **all installations that have not defined any new groups in RBAC.**

  In order to be affected, **installations using RBAC** must define users and simultaneous allow `ci:ReadAction` and disallow `fs:ReadObject` for some path.  `ci:ReadAction` is available in policies RepoManagementReadAll and RepoManagementFullAccess.  By default these actions are configured for groups Developers and above, for all repositories and paths.


  ### References

  * [lakeFS RBAC](https://docs.lakefs.io/reference/security/rbac.html)
severities:
  - score: '5.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/treeverse/lakeFS
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/treeverse/lakeFS
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/treeverse/lakeFS/commit/56556ee5406fc5425b9302cd08a8d412635fdcd7
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/treeverse/lakeFS/commit/56556ee5406fc5425b9302cd08a8d412635fdcd7
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/treeverse/lakeFS/security/advisories/GHSA-fvv5-h29g-f6w5
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/treeverse/lakeFS/security/advisories/GHSA-fvv5-h29g-f6w5
weaknesses: []
references:
  - url: https://github.com/treeverse/lakeFS
    reference_type:
    reference_id:
  - url: https://github.com/treeverse/lakeFS/commit/56556ee5406fc5425b9302cd08a8d412635fdcd7
    reference_type:
    reference_id:
  - url: https://github.com/treeverse/lakeFS/security/advisories/GHSA-fvv5-h29g-f6w5
    reference_type:
    reference_id:
