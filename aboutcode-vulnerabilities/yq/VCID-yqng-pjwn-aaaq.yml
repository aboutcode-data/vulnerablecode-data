vulnerability_id: VCID-yqng-pjwn-aaaq
aliases:
  - GHSA-58j9-j2fj-v8f4
summary: |
  SurrealDB vulnerable to Uncontrolled CPU Consumption via WebSocket Interface
  SurrealDB depends on the `tungstenite` and `tokio-tungstenite` crates used by the `axum` crate, which handles connections to the SurrealDB WebSocket interface. On versions before `0.20.1`, the `tungstenite` crate presented an issue which allowed the parsing of HTTP headers during the client handshake to continuously consume high CPU when the headers were very long. All affected crates have been updated in SurrealDB version `1.1.0`.

  From the original advisory for [CVE-2023-43669](https://nvd.nist.gov/vuln/detail/CVE-2023-43669):
  "The Tungstenite crate through 0.20.0 for Rust allows remote attackers to cause a denial of service (minutes of CPU consumption) via an excessive length of an HTTP header in a client handshake. The length affects both how many times a parse is attempted (e.g., thousands of times) and the average amount of data for each parse attempt (e.g., millions of bytes)."

  ### Impact

  A remote unauthenticated attacker may cause a SurrealDB server that exposes its WebSocket interface to consume high CPU by sending an HTTP request with a very long header to the WebSocket interface, potentially leading to denial of service.

  ### Patches

  - Version 1.1.0 and later are not affected by this issue.

  ### Workarounds

  Users unable to update may be able to limit access to the WebSocket interface (i.e. the `/rpc` endpoint) via reverse proxy if not in use or only used by a limited number of trusted clients. Alternatively, a reverse proxy may be used to strip or truncate request headers exceeding a reasonable length before reaching the SurrealDB server.

  ### References

  - #2807
  - https://nvd.nist.gov/vuln/detail/CVE-2023-43669
  - https://rustsec.org/advisories/RUSTSEC-2023-0065.html
  - https://github.com/snapview/tungstenite-rs/issues/376
severities:
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-58j9-j2fj-v8f4
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/snapview/tungstenite-rs/issues/376
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/snapview/tungstenite-rs/issues/376
  - score: '6.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/surrealdb/surrealdb
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/surrealdb/surrealdb
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/surrealdb/surrealdb/commit/87859158d3750b03564613de70b5ec4ae090549d
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/surrealdb/surrealdb/commit/87859158d3750b03564613de70b5ec4ae090549d
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/surrealdb/surrealdb/pull/2807
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/surrealdb/surrealdb/pull/2807
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/surrealdb/surrealdb/security/advisories/GHSA-58j9-j2fj-v8f4
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/surrealdb/surrealdb/security/advisories/GHSA-58j9-j2fj-v8f4
  - score: '7.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-43669
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-43669
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2023-0065.html
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2023-0065.html
weaknesses: []
references:
  - url: https://github.com/snapview/tungstenite-rs/issues/376
    reference_type:
    reference_id:
  - url: https://github.com/surrealdb/surrealdb
    reference_type:
    reference_id:
  - url: https://github.com/surrealdb/surrealdb/commit/87859158d3750b03564613de70b5ec4ae090549d
    reference_type:
    reference_id:
  - url: https://github.com/surrealdb/surrealdb/pull/2807
    reference_type:
    reference_id:
  - url: https://github.com/surrealdb/surrealdb/security/advisories/GHSA-58j9-j2fj-v8f4
    reference_type:
    reference_id:
  - url: https://rustsec.org/advisories/RUSTSEC-2023-0065.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-43669
    reference_type:
    reference_id: CVE-2023-43669
  - url: https://github.com/advisories/GHSA-58j9-j2fj-v8f4
    reference_type:
    reference_id: GHSA-58j9-j2fj-v8f4
