vulnerability_id: VCID-e12g-dqss-aaah
aliases:
  - CVE-2024-35804
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  KVM: x86: Mark target gfn of emulated atomic instruction as dirty

  When emulating an atomic access on behalf of the guest, mark the target
  gfn dirty if the CMPXCHG by KVM is attempted and doesn't fault.  This
  fixes a bug where KVM effectively corrupts guest memory during live
  migration by writing to guest memory without informing userspace that the
  page is dirty.

  Marking the page dirty got unintentionally dropped when KVM's emulated
  CMPXCHG was converted to do a user access.  Before that, KVM explicitly
  mapped the guest page into kernel memory, and marked the page dirty during
  the unmap phase.

  Mark the page dirty even if the CMPXCHG fails, as the old data is written
  back on failure, i.e. the page is still written.  The value written is
  guaranteed to be the same because the operation is atomic, but KVM's ABI
  is that all writes are dirty logged regardless of the value written.  And
  more importantly, that's what KVM did before the buggy commit.

  Huge kudos to the folks on the Cc list (and many others), who did all the
  actual work of triaging and debugging.

  base-commit: 6769ea8da8a93ed4630f1ce64df6aafcaabfce64
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-35804.json
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16666'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16947'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17041'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17069'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17147'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17142'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17732'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17830'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17350'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17315'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17624'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17338'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35207'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.3516'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35223'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35292'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35336'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35343'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35256'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35244'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35246'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35245'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35263'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35255'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.0014'
    scoring_system: epss
    scoring_elements: '0.35228'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38427'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38368'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38335'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38428'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38401'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38297'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38263'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38373'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38384'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38411'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38381'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38359'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38374'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00193'
    scoring_system: epss
    scoring_elements: '0.38398'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '0.00812'
    scoring_system: epss
    scoring_elements: '0.59383'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses: []
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-35804.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-35804
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/225d587a073584946c05c9b7651d637bd45c0c71
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/726374dde5d608b15b9756bd52b6fc283fda7a06
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/910c57dfa4d113aae6571c2a8b9ae8c430975902
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9d1b22e573a3789ed1f32033ee709106993ba551
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a9bd6bb6f02bf7132c1ab192ba62bbfa52df7d66
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2281227
    reference_type:
    reference_id: 2281227
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-35804
    reference_type:
    reference_id: CVE-2024-35804
  - url: https://usn.ubuntu.com/6898-1/
    reference_type:
    reference_id: USN-6898-1
  - url: https://usn.ubuntu.com/6898-2/
    reference_type:
    reference_id: USN-6898-2
  - url: https://usn.ubuntu.com/6898-3/
    reference_type:
    reference_id: USN-6898-3
  - url: https://usn.ubuntu.com/6898-4/
    reference_type:
    reference_id: USN-6898-4
  - url: https://usn.ubuntu.com/6917-1/
    reference_type:
    reference_id: USN-6917-1
  - url: https://usn.ubuntu.com/6919-1/
    reference_type:
    reference_id: USN-6919-1
  - url: https://usn.ubuntu.com/6927-1/
    reference_type:
    reference_id: USN-6927-1
  - url: https://usn.ubuntu.com/7019-1/
    reference_type:
    reference_id: USN-7019-1
