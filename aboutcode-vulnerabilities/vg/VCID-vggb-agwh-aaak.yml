vulnerability_id: VCID-vggb-agwh-aaak
aliases:
  - GHSA-rm8v-mxj3-5rmq
summary: |
  github.com/lestrrat-go/jwx vulnerable to Potential Padding Oracle Attack
  ### Summary

  Decrypting AES-CBC encrypted JWE has Potential Padding Oracle Attack Vulnerability.

  ### Details

  On [v2.0.10](https://github.com/lestrrat-go/jwx/releases/tag/v2.0.10), decrypting AES-CBC encrypted JWE may return an error "failed to generate plaintext from decrypted blocks: invalid padding":

  https://github.com/lestrrat-go/jwx/blob/8840ffd4afc5839f591ff0e9ba9034af52b1643e/jwe/internal/aescbc/aescbc.go#L210-L213

  Reporting padding error causes [Padding Oracle Attack](https://en.wikipedia.org/wiki/Padding_oracle_attack) Vulnerability.
  RFC 7516 JSON Web Encryption (JWE) says that we **MUST NOT** do this.

  > 11.5.  Timing Attacks
  > To mitigate the attacks described in RFC 3218 [RFC3218], the
  > recipient MUST NOT distinguish between format, padding, and length
  > errors of encrypted keys.  It is strongly recommended, in the event
  > of receiving an improperly formatted key, that the recipient
  > substitute a randomly generated CEK and proceed to the next step, to
  > mitigate timing attacks.

  In addition, the time to remove padding depends on the length of the padding.
  It may leak the length of the padding by Timing Attacks.

  https://github.com/lestrrat-go/jwx/blob/796b2a9101cf7e7cb66455e4d97f3c158ee10904/jwe/internal/aescbc/aescbc.go#L33-L66

  To mitigate Timing Attacks, it MUST be done in constant time.

  ### Impact

  The authentication tag is verified, so it is not an immediate attack.
severities:
  - score: '6.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:N/I:N/A:H
    published_at: None
    url: https://github.com/lestrrat-go/jwx
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/lestrrat-go/jwx
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/lestrrat-go/jwx/blob/796b2a9101cf7e7cb66455e4d97f3c158ee10904/jwe/internal/aescbc/aescbc.go#L33-L66
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/lestrrat-go/jwx/blob/8840ffd4afc5839f591ff0e9ba9034af52b1643e/jwe/internal/aescbc/aescbc.go#L210-L213
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/lestrrat-go/jwx/commit/6c41e3822485fc7e11dd70b4b0524b075d66b103
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/lestrrat-go/jwx/commit/d9ddbc8e5009cfdd8c28413390b67afa7f576dd6
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/lestrrat-go/jwx/security/advisories/GHSA-rm8v-mxj3-5rmq
weaknesses: []
references:
  - url: https://github.com/lestrrat-go/jwx
    reference_type:
    reference_id:
  - url: https://github.com/lestrrat-go/jwx/blob/796b2a9101cf7e7cb66455e4d97f3c158ee10904/jwe/internal/aescbc/aescbc.go#L33-L66
    reference_type:
    reference_id:
  - url: https://github.com/lestrrat-go/jwx/blob/8840ffd4afc5839f591ff0e9ba9034af52b1643e/jwe/internal/aescbc/aescbc.go#L210-L213
    reference_type:
    reference_id:
  - url: https://github.com/lestrrat-go/jwx/commit/6c41e3822485fc7e11dd70b4b0524b075d66b103
    reference_type:
    reference_id:
  - url: https://github.com/lestrrat-go/jwx/commit/d9ddbc8e5009cfdd8c28413390b67afa7f576dd6
    reference_type:
    reference_id:
  - url: https://github.com/lestrrat-go/jwx/security/advisories/GHSA-rm8v-mxj3-5rmq
    reference_type:
    reference_id:
