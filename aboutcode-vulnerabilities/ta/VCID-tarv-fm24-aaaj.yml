vulnerability_id: VCID-tarv-fm24-aaaj
aliases:
  - CVE-2021-39218
  - GHSA-4873-36h9-wv49
  - PYSEC-2021-321
summary: Wasmtime is an open source runtime for WebAssembly & WASI. In Wasmtime from version
  0.26.0 and before version 0.30.0 is affected by a memory unsoundness vulnerability. There
  was an invalid free and out-of-bounds read and write bug when running Wasm that uses `externref`s
  in Wasmtime. To trigger this bug, Wasmtime needs to be running Wasm that uses `externref`s,
  the host creates non-null `externrefs`, Wasmtime performs a garbage collection (GC), and there
  has to be a Wasm frame on the stack that is at a GC safepoint where there are no live references
  at this safepoint, and there is a safepoint with live references earlier in this frame's function.
  Under this scenario, Wasmtime would incorrectly use the GC stack map for the safepoint from
  earlier in the function instead of the empty safepoint. This would result in Wasmtime treating
  arbitrary stack slots as `externref`s that needed to be rooted for GC. At the *next* GC, it
  would be determined that nothing was referencing these bogus `externref`s (because nothing
  could ever reference them, because they are not really `externref`s) and then Wasmtime would
  deallocate them and run `<ExternRef as Drop>::drop` on them. This results in a free of memory
  that is not necessarily on the heap (and shouldn't be freed at this moment even if it was),
  as well as potential out-of-bounds reads and writes. Even though support for `externref`s
  (via the reference types proposal) is enabled by default, unless you are creating non-null
  `externref`s in your host code or explicitly triggering GCs, you cannot be affected by this
  bug. We have reason to believe that the effective impact of this bug is relatively small because
  usage of `externref` is currently quite rare. This bug has been patched and users should upgrade
  to Wasmtime version 0.30.0. If you cannot upgrade Wasmtime at this time, you can avoid this
  bug by disabling the reference types proposal by passing `false` to `wasmtime::Config::wasm_reference_types`.
severities:
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15160'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16055'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15763'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15731'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15736'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16138'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16046'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15995'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15737'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15664'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15610'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15619'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15555'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15527'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.15440'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26664'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.22669'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26622'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26686'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26731'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26774'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26777'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26732'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26712'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26694'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26691'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26689'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26707'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.2669'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00089'
    scoring_system: epss
    scoring_elements: '0.26672'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.37013'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.37052'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.37056'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.37078'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.37046'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.3703'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.37016'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.37053'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.37083'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.3708'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.37054'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.36963'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.36926'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00183'
    scoring_system: epss
    scoring_elements: '0.37042'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '0.00226'
    scoring_system: epss
    scoring_elements: '0.30798'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://crates.io/crates/wasmtime
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://crates.io/crates/wasmtime
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-4873-36h9-wv49
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime/commit/398a73f0dd862dbe703212ebae8e34036a18c11c
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime/commit/398a73f0dd862dbe703212ebae8e34036a18c11c
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime-py/compare/0.29.0...0.30.0
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime-py/compare/0.29.0...0.30.0
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-4873-36h9-wv49
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-4873-36h9-wv49
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-4873-36h9-wv49
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://github.com/pypa/advisory-database/tree/main/vulns/wasmtime/PYSEC-2021-321.yaml
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/pypa/advisory-database/tree/main/vulns/wasmtime/PYSEC-2021-321.yaml
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/WAVBRYDDUIY2ZR3K3FO4BVYJKIMJ5TP7
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/WAVBRYDDUIY2ZR3K3FO4BVYJKIMJ5TP7
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/Z2Z33FTXFQ6EOINVEQIP4DFBG53G5XIY
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/Z2Z33FTXFQ6EOINVEQIP4DFBG53G5XIY
  - score: '3.3'
    scoring_system: cvssv2
    scoring_elements: AV:L/AC:M/Au:N/C:N/I:P/A:P
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-39218
  - score: '6.3'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-39218
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-39218
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-39218
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2021-0110.html
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2021-0110.html
weaknesses:
  - CWE-590
  - CWE-125
  - CWE-937
  - CWE-1035
  - CWE-787
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-39218
    reference_type:
    reference_id:
  - url: https://crates.io/crates/wasmtime
    reference_type:
    reference_id:
  - url: https://github.com/bytecodealliance/wasmtime
    reference_type:
    reference_id:
  - url: https://github.com/bytecodealliance/wasmtime/commit/398a73f0dd862dbe703212ebae8e34036a18c11c
    reference_type:
    reference_id:
  - url: https://github.com/bytecodealliance/wasmtime-py/compare/0.29.0...0.30.0
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/wasmtime/PYSEC-2021-321.yaml
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/WAVBRYDDUIY2ZR3K3FO4BVYJKIMJ5TP7/
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/Z2Z33FTXFQ6EOINVEQIP4DFBG53G5XIY/
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/WAVBRYDDUIY2ZR3K3FO4BVYJKIMJ5TP7
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/WAVBRYDDUIY2ZR3K3FO4BVYJKIMJ5TP7/
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/Z2Z33FTXFQ6EOINVEQIP4DFBG53G5XIY
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/Z2Z33FTXFQ6EOINVEQIP4DFBG53G5XIY/
    reference_type:
    reference_id:
  - url: https://rustsec.org/advisories/RUSTSEC-2021-0110.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:a:bytecodealliance:wasmtime:*:*:*:*:*:rust:*:*
    reference_type:
    reference_id: cpe:2.3:a:bytecodealliance:wasmtime:*:*:*:*:*:rust:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:fedoraproject:fedora:34:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:fedoraproject:fedora:34:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:fedoraproject:fedora:35:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:fedoraproject:fedora:35:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-39218
    reference_type:
    reference_id: CVE-2021-39218
  - url: https://github.com/advisories/GHSA-4873-36h9-wv49
    reference_type:
    reference_id: GHSA-4873-36h9-wv49
  - url: https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-4873-36h9-wv49
    reference_type:
    reference_id: GHSA-4873-36h9-wv49
