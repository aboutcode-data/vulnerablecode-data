vulnerability_id: VCID-auhf-u8d8-aaaa
aliases:
  - CVE-2024-35871
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  riscv: process: Fix kernel gp leakage

  childregs represents the registers which are active for the new thread
  in user context. For a kernel thread, childregs->gp is never used since
  the kernel gp is not touched by switch_to. For a user mode helper, the
  gp value can be observed in user space after execve or possibly by other
  means.

  [From the email thread]

  The /* Kernel thread */ comment is somewhat inaccurate in that it is also used
  for user_mode_helper threads, which exec a user process, e.g. /sbin/init or
  when /proc/sys/kernel/core_pattern is a pipe. Such threads do not have
  PF_KTHREAD set and are valid targets for ptrace etc. even before they exec.

  childregs is the *user* context during syscall execution and it is observable
  from userspace in at least five ways:

  1. kernel_execve does not currently clear integer registers, so the starting
     register state for PID 1 and other user processes started by the kernel has
     sp = user stack, gp = kernel __global_pointer$, all other integer registers
     zeroed by the memset in the patch comment.

     This is a bug in its own right, but I'm unwilling to bet that it is the only
     way to exploit the issue addressed by this patch.

  2. ptrace(PTRACE_GETREGSET): you can PTRACE_ATTACH to a user_mode_helper thread
     before it execs, but ptrace requires SIGSTOP to be delivered which can only
     happen at user/kernel boundaries.

  3. /proc/*/task/*/syscall: this is perfectly happy to read pt_regs for
     user_mode_helpers before the exec completes, but gp is not one of the
     registers it returns.

  4. PERF_SAMPLE_REGS_USER: LOCKDOWN_PERF normally prevents access to kernel
     addresses via PERF_SAMPLE_REGS_INTR, but due to this bug kernel addresses
     are also exposed via PERF_SAMPLE_REGS_USER which is permitted under
     LOCKDOWN_PERF. I have not attempted to write exploit code.

  5. Much of the tracing infrastructure allows access to user registers. I have
     not attempted to determine which forms of tracing allow access to user
     registers without already allowing access to kernel registers.
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-35871.json
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11214'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11518'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11609'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11632'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11700'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11696'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11709'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11764'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11819'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12119'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12177'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12271'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11828'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11841'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12225'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11891'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40547'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40556'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40624'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40686'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40722'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.4061'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40601'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40611'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40606'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40598'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40615'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00182'
    scoring_system: epss
    scoring_elements: '0.40582'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45827'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45864'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45835'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45806'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.4585'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45701'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45672'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45805'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.4581'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45818'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45836'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45822'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.00252'
    scoring_system: epss
    scoring_elements: '0.45784'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '0.01141'
    scoring_system: epss
    scoring_elements: '0.65416'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses: []
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-35871.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-35871
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-35871
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/00effef72c98294edb1efa87ffa0f6cfb61b36a4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9abc3e6f1116adb7a2d4fbb8ce20c37916976bf5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d14fa1fcf69db9d070e75f1c4425211fa619dfc8
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d8dcba0691b8e42bddb61aab201e4d918a08e5d9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/dff6072124f6df77bfd36951fbd88565746980ef
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f6583444d7e78dae750798552b65a2519ff3ca84
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2024/06/msg00017.html
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2281738
    reference_type:
    reference_id: 2281738
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-35871
    reference_type:
    reference_id: CVE-2024-35871
  - url: https://usn.ubuntu.com/6893-1/
    reference_type:
    reference_id: USN-6893-1
  - url: https://usn.ubuntu.com/6893-2/
    reference_type:
    reference_id: USN-6893-2
  - url: https://usn.ubuntu.com/6893-3/
    reference_type:
    reference_id: USN-6893-3
  - url: https://usn.ubuntu.com/6898-1/
    reference_type:
    reference_id: USN-6898-1
  - url: https://usn.ubuntu.com/6898-2/
    reference_type:
    reference_id: USN-6898-2
  - url: https://usn.ubuntu.com/6898-3/
    reference_type:
    reference_id: USN-6898-3
  - url: https://usn.ubuntu.com/6898-4/
    reference_type:
    reference_id: USN-6898-4
  - url: https://usn.ubuntu.com/6917-1/
    reference_type:
    reference_id: USN-6917-1
  - url: https://usn.ubuntu.com/6918-1/
    reference_type:
    reference_id: USN-6918-1
  - url: https://usn.ubuntu.com/6919-1/
    reference_type:
    reference_id: USN-6919-1
  - url: https://usn.ubuntu.com/6927-1/
    reference_type:
    reference_id: USN-6927-1
  - url: https://usn.ubuntu.com/7019-1/
    reference_type:
    reference_id: USN-7019-1
