vulnerability_id: VCID-zapd-anqh-87de
aliases:
  - CVE-2024-47171
  - GHSA-g54f-66mw-hv66
summary: "Agnai vulnerable to Relative Path Traversal in Image Upload\n### Summary\n\nA vulnerability\
  \ has been discovered in **Agnai** that permits attackers to upload image files at attacker-chosen\
  \ location on the server. This issue can lead to image file uploads to unauthorized or unintended\
  \ directories, including overwriting of existing images which may be used for defacement.\n\
  \nThis does not affect:\n\n- agnai.chat\n- installations using S3-compatible storage\n- self-hosting\
  \ that is not publicly exposed\n\n### CWE-35: Path Traversal\n\nhttps://cwe.mitre.org/data/definitions/35.html\n\
  \n### CVSS4.0 - 2.3 Low\n\nCVSS:4.0/AV:N/AC:L/AT:P/PR:L/UI:N/VC:N/VI:L/VA:N/SC:N/SI:N/SA:N\n\
  \n### Details\n\nThis is a path traversal vulnerability. An attacker can exploit this vulnerability\
  \ by sending a specially crafted request to the `editCharacter` handler https://github.com/agnaistic/agnai/blob/75abbd5b0f5e48ddecc805365cf1574d05ee1ce5/srv/api/character.ts#L140:\n\
  \n```tsx\nPOST /api/character/28cbe508-2fa9-4890-886e-61d73e22006c%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%61%70%70%2f%64%69%73%74%2f%64%61%6e%79%61%6e%67\
  \ HTTP/1.1\n```\n\nThe path traversal character sequence makes itâ€™s way into the `id` variable\
  \ which is then string interpolated into `filename`. \n\n```jsx\nexport async function entityUpload(kind:\
  \ string, id: string, attachment?: Attachment) {\n  if (!attachment) return\n  const filename\
  \ = `${kind}-${id}`\n  return upload(attachment, filename)\n}\n```\n\nhttps://github.com/agnaistic/agnai/blob/75abbd5b0f5e48ddecc805365cf1574d05ee1ce5/srv/api/upload.ts#L55\n\
  \nNo path normalization is conducted nor checked, so attackers can freely manipulate the path\
  \ which the file is uploaded to.\n\n### Impact\n\nThis vulnerability is classified as a path\
  \ traversal vulnerability. Attackers can upload image files to arbitrary locations, potentially\
  \ overwriting critical system image files.\n\n### Credit\nSecurity research in collaboration\
  \ with Analyst [Danyang Liu (noe223)](https://github.com/noe233) @noe233"
severities:
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.22665'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.22671'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.22691'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.22721'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.22977'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23047'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23145'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23322'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23336'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23744'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.22169'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.22483'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.22578'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.22607'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.23350'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00053'
    scoring_system: epss
    scoring_elements: '0.22675'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.22843'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.2286'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.22793'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.22869'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.22893'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.22895'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00073'
    scoring_system: epss
    scoring_elements: '0.22732'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00078'
    scoring_system: epss
    scoring_elements: '0.2422'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00078'
    scoring_system: epss
    scoring_elements: '0.24219'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00078'
    scoring_system: epss
    scoring_elements: '0.24233'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00078'
    scoring_system: epss
    scoring_elements: '0.2425'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00078'
    scoring_system: epss
    scoring_elements: '0.24234'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00078'
    scoring_system: epss
    scoring_elements: '0.24242'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30167'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30085'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30042'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30198'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30211'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30202'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30232'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30191'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.3017'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30205'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30234'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.3024'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30212'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30192'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00136'
    scoring_system: epss
    scoring_elements: '0.30168'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: '0.00162'
    scoring_system: epss
    scoring_elements: '0.24152'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
  - score: LOW
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-g54f-66mw-hv66
  - score: '4.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/agnaistic/agnai
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/agnaistic/agnai
  - score: '4.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: 'https://github.com/agnaistic/agnai/blob/75abbd5b0f5e48ddecc805365cf1574d05ee1ce5/srv/api/character.ts#L140:'
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: 'https://github.com/agnaistic/agnai/blob/75abbd5b0f5e48ddecc805365cf1574d05ee1ce5/srv/api/character.ts#L140:'
  - score: '4.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/agnaistic/agnai/blob/75abbd5b0f5e48ddecc805365cf1574d05ee1ce5/srv/api/upload.ts#L55
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/agnaistic/agnai/blob/75abbd5b0f5e48ddecc805365cf1574d05ee1ce5/srv/api/upload.ts#L55
  - score: '4.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/agnaistic/agnai/security/advisories/GHSA-g54f-66mw-hv66
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/agnaistic/agnai/security/advisories/GHSA-g54f-66mw-hv66
  - score: '4.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-47171
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-47171
weaknesses:
  - CWE-22
  - CWE-937
  - CWE-1035
  - CWE-35
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-47171
    reference_type:
    reference_id:
  - url: https://github.com/agnaistic/agnai
    reference_type:
    reference_id:
  - url: 'https://github.com/agnaistic/agnai/blob/75abbd5b0f5e48ddecc805365cf1574d05ee1ce5/srv/api/character.ts#L140:'
    reference_type:
    reference_id:
  - url: https://github.com/agnaistic/agnai/blob/75abbd5b0f5e48ddecc805365cf1574d05ee1ce5/srv/api/upload.ts#L55
    reference_type:
    reference_id:
  - url: https://github.com/agnaistic/agnai/security/advisories/GHSA-g54f-66mw-hv66
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-47171
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:a:agnai:agnai:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:a:agnai:agnai:*:*:*:*:*:*:*:*
  - url: https://github.com/advisories/GHSA-g54f-66mw-hv66
    reference_type:
    reference_id: GHSA-g54f-66mw-hv66
