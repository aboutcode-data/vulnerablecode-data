vulnerability_id: VCID-d8mt-vjrt-zkhb
aliases:
  - GHSA-c7xh-gjv4-4jgv
summary: |
  kcp's impersonation allows access to global administrative groups
  ### Impact

  [Impersonation](https://kubernetes.io/docs/reference/access-authn-authz/authentication/#user-impersonation) is a feature of the Kubernetes API, allowing to override user information. As downstream project, kcp inherits this feature. As per the linked documentation a specific level of privilege (usually assigned to cluster admins) is required for impersonation.

  The vulnerability in kcp affects kcp installations in which users are granted the `cluster-admin` ClusterRole (or comparably high permission levels that grant impersonation access; the verb in question is `impersonate`) within their respective workspaces. As kcp builds around self-service confined within workspaces, most installations would likely grant such workspace access to their users. Such users can impersonate special global administrative groups, which circumvent parts of the authorizer chains, e.g. [maximal permission policies](https://docs.kcp.io/kcp/v0.26/concepts/apis/exporting-apis/#maximal-permission-policy).

  ### Patches

  The problem has been patched in #3206 and is available in kcp 0.26.1 and higher.

  ### Workarounds

  - Not assigning the `cluster-admin` role (or any other role granting blanket impersonation permissions) to users.
  - A reverse proxy between users and kcp to check for the `Impersonate-Group` header and reject requests that impersonate global administrative groups.

  ### References

  See the pull request (#3206).
severities:
  - score: '6.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/kcp-dev/kcp
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/kcp-dev/kcp
  - score: '6.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/kcp-dev/kcp/commit/24ab5d4dc35ddff98a2e5fdc236e1681f03283ec
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/kcp-dev/kcp/commit/24ab5d4dc35ddff98a2e5fdc236e1681f03283ec
  - score: '6.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/kcp-dev/kcp/pull/3206
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/kcp-dev/kcp/pull/3206
  - score: '6.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/kcp-dev/kcp/security/advisories/GHSA-c7xh-gjv4-4jgv
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/kcp-dev/kcp/security/advisories/GHSA-c7xh-gjv4-4jgv
  - score: '6.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N
    published_at: None
    url: https://pkg.go.dev/vuln/GO-2024-3325
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://pkg.go.dev/vuln/GO-2024-3325
weaknesses:
  - CWE-285
references:
  - url: https://github.com/kcp-dev/kcp
    reference_type:
    reference_id:
  - url: https://github.com/kcp-dev/kcp/commit/24ab5d4dc35ddff98a2e5fdc236e1681f03283ec
    reference_type:
    reference_id:
  - url: https://github.com/kcp-dev/kcp/pull/3206
    reference_type:
    reference_id:
  - url: https://github.com/kcp-dev/kcp/security/advisories/GHSA-c7xh-gjv4-4jgv
    reference_type:
    reference_id:
  - url: https://pkg.go.dev/vuln/GO-2024-3325
    reference_type:
    reference_id:
