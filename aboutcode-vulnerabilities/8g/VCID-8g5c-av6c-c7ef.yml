vulnerability_id: VCID-8g5c-av6c-c7ef
aliases:
  - CVE-2025-38470
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net: vlan: fix VLAN 0 refcount imbalance of toggling filtering during runtime

  Assuming the "rx-vlan-filter" feature is enabled on a net device, the
  8021q module will automatically add or remove VLAN 0 when the net device
  is put administratively up or down, respectively. There are a couple of
  problems with the above scheme.

  The first problem is a memory leak that can happen if the "rx-vlan-filter"
  feature is disabled while the device is running:

   # ip link add bond1 up type bond mode 0
   # ethtool -K bond1 rx-vlan-filter off
   # ip link del dev bond1

  When the device is put administratively down the "rx-vlan-filter"
  feature is disabled, so the 8021q module will not remove VLAN 0 and the
  memory will be leaked [1].

  Another problem that can happen is that the kernel can automatically
  delete VLAN 0 when the device is put administratively down despite not
  adding it when the device was put administratively up since during that
  time the "rx-vlan-filter" feature was disabled. null-ptr-unref or
  bug_on[2] will be triggered by unregister_vlan_dev() for refcount
  imbalance if toggling filtering during runtime:

  $ ip link add bond0 type bond mode 0
  $ ip link add link bond0 name vlan0 type vlan id 0 protocol 802.1q
  $ ethtool -K bond0 rx-vlan-filter off
  $ ifconfig bond0 up
  $ ethtool -K bond0 rx-vlan-filter on
  $ ifconfig bond0 down
  $ ip link del vlan0

  Root cause is as below:
  step1: add vlan0 for real_dev, such as bond, team.
  register_vlan_dev
      vlan_vid_add(real_dev,htons(ETH_P_8021Q),0) //refcnt=1
  step2: disable vlan filter feature and enable real_dev
  step3: change filter from 0 to 1
  vlan_device_event
      vlan_filter_push_vids
          ndo_vlan_rx_add_vid //No refcnt added to real_dev vlan0
  step4: real_dev down
  vlan_device_event
      vlan_vid_del(dev, htons(ETH_P_8021Q), 0); //refcnt=0
          vlan_info_rcu_free //free vlan0
  step5: delete vlan0
  unregister_vlan_dev
      BUG_ON(!vlan_info); //vlan_info is null

  Fix both problems by noting in the VLAN info whether VLAN 0 was
  automatically added upon NETDEV_UP and based on that decide whether it
  should be deleted upon NETDEV_DOWN, regardless of the state of the
  "rx-vlan-filter" feature.

  [1]
  unreferenced object 0xffff8880068e3100 (size 256):
    comm "ip", pid 384, jiffies 4296130254
    hex dump (first 32 bytes):
      00 20 30 0d 80 88 ff ff 00 00 00 00 00 00 00 00  . 0.............
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
    backtrace (crc 81ce31fa):
      __kmalloc_cache_noprof+0x2b5/0x340
      vlan_vid_add+0x434/0x940
      vlan_device_event.cold+0x75/0xa8
      notifier_call_chain+0xca/0x150
      __dev_notify_flags+0xe3/0x250
      rtnl_configure_link+0x193/0x260
      rtnl_newlink_create+0x383/0x8e0
      __rtnl_newlink+0x22c/0xa40
      rtnl_newlink+0x627/0xb00
      rtnetlink_rcv_msg+0x6fb/0xb70
      netlink_rcv_skb+0x11f/0x350
      netlink_unicast+0x426/0x710
      netlink_sendmsg+0x75a/0xc20
      __sock_sendmsg+0xc1/0x150
      ____sys_sendmsg+0x5aa/0x7b0
      ___sys_sendmsg+0xfc/0x180

  [2]
  kernel BUG at net/8021q/vlan.c:99!
  Oops: invalid opcode: 0000 [#1] SMP KASAN PTI
  CPU: 0 UID: 0 PID: 382 Comm: ip Not tainted 6.16.0-rc3 #61 PREEMPT(voluntary)
  Hardware name: QEMU Standard PC (i440FX + PIIX, 1996),
  BIOS rel-1.13.0-0-gf21b5a4aeb02-prebuilt.qemu.org 04/01/2014
  RIP: 0010:unregister_vlan_dev (net/8021q/vlan.c:99 (discriminator 1))
  RSP: 0018:ffff88810badf310 EFLAGS: 00010246
  RAX: 0000000000000000 RBX: ffff88810da84000 RCX: ffffffffb47ceb9a
  RDX: dffffc0000000000 RSI: 0000000000000008 RDI: ffff88810e8b43c8
  RBP: 0000000000000000 R08: 0000000000000000 R09: fffffbfff6cefe80
  R10: ffffffffb677f407 R11: ffff88810badf3c0 R12: ffff88810e8b4000
  R13: 0000000000000000 R14: ffff88810642a5c0 R15: 000000000000017e
  FS:  00007f1ff68c20c0(0000) GS:ffff888163a24000(0000) knlGS:0000000000000000
  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
  CR2: 00007f1ff5dad240 CR3: 0000000107e56000 CR4: 00000000000006f0
  Call Trace:
   <TASK
  ---truncated---
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-38470.json
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03845'
    published_at: '2026-01-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03847'
    published_at: '2026-01-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04594'
    published_at: '2025-08-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04539'
    published_at: '2025-08-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04528'
    published_at: '2025-08-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04559'
    published_at: '2025-08-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04529'
    published_at: '2025-08-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.0449'
    published_at: '2025-08-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.0452'
    published_at: '2025-08-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08906'
    published_at: '2025-09-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09076'
    published_at: '2025-09-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09057'
    published_at: '2025-09-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.0906'
    published_at: '2025-09-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.0921'
    published_at: '2025-10-01 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.092'
    published_at: '2025-10-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.09255'
    published_at: '2025-10-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08575'
    published_at: '2025-09-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08595'
    published_at: '2025-09-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08587'
    published_at: '2025-09-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08678'
    published_at: '2025-09-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08661'
    published_at: '2025-09-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08751'
    published_at: '2025-09-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08812'
    published_at: '2025-09-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08865'
    published_at: '2025-09-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08816'
    published_at: '2025-09-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08928'
    published_at: '2025-09-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10242'
    published_at: '2025-10-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10287'
    published_at: '2025-10-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10284'
    published_at: '2025-10-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.1032'
    published_at: '2025-10-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10333'
    published_at: '2025-11-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.1031'
    published_at: '2025-10-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10276'
    published_at: '2025-10-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10233'
    published_at: '2025-10-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10204'
    published_at: '2025-10-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10282'
    published_at: '2025-10-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10231'
    published_at: '2025-10-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10228'
    published_at: '2025-10-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10222'
    published_at: '2025-10-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10211'
    published_at: '2025-10-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10281'
    published_at: '2025-11-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.10271'
    published_at: '2025-10-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-911
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-38470.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2025-38470
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-38470
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/579d4f9ca9a9a605184a9b162355f6ba131f678d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8984bcbd1edf5bee5be06ad771d157333b790c33
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/93715aa2d80e6c5cea1bb486321fc4585076928b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/bb515c41306454937464da055609b5fb0a27821b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d43ef15bf4856c8c4c6c3572922331a5f06deb77
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2383906
    reference_type:
    reference_id: 2383906
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38470
    reference_type:
    reference_id: CVE-2025-38470
  - url: https://usn.ubuntu.com/7879-1/
    reference_type:
    reference_id: USN-7879-1
  - url: https://usn.ubuntu.com/7879-2/
    reference_type:
    reference_id: USN-7879-2
  - url: https://usn.ubuntu.com/7879-3/
    reference_type:
    reference_id: USN-7879-3
  - url: https://usn.ubuntu.com/7879-4/
    reference_type:
    reference_id: USN-7879-4
  - url: https://usn.ubuntu.com/7880-1/
    reference_type:
    reference_id: USN-7880-1
  - url: https://usn.ubuntu.com/7909-1/
    reference_type:
    reference_id: USN-7909-1
  - url: https://usn.ubuntu.com/7909-2/
    reference_type:
    reference_id: USN-7909-2
  - url: https://usn.ubuntu.com/7909-3/
    reference_type:
    reference_id: USN-7909-3
  - url: https://usn.ubuntu.com/7909-4/
    reference_type:
    reference_id: USN-7909-4
  - url: https://usn.ubuntu.com/7909-5/
    reference_type:
    reference_id: USN-7909-5
  - url: https://usn.ubuntu.com/7910-1/
    reference_type:
    reference_id: USN-7910-1
  - url: https://usn.ubuntu.com/7910-2/
    reference_type:
    reference_id: USN-7910-2
  - url: https://usn.ubuntu.com/7933-1/
    reference_type:
    reference_id: USN-7933-1
  - url: https://usn.ubuntu.com/7934-1/
    reference_type:
    reference_id: USN-7934-1
  - url: https://usn.ubuntu.com/7938-1/
    reference_type:
    reference_id: USN-7938-1
