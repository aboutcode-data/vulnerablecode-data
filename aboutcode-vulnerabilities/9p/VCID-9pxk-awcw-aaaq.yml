vulnerability_id: VCID-9pxk-awcw-aaaq
aliases:
  - GHSA-q89g-4vhh-mvvm
summary: |
  Incorrect Lifetime Bounds on Closures in `rusqlite`
  The lifetime bound on several closure-accepting `rusqlite` functions (specifically, functions which register a callback to be later invoked by SQLite) was too relaxed. If a closure referencing borrowed values on the stack is was passed to one of these functions, it could allow Rust code to access objects on the stack after they have been dropped.

  The impacted functions are:

  - Under `cfg(feature = "functions")`: `Connection::create_scalar_function`, `Connection::create_aggregate_function` and `Connection::create_window_function`.
  - Under `cfg(feature = "hooks")`: `Connection::commit_hook`, `Connection::rollback_hook` and `Connection::update_hook`.
  - Under `cfg(feature = "collation")`: `Connection::create_collation`.

  The issue exists in all `0.25.*` versions prior to `0.25.4`, and all `0.26.*` versions prior to 0.26.2 (specifically: `0.25.0`, `0.25.1`, `0.25.2`, `0.25.3`, `0.26.0`, and `0.26.1`).

  The fix is available in versions `0.26.2` and newer, and also has been back-ported to `0.25.4`. As it does not exist in `0.24.*`, all affected versions should have an upgrade path to a semver-compatible release.
severities:
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-q89g-4vhh-mvvm
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/rusqlite/rusqlite
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/rusqlite/rusqlite
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/rusqlite/rusqlite/issues/1048
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/rusqlite/rusqlite/issues/1048
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2021-0128.html
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2021-0128.html
weaknesses: []
references:
  - url: https://github.com/rusqlite/rusqlite
    reference_type:
    reference_id:
  - url: https://github.com/rusqlite/rusqlite/issues/1048
    reference_type:
    reference_id:
  - url: https://rustsec.org/advisories/RUSTSEC-2021-0128.html
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-q89g-4vhh-mvvm
    reference_type:
    reference_id: GHSA-q89g-4vhh-mvvm
