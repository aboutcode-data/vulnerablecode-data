vulnerability_id: VCID-12e8-kav9-aaap
aliases:
  - GHSA-g9mp-8g3h-3c5c
summary: "flynn/noise has improper nonce handling yielding potential state DoS\nThe Go package\
  \ `github.com/flynn/noise`, a [Noise Protocol](https://noiseprotocol.org/) implementation,\
  \ has two bugs in nonce handling in versions prior to v1.0.0.\n\n### Issue 1: Potential nonce\
  \ overflow\n\nIf 2<sup>64</sup> (~18.4 quintillion) or more messages are encrypted with `Encrypt`\
  \ after handshaking, the nonce counter will wrap around, causing multiple messages to be encrypted\
  \ with the same key and nonce, resulting in a potentially catastrophic weakening of the security\
  \ properties of the symmetric cipher.\n\nThis has been resolved in the patched version by\
  \ returning `ErrMaxNonce` from the `CipherState` `Encrypt` and `Decrypt` methods before the\
  \ reserved maximum nonce is reached. If this error is encountered, the program should handshake\
  \ again to start with a fresh `CipherState`.\n\n### Issue 2: Potential denial of service via\
  \ invalid ciphertext\n\nIf an attacker sends an invalid ciphertext into one peer's `Decrypt`,\
  \ the nonce is incremented unconditionally. This causes a desync of the `CipherState` due\
  \ to a nonce mismatch between the peers, resulting in a failure to decrypt all subsequent\
  \ messages. A new handshake will be required to establish a new `CipherState`.\n\nThis has\
  \ been resolved in the patched version by returning authentication errors from `Decrypt` before\
  \ incrementing the nonce. \n\n### Patches\n\nFixed in https://github.com/flynn/noise/pull/44,\
  \ tagged as v1.0.0.\n\n### Acknowledgements\n\nThese issues were discovered during [an audit](https://www.bamsoftware.com/software/dnstt/cure53-turbotunnel-2021.pdf)\
  \ of a user of this package ([dnstt](https://www.bamsoftware.com/software/dnstt/)). Thanks\
  \ to UC Berkley for commissioning the audit, and to David Fifield and Nathan Brown for their\
  \ collaboration on the fixes. The fixed issues are noted in the audit as:\n\n* UCB-02-003\
  \ Potential nonce overflow in Noise protocol\n* UCB-02-006 DoS due to unconditional nonce\
  \ increment"
severities:
  - score: '7.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:H/A:H
    published_at: None
    url: https://github.com/flynn/noise
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/flynn/noise
  - score: '7.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:H/A:H
    published_at: None
    url: https://github.com/flynn/noise/pull/44
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/flynn/noise/pull/44
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/flynn/noise/security/advisories/GHSA-g9mp-8g3h-3c5c
  - score: '7.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:H/A:H
    published_at: None
    url: https://pkg.go.dev/vuln/GO-2022-0425
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://pkg.go.dev/vuln/GO-2022-0425
weaknesses: []
references:
  - url: https://github.com/flynn/noise
    reference_type:
    reference_id:
  - url: https://github.com/flynn/noise/pull/44
    reference_type:
    reference_id:
  - url: https://github.com/flynn/noise/security/advisories/GHSA-g9mp-8g3h-3c5c
    reference_type:
    reference_id:
  - url: https://pkg.go.dev/vuln/GO-2022-0425
    reference_type:
    reference_id:
