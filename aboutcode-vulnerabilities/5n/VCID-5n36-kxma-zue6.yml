vulnerability_id: VCID-5n36-kxma-zue6
aliases:
  - GHSA-3g2j-vm47-x4mj
summary: "LXD vulnerable to a local privilege escalation through custom storage volumes\n**Impact**\n\
  \nThis affects any LXD user in an environment where an unprivileged user may have root access\
  \ to a container with an attached custom storage volume that has the `security.shifted` property\
  \ set to `true` as well as access to the host as an unprivileged user.\n\nThe most common\
  \ case for this would be systems using `lxd-user` with the less privileged lxd group to provide\
  \ unprivileged users with an isolated restricted access to LXD. Such users may be able to\
  \ create a custom storage volume with the necessary property (depending on kernel and filesystem\
  \ support) and can then write a setuid binary from within the container which can be executed\
  \ as an unprivileged user on the host to gain root privileges.\n\n**Patches**\n\nPatches for\
  \ this issue are available: \n\n- LXD 6 series: https://github.com/canonical/lxd/pull/16904\n\
  - LXD 5.21 LTS series: https://github.com/canonical/lxd/pull/16922\n- LXD 5.0 LTS series:\
  \ https://github.com/canonical/lxd/pull/16923\n- LXD 4.0 LTS series: https://github.com/canonical/lxd/pull/16924\
  \ \n\nThe first commit changes the permissions for any new storage pool, the later commit\
  \ adds a patch that applies it on startup to all existing storage pools.\n\nThese fixes are\
  \ also available in the associated candidate snap channels for each LTS series:\n\n- 5.21/candidate\
  \ (5.21.4-8a3cf61)\n- 5.0/candidate (5.0.5-5c60378)\n- 4.0/candidate (4.0.10-35a8127)\n\n\
  We will be preparing intermediate releases to the associated stable snap channels shortly.\n\
  \n**Workarounds**\n\nPermissions can be manually restricted until a patched version of LXD\
  \ is deployed.\n\nThis is done with:\n\n```\nsudo nsenter --mount=/run/snapd/ns/lxd.mnt --\
  \ chmod 0700 /var/snap/lxd/common/lxd/storage-pools/*/{custom*,virtual-machines*,images}\n\
  sudo nsenter --mount=/run/snapd/ns/lxd.mnt -- chmod 0711 /var/snap/lxd/common/lxd/storage-pools/*/{containers*,buckets*}\n\
  ```\n\nThose are the same permissions which will be applied by the patched LXD for both new\
  \ and existing storage pools.\n\n**References**\n\nThis was reported to Incus publicly on\
  \ Github here: \n\n- https://github.com/lxc/incus/security/advisories/GHSA-56mx-8g9f-5crf\n\
  - https://github.com/lxc/incus/issues/2641"
severities:
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/canonical/lxd
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/canonical/lxd/pull/16904
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/canonical/lxd/pull/16922
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/canonical/lxd/pull/16923
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/canonical/lxd/pull/16924
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/canonical/lxd/security/advisories/GHSA-3g2j-vm47-x4mj
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/lxc/incus/issues/2641
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/lxc/incus/security/advisories/GHSA-56mx-8g9f-5crf
weaknesses:
  - CWE-269
references:
  - url: https://github.com/canonical/lxd
    reference_type:
    reference_id:
  - url: https://github.com/canonical/lxd/pull/16904
    reference_type:
    reference_id:
  - url: https://github.com/canonical/lxd/pull/16922
    reference_type:
    reference_id:
  - url: https://github.com/canonical/lxd/pull/16923
    reference_type:
    reference_id:
  - url: https://github.com/canonical/lxd/pull/16924
    reference_type:
    reference_id:
  - url: https://github.com/canonical/lxd/security/advisories/GHSA-3g2j-vm47-x4mj
    reference_type:
    reference_id:
  - url: https://github.com/lxc/incus/issues/2641
    reference_type:
    reference_id:
  - url: https://github.com/lxc/incus/security/advisories/GHSA-56mx-8g9f-5crf
    reference_type:
    reference_id:
