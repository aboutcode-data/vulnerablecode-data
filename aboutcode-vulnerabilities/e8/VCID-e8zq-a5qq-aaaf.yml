vulnerability_id: VCID-e8zq-a5qq-aaaf
aliases:
  - CVE-2024-42077
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  ocfs2: fix DIO failure due to insufficient transaction credits

  The code in ocfs2_dio_end_io_write() estimates number of necessary
  transaction credits using ocfs2_calc_extend_credits().  This however does
  not take into account that the IO could be arbitrarily large and can
  contain arbitrary number of extents.

  Extent tree manipulations do often extend the current transaction but not
  in all of the cases.  For example if we have only single block extents in
  the tree, ocfs2_mark_extent_written() will end up calling
  ocfs2_replace_extent_rec() all the time and we will never extend the
  current transaction and eventually exhaust all the transaction credits if
  the IO contains many single block extents.  Once that happens a
  WARN_ON(jbd2_handle_buffer_credits(handle) <= 0) is triggered in
  jbd2_journal_dirty_metadata() and subsequently OCFS2 aborts in response to
  this error.  This was actually triggered by one of our customers on a
  heavily fragmented OCFS2 filesystem.

  To fix the issue make sure the transaction always has enough credits for
  one extent insert before each call of ocfs2_mark_extent_written().

  Heming Zhao said:

  ------
  PANIC: "Kernel panic - not syncing: OCFS2: (device dm-1): panic forced after error"

  PID: xxx  TASK: xxxx  CPU: 5  COMMAND: "SubmitThread-CA"
    #0 machine_kexec at ffffffff8c069932
    #1 __crash_kexec at ffffffff8c1338fa
    #2 panic at ffffffff8c1d69b9
    #3 ocfs2_handle_error at ffffffffc0c86c0c [ocfs2]
    #4 __ocfs2_abort at ffffffffc0c88387 [ocfs2]
    #5 ocfs2_journal_dirty at ffffffffc0c51e98 [ocfs2]
    #6 ocfs2_split_extent at ffffffffc0c27ea3 [ocfs2]
    #7 ocfs2_change_extent_flag at ffffffffc0c28053 [ocfs2]
    #8 ocfs2_mark_extent_written at ffffffffc0c28347 [ocfs2]
    #9 ocfs2_dio_end_io_write at ffffffffc0c2bef9 [ocfs2]
  #10 ocfs2_dio_end_io at ffffffffc0c2c0f5 [ocfs2]
  #11 dio_complete at ffffffff8c2b9fa7
  #12 do_blockdev_direct_IO at ffffffff8c2bc09f
  #13 ocfs2_direct_IO at ffffffffc0c2b653 [ocfs2]
  #14 generic_file_direct_write at ffffffff8c1dcf14
  #15 __generic_file_write_iter at ffffffff8c1dd07b
  #16 ocfs2_file_write_iter at ffffffffc0c49f1f [ocfs2]
  #17 aio_write at ffffffff8c2cc72e
  #18 kmem_cache_alloc at ffffffff8c248dde
  #19 do_io_submit at ffffffff8c2ccada
  #20 do_syscall_64 at ffffffff8c004984
  #21 entry_SYSCALL_64_after_hwframe at ffffffff8c8000ba
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-42077.json
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07776'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07887'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.079'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07839'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07743'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07703'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07751'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07767'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07812'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09084'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09139'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09142'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09154'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09149'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05065'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05128'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05124'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05115'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05119'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05108'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05105'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05100'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05091'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05073'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05058'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04956'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.04987'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05078'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00056'
    scoring_system: epss
    scoring_elements: '0.14351'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00056'
    scoring_system: epss
    scoring_elements: '0.14461'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00056'
    scoring_system: epss
    scoring_elements: '0.14302'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.14823'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.14833'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.14812'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.14803'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.14819'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.14836'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.14801'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.1478'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.14873'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.14875'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00057'
    scoring_system: epss
    scoring_elements: '0.14848'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.1596'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '0.00236'
    scoring_system: epss
    scoring_elements: '0.3161'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-42077
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-42077
weaknesses:
  - CWE-99
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-42077.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-42077
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-42077
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/320273b5649bbcee87f9e65343077189699d2a7a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/331d1079d58206ff7dc5518185f800b412f89bc6
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9ea2d1c6789722d58ec191f14f9a02518d55b6b4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a68b896aa56e435506453ec8835bc991ec3ae687
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/be346c1a6eeb49d8fda827d2a9522124c2f72f36
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c05ffb693bfb42a48ef3ee88a55b57392984e111
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2300515
    reference_type:
    reference_id: 2300515
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-42077
    reference_type:
    reference_id: CVE-2024-42077
  - url: https://usn.ubuntu.com/7007-1/
    reference_type:
    reference_id: USN-7007-1
  - url: https://usn.ubuntu.com/7007-2/
    reference_type:
    reference_id: USN-7007-2
  - url: https://usn.ubuntu.com/7007-3/
    reference_type:
    reference_id: USN-7007-3
  - url: https://usn.ubuntu.com/7009-1/
    reference_type:
    reference_id: USN-7009-1
  - url: https://usn.ubuntu.com/7009-2/
    reference_type:
    reference_id: USN-7009-2
  - url: https://usn.ubuntu.com/7019-1/
    reference_type:
    reference_id: USN-7019-1
  - url: https://usn.ubuntu.com/7089-1/
    reference_type:
    reference_id: USN-7089-1
  - url: https://usn.ubuntu.com/7089-2/
    reference_type:
    reference_id: USN-7089-2
  - url: https://usn.ubuntu.com/7089-3/
    reference_type:
    reference_id: USN-7089-3
  - url: https://usn.ubuntu.com/7089-4/
    reference_type:
    reference_id: USN-7089-4
  - url: https://usn.ubuntu.com/7089-5/
    reference_type:
    reference_id: USN-7089-5
  - url: https://usn.ubuntu.com/7089-6/
    reference_type:
    reference_id: USN-7089-6
  - url: https://usn.ubuntu.com/7089-7/
    reference_type:
    reference_id: USN-7089-7
  - url: https://usn.ubuntu.com/7090-1/
    reference_type:
    reference_id: USN-7090-1
  - url: https://usn.ubuntu.com/7095-1/
    reference_type:
    reference_id: USN-7095-1
  - url: https://usn.ubuntu.com/7156-1/
    reference_type:
    reference_id: USN-7156-1
  - url: https://usn.ubuntu.com/7159-1/
    reference_type:
    reference_id: USN-7159-1
  - url: https://usn.ubuntu.com/7159-2/
    reference_type:
    reference_id: USN-7159-2
  - url: https://usn.ubuntu.com/7159-3/
    reference_type:
    reference_id: USN-7159-3
  - url: https://usn.ubuntu.com/7159-4/
    reference_type:
    reference_id: USN-7159-4
  - url: https://usn.ubuntu.com/7159-5/
    reference_type:
    reference_id: USN-7159-5
  - url: https://usn.ubuntu.com/7185-1/
    reference_type:
    reference_id: USN-7185-1
  - url: https://usn.ubuntu.com/7185-2/
    reference_type:
    reference_id: USN-7185-2
  - url: https://usn.ubuntu.com/7195-1/
    reference_type:
    reference_id: USN-7195-1
  - url: https://usn.ubuntu.com/7195-2/
    reference_type:
    reference_id: USN-7195-2
