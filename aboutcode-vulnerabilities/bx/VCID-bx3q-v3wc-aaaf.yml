vulnerability_id: VCID-bx3q-v3wc-aaaf
aliases:
  - CVE-2024-39687
  - GHSA-p9cg-vqcc-grcx
summary: "Server Side Request Forgery (SSRF) attack in Fedify\n### Summary\n \nAt present, when\
  \ Fedify needs to retrieve an object or activity from a remote activitypub server, it makes\
  \ a HTTP request to the `@id` or other resources present within the activity it has received\
  \ from the web. This activity could reference an `@id` that points to an internal IP address,\
  \ allowing an attacker to send request to resources internal to the fedify server's network.\n\
  \nThis applies to not just resolution of documents containing activities or objects, but also\
  \ to media URLs as well.\n\nSpecifically this is a [Server Side Request Forgery attack](https://owasp.org/www-community/attacks/Server_Side_Request_Forgery).\
  \ You can learn more about SSRF attacks via [CWE-918](https://cwe.mitre.org/data/definitions/918.html)\n\
  \n### Details\n\nWhen Fedify makes a request at runtime via the DocLoader [1] [2], the `fetch`\
  \ API does not first check the URI's to assert that it resolve to a public IP address. Additionally,\
  \ any downstream software of Fedify that may fetch data from URIs contained within Activities\
  \ or Objects maybe be at risk of requesting non-public resources, and storing those, exposing\
  \ non-public information to the public.\n\nAdditionally, in many cases the URIs are not asserted\
  \ to be either strictly HTTPS or HTTP protocols, which could lead to further attacks, and\
  \ there is no check that the URI contains a `hostname` part. Whilst the [`fetch()` specification](https://fetch.spec.whatwg.org/)\
  \ may provide some safety here, along with underlying fetch implementations, there is still\
  \ potential for attacks through using `data:` URIs, or just attacking some other protocol\
  \ entirely, e.g., FTP or CalDav.\n\n[1] https://github.com/dahlia/fedify/blob/main/runtime/docloader.ts#L141\n\
  [2] https://github.com/dahlia/fedify/blob/main/runtime/docloader.ts#L175\n\n#### Deno-specific\
  \ Attack Vectors\n\nIn Deno specifically, the `fetch()` API allows [accessing local filesystem](https://docs.deno.com/deploy/api/runtime-fetch/),\
  \ I'm not sure how Deno's [Permissions model](https://docs.deno.com/runtime/manual/runtime/permission_apis/)\
  \ may prevent attacks utilising `file:` URIs.\n \n> Fetch also supports fetching from file\
  \ URLs to retrieve static files. For more info on static files, see the [filesystem API documentation](https://docs.deno.com/deploy/api/runtime-fs).\n\
  \n#### ActivityPub Security Considerations\n\nThis is also noted in the ActivityPub spec in\
  \ [Section B.3 Security Considerations](https://www.w3.org/TR/activitypub/#security-localhost),\
  \ however, there it is more limited in scope.\n\n#### Other Implementations\n\nIt may be acceptable\
  \ to allow a server operator to allow access to given non-public IP addresses, for instance\
  \ [in Mastodon](https://github.com/mastodon/mastodon/blob/092bb8a27af9ee87ff9ebabaf354477470ea3a94/app/lib/request.rb#L330)\
  \ they allow requests to non-public IP addresses, i.e., localhost in development and those\
  \ in the `ALLOWED_PRIVATE_ADDRESSES` environment variable.\n\n### PoC\n\nI'm not sure a PoC\
  \ is necessary given this is a reasonably well known vulnerability vector.\n\n### Impact\n\
  \nThis impacts server operates, as resources that are internal to their network may find themselves\
  \ being improperly accessed or potentially even attacked or exposed to the public.\n\n###\
  \ Notes for resolution:\n\nWhen implementing public IP address validation, be careful of [CWE-1389](https://cwe.mitre.org/data/definitions/1389.html)\
  \ and [CWE-1286](https://cwe.mitre.org/data/definitions/1286.html) both of which [recently](https://github.com/advisories/GHSA-78xj-cgh5-2h22)\
  \ caused a CVE to be filed against the popular node.js `ip` package, although this package\
  \ was not originally intended for security purposes."
severities:
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.28330'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.27459'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.27731'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.27805'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.27833'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.27890'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.27876'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.27885'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.28645'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.28223'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.28251'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.28259'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.27899'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.27941'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.28175'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00062'
    scoring_system: epss
    scoring_elements: '0.28242'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00066'
    scoring_system: epss
    scoring_elements: '0.20709'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00066'
    scoring_system: epss
    scoring_elements: '0.20865'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00066'
    scoring_system: epss
    scoring_elements: '0.20882'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00066'
    scoring_system: epss
    scoring_elements: '0.2089'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00066'
    scoring_system: epss
    scoring_elements: '0.20831'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00066'
    scoring_system: epss
    scoring_elements: '0.20776'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.22522'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.22505'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.22517'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.22549'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.22515'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.2253'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.22538'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00071'
    scoring_system: epss
    scoring_elements: '0.22542'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00214'
    scoring_system: epss
    scoring_elements: '0.41073'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00214'
    scoring_system: epss
    scoring_elements: '0.41042'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41759'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41743'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41764'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41783'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41754'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41732'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41752'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.4177'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41797'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.4179'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41768'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41751'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00219'
    scoring_system: epss
    scoring_elements: '0.41723'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: '0.00312'
    scoring_system: epss
    scoring_elements: '0.37968'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-p9cg-vqcc-grcx
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-p9cg-vqcc-grcx
  - score: '7.2'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:N/A:L
    published_at: None
    url: https://github.com/dahlia/fedify
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify
  - score: '7.2'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:N/A:L
    published_at: None
    url: https://github.com/dahlia/fedify/commit/30f9cf4a175704a04c874f3ea88414c5f1e00b28
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify/commit/30f9cf4a175704a04c874f3ea88414c5f1e00b28
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify/commit/30f9cf4a175704a04c874f3ea88414c5f1e00b28
  - score: '7.2'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:N/A:L
    published_at: None
    url: https://github.com/dahlia/fedify/commit/c641e976089dd913f649889c1bfb016df04e86ba
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify/commit/c641e976089dd913f649889c1bfb016df04e86ba
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify/commit/c641e976089dd913f649889c1bfb016df04e86ba
  - score: '7.2'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:N/A:L
    published_at: None
    url: https://github.com/dahlia/fedify/releases/tag/0.11.1
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify/releases/tag/0.11.1
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify/releases/tag/0.11.1
  - score: '7.2'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:N/A:L
    published_at: None
    url: https://github.com/dahlia/fedify/security/advisories/GHSA-p9cg-vqcc-grcx
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify/security/advisories/GHSA-p9cg-vqcc-grcx
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify/security/advisories/GHSA-p9cg-vqcc-grcx
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/dahlia/fedify/security/advisories/GHSA-p9cg-vqcc-grcx
  - score: '7.2'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:N/A:L
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-39687
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-39687
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-39687
weaknesses:
  - CWE-918
  - CWE-937
  - CWE-1035
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-39687
    reference_type:
    reference_id:
  - url: https://github.com/dahlia/fedify
    reference_type:
    reference_id:
  - url: https://github.com/dahlia/fedify/commit/30f9cf4a175704a04c874f3ea88414c5f1e00b28
    reference_type:
    reference_id:
  - url: https://github.com/dahlia/fedify/commit/c641e976089dd913f649889c1bfb016df04e86ba
    reference_type:
    reference_id:
  - url: https://github.com/dahlia/fedify/releases/tag/0.11.1
    reference_type:
    reference_id:
  - url: https://github.com/dahlia/fedify/security/advisories/GHSA-p9cg-vqcc-grcx
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-39687
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-p9cg-vqcc-grcx
    reference_type:
    reference_id: GHSA-p9cg-vqcc-grcx
