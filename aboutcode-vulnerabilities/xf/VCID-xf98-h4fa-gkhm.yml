vulnerability_id: VCID-xf98-h4fa-gkhm
aliases:
  - GHSA-f8mx-cwfh-7hr2
summary: |
  TShock allows chat while not fully connected, possible ban evasion
  This issue was reported to TShock by @ohayo, but was found by the Discord user by the name of `sofurry.com`. Please note that this user **does not own this domain on the internet, just the discord handle**.

  TShock overrides certain Terraria vanilla systems, including chat, and the connection handling, for its own purposes, like enforcing bans. When clients connect but do not complete the connection handshake (e.g., send message number 6), they can "exist" on the server, occupy a player slot, chat, and receive data from the server despite not being fully connected. Individuals who exploit this will be able to effectively harass the server, observe the server, and utilize server resources even if banned from the server.

  For servers that operate with a proxy that strictly enforces the connection handshake/sequence, this is not an issue, but for smaller servers or servers running vanilla TShock this is an issue worth patching for.

  PR body supplied by @ohayo (patch writer):

  Terraria's standard server by default checks for bans upon the client sending the ConnectRequest packet, however, TShock instead chooses to check if the client connecting is banned upon the Request World Data packet.

  A malicious client can easily just not send this packet, and still join the server even while being banned.
  Also by not sending Request World Data, the malicious client is still able to receive all packets from the server & even chat.

  Other clients will not be notified of their join/leave but will be able to see them on the player list.
  Leading to potential chat spam & "spying" on packets of players within the server.
severities:
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-f8mx-cwfh-7hr2
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Pryaxis/TShock
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Pryaxis/TShock/commit/134f80f5b8eac8929aa10f518c00970700d5913d
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/Pryaxis/TShock/security/advisories/GHSA-f8mx-cwfh-7hr2
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Pryaxis/TShock/security/advisories/GHSA-f8mx-cwfh-7hr2
weaknesses:
  - CWE-1035
  - CWE-937
  - CWE-285
references:
  - url: https://github.com/Pryaxis/TShock
    reference_type:
    reference_id:
  - url: https://github.com/Pryaxis/TShock/commit/134f80f5b8eac8929aa10f518c00970700d5913d
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-f8mx-cwfh-7hr2
    reference_type:
    reference_id: GHSA-f8mx-cwfh-7hr2
  - url: https://github.com/Pryaxis/TShock/security/advisories/GHSA-f8mx-cwfh-7hr2
    reference_type:
    reference_id: GHSA-f8mx-cwfh-7hr2
