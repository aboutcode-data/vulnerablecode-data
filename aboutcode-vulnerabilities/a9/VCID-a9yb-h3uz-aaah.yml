vulnerability_id: VCID-a9yb-h3uz-aaah
aliases:
  - CVE-2021-47406
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  ext4: add error checking to ext4_ext_replay_set_iblocks()

  If the call to ext4_map_blocks() fails due to an corrupted file
  system, ext4_ext_replay_set_iblocks() can get stuck in an infinite
  loop.  This could be reproduced by running generic/526 with a file
  system that has inline_data and fast_commit enabled.  The system will
  repeatedly log to the console:

  EXT4-fs warning (device dm-3): ext4_block_to_path:105: block 1074800922 > max in inode 131076

  and the stack that it gets stuck in is:

     ext4_block_to_path+0xe3/0x130
     ext4_ind_map_blocks+0x93/0x690
     ext4_map_blocks+0x100/0x660
     skip_hole+0x47/0x70
     ext4_ext_replay_set_iblocks+0x223/0x440
     ext4_fc_replay_inode+0x29e/0x3b0
     ext4_fc_replay+0x278/0x550
     do_one_pass+0x646/0xc10
     jbd2_journal_recover+0x14a/0x270
     jbd2_journal_load+0xc4/0x150
     ext4_load_journal+0x1f3/0x490
     ext4_fill_super+0x22d4/0x2c00

  With this patch, generic/526 still fails, but system is no longer
  locking up in a tight loop.  It's likely the root casue is that
  fast_commit replay is corrupting file systems with inline_data, and we
  probably need to add better error handling in the fast commit replay
  code path beyond what is done here, which essentially just breaks the
  infinite loop without reporting the to the higher levels of the code.
severities:
  - score: '4.1'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47406.json
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.01993'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02001'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.01999'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02005'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02012'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02016'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02057'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02073'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02047'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02028'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02022'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02495'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02528'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02536'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02527'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02509'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02513'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02521'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02515'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02499'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.0252'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02508'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09078'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.08959'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.08943'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17830'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16666'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16947'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17041'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17069'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17147'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17142'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17732'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17350'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17315'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17338'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17624'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '0.00169'
    scoring_system: epss
    scoring_elements: '0.24969'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/1fd95c05d8f742abfe906620780aee4dbe1a2db0
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-05-29T18:09:07Z/
    published_at: None
    url: https://git.kernel.org/stable/c/1fd95c05d8f742abfe906620780aee4dbe1a2db0
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/27e10c5d31ff1d222c7f797f1ee96d422859ba67
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-05-29T18:09:07Z/
    published_at: None
    url: https://git.kernel.org/stable/c/27e10c5d31ff1d222c7f797f1ee96d422859ba67
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/a63474dbf692dd09b50fed592bc41f6de5f102fc
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-05-29T18:09:07Z/
    published_at: None
    url: https://git.kernel.org/stable/c/a63474dbf692dd09b50fed592bc41f6de5f102fc
weaknesses:
  - CWE-835
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47406.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-47406
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47406
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/1fd95c05d8f742abfe906620780aee4dbe1a2db0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/27e10c5d31ff1d222c7f797f1ee96d422859ba67
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a63474dbf692dd09b50fed592bc41f6de5f102fc
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2282330
    reference_type:
    reference_id: 2282330
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.15:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.15:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.15:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.15:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.15:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.15:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47406
    reference_type:
    reference_id: CVE-2021-47406
