vulnerability_id: VCID-dduh-hgmp-aaaj
aliases:
  - CVE-2021-47212
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net/mlx5: Update error handler for UCTX and UMEM

  In the fast unload flow, the device state is set to internal error,
  which indicates that the driver started the destroy process.
  In this case, when a destroy command is being executed, it should return
  MLX5_CMD_STAT_OK.
  Fix MLX5_CMD_OP_DESTROY_UCTX and MLX5_CMD_OP_DESTROY_UMEM to return OK
  instead of EIO.

  This fixes a call trace in the umem release process -
  [ 2633.536695] Call Trace:
  [ 2633.537518]  ib_uverbs_remove_one+0xc3/0x140 [ib_uverbs]
  [ 2633.538596]  remove_client_context+0x8b/0xd0 [ib_core]
  [ 2633.539641]  disable_device+0x8c/0x130 [ib_core]
  [ 2633.540615]  __ib_unregister_device+0x35/0xa0 [ib_core]
  [ 2633.541640]  ib_unregister_device+0x21/0x30 [ib_core]
  [ 2633.542663]  __mlx5_ib_remove+0x38/0x90 [mlx5_ib]
  [ 2633.543640]  auxiliary_bus_remove+0x1e/0x30 [auxiliary]
  [ 2633.544661]  device_release_driver_internal+0x103/0x1f0
  [ 2633.545679]  bus_remove_device+0xf7/0x170
  [ 2633.546640]  device_del+0x181/0x410
  [ 2633.547606]  mlx5_rescan_drivers_locked.part.10+0x63/0x160 [mlx5_core]
  [ 2633.548777]  mlx5_unregister_device+0x27/0x40 [mlx5_core]
  [ 2633.549841]  mlx5_uninit_one+0x21/0xc0 [mlx5_core]
  [ 2633.550864]  remove_one+0x69/0xe0 [mlx5_core]
  [ 2633.551819]  pci_device_remove+0x3b/0xc0
  [ 2633.552731]  device_release_driver_internal+0x103/0x1f0
  [ 2633.553746]  unbind_store+0xf6/0x130
  [ 2633.554657]  kernfs_fop_write+0x116/0x190
  [ 2633.555567]  vfs_write+0xa5/0x1a0
  [ 2633.556407]  ksys_write+0x4f/0xb0
  [ 2633.557233]  do_syscall_64+0x5b/0x1a0
  [ 2633.558071]  entry_SYSCALL_64_after_hwframe+0x65/0xca
  [ 2633.559018] RIP: 0033:0x7f9977132648
  [ 2633.559821] Code: 89 02 48 c7 c0 ff ff ff ff eb b3 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 55 6f 2d 00 8b 00 85 c0 75 17 b8 01 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 58 c3 0f 1f 80 00 00 00 00 41 54 49 89 d4 55
  [ 2633.562332] RSP: 002b:00007fffb1a83888 EFLAGS: 00000246 ORIG_RAX: 0000000000000001
  [ 2633.563472] RAX: ffffffffffffffda RBX: 000000000000000c RCX: 00007f9977132648
  [ 2633.564541] RDX: 000000000000000c RSI: 000055b90546e230 RDI: 0000000000000001
  [ 2633.565596] RBP: 000055b90546e230 R08: 00007f9977406860 R09: 00007f9977a54740
  [ 2633.566653] R10: 0000000000000000 R11: 0000000000000246 R12: 00007f99774056e0
  [ 2633.567692] R13: 000000000000000c R14: 00007f9977400880 R15: 000000000000000c
  [ 2633.568725] ---[ end trace 10b4fe52945e544d ]---
severities:
  - score: '4.4'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47212.json
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.08965'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06971'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06987'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06977'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06953'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06935'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06899'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.08975'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09027'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09137'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09203'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09187'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09165'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09103'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09086'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09037'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09029'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09026'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09041'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.09033'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06841'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06813'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06939'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06945'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06978'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06976'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.06961'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00036'
    scoring_system: epss
    scoring_elements: '0.0696'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09902'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10302'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10364'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10366'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10377'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10429'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10484'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.11287'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '0.00205'
    scoring_system: epss
    scoring_elements: '0.28593'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-47212
weaknesses:
  - CWE-99
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47212.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-47212
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47212
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a51a6da375d82aed5c8f83abd13e7d060421bd48
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ba50cd9451f6c49cf0841c0a4a146ff6a2822699
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2274574
    reference_type:
    reference_id: 2274574
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.16:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.16:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47212
    reference_type:
    reference_id: CVE-2021-47212
  - url: https://usn.ubuntu.com/7088-1/
    reference_type:
    reference_id: USN-7088-1
  - url: https://usn.ubuntu.com/7088-2/
    reference_type:
    reference_id: USN-7088-2
  - url: https://usn.ubuntu.com/7088-3/
    reference_type:
    reference_id: USN-7088-3
  - url: https://usn.ubuntu.com/7088-4/
    reference_type:
    reference_id: USN-7088-4
  - url: https://usn.ubuntu.com/7088-5/
    reference_type:
    reference_id: USN-7088-5
  - url: https://usn.ubuntu.com/7119-1/
    reference_type:
    reference_id: USN-7119-1
