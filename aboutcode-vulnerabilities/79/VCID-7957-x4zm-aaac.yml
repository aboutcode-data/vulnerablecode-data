vulnerability_id: VCID-7957-x4zm-aaac
aliases:
  - CVE-2021-46999
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  sctp: do asoc update earlier in sctp_sf_do_dupcook_a

  There's a panic that occurs in a few of envs, the call trace is as below:

    [] general protection fault, ... 0x29acd70f1000a: 0000 [#1] SMP PTI
    [] RIP: 0010:sctp_ulpevent_notify_peer_addr_change+0x4b/0x1fa [sctp]
    []  sctp_assoc_control_transport+0x1b9/0x210 [sctp]
    []  sctp_do_8_2_transport_strike.isra.16+0x15c/0x220 [sctp]
    []  sctp_cmd_interpreter.isra.21+0x1231/0x1a10 [sctp]
    []  sctp_do_sm+0xc3/0x2a0 [sctp]
    []  sctp_generate_timeout_event+0x81/0xf0 [sctp]

  This is caused by a transport use-after-free issue. When processing a
  duplicate COOKIE-ECHO chunk in sctp_sf_do_dupcook_a(), both COOKIE-ACK
  and SHUTDOWN chunks are allocated with the transort from the new asoc.
  However, later in the sideeffect machine, the old asoc is used to send
  them out and old asoc's shutdown_last_sent_to is set to the transport
  that SHUTDOWN chunk attached to in sctp_cmd_setup_t2(), which actually
  belongs to the new asoc. After the new_asoc is freed and the old asoc
  T2 timeout, the old asoc's shutdown_last_sent_to that is already freed
  would be accessed in sctp_sf_t2_timer_expire().

  Thanks Alexander and Jere for helping dig into this issue.

  To fix it, this patch is to do the asoc update first, then allocate
  the COOKIE-ACK and SHUTDOWN chunks with the 'updated' old asoc. This
  would make more sense, as a chunk from an asoc shouldn't be sent out
  with another asoc. We had fixed quite a few issues caused by this.
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-46999.json
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01485'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01495'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01501'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01512'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01505'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01509'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01134'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01139'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01145'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01154'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01128'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01131'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01502'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01521'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01476'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01504'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01486'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01492'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00014'
    scoring_system: epss
    scoring_elements: '0.01497'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.05078'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11819'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11214'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11518'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11609'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11632'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11700'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11696'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11709'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11764'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12119'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12177'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12271'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11828'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11841'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11891'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00049'
    scoring_system: epss
    scoring_elements: '0.12177'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00049'
    scoring_system: epss
    scoring_elements: '0.12355'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00049'
    scoring_system: epss
    scoring_elements: '0.1238'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00049'
    scoring_system: epss
    scoring_elements: '0.12343'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00049'
    scoring_system: epss
    scoring_elements: '0.12309'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00049'
    scoring_system: epss
    scoring_elements: '0.12304'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00049'
    scoring_system: epss
    scoring_elements: '0.12141'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15974'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '0.00207'
    scoring_system: epss
    scoring_elements: '0.2894'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-46999
weaknesses:
  - CWE-416
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-46999.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-46999
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-46999
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/0bfd913c2121b3d553bfd52810fe6061d542d625
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/35b4f24415c854cd718ccdf38dbea6297f010aae
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/61b877bad9bb0d82b7d8841be50872557090a704
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b1b31948c0af44628e43353828453461bb74098f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d624f2991b977821375fbd56c91b0c91d456a697
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f01988ecf3654f805282dce2d3bb9afe68d2691e
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2266874
    reference_type:
    reference_id: 2266874
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-46999
    reference_type:
    reference_id: CVE-2021-46999
