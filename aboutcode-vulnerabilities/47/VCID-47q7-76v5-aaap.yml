vulnerability_id: VCID-47q7-76v5-aaap
aliases:
  - GHSA-9rg7-3j4f-cf4x
summary: "QueryInterface should call AddRef before returning pointer\nAffected version of this\
  \ crate, which is a required dependency in com-impl, \nprovides a faulty implementation of\
  \ the `IUnknown::QueryInterface` method.\n\n`QueryInterface` implementation must call `IUnknown::AddRef`\
  \ before returning the pointer,\nas describe in this documentation:\n<https://docs.microsoft.com/en-us/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(refiid_void)>\n\
  \nAs it is not incrementing the refcount as expected, the following calls to `IUnknown::Release`\
  \ method \nwill cause WMI to drop reference to the interface, and can lead to invalid reference.\n\
  \nThis is documented in <https://docs.microsoft.com/en-us/windows/win32/learnwin32/managing-the-lifetime-of-an-object#reference-counting>\n\
  \nThere is no simple workaround, as you can't know how many time QueryInterface will be called.\n\
  The only way to quick fix this is to use the macro expanded version of the code and modify\
  \ \nthe QueryInterface method to add the AddRef call yourself.\n\nThe issue was corrected\
  \ in commit `9803f31fbd1717d482d848f041044d061fca6da7`."
severities:
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-9rg7-3j4f-cf4x
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Connicpu/com-impl
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Connicpu/com-impl/commit/9803f31fbd1717d482d848f041044d061fca6da7
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/Connicpu/com-impl/issues/1
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/Connicpu/com-impl/issues/1
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2021-0083.html
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://rustsec.org/advisories/RUSTSEC-2021-0083.html
weaknesses: []
references:
  - url: https://github.com/Connicpu/com-impl
    reference_type:
    reference_id:
  - url: https://github.com/Connicpu/com-impl/commit/9803f31fbd1717d482d848f041044d061fca6da7
    reference_type:
    reference_id:
  - url: https://github.com/Connicpu/com-impl/issues/1
    reference_type:
    reference_id:
  - url: https://rustsec.org/advisories/RUSTSEC-2021-0083.html
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-9rg7-3j4f-cf4x
    reference_type:
    reference_id: GHSA-9rg7-3j4f-cf4x
