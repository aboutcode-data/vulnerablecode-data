vulnerability_id: VCID-mhws-dzm8-q7hk
aliases:
  - GHSA-r8g5-cgf2-4m4m
summary: |
  Picklescan missing detection when calling numpy.f2py.crackfortran.getlincoef
  ### Summary

  An unsafe deserialization vulnerability allows an attacker to execute arbitrary code on the host when loading a malicious pickle payload from an untrusted source.

  ### Details

  The `numpy.f2py.crackfortran` module exposes many functions that call `eval` on arbitrary strings of values. This is the case for `getlincoef` and `_eval_length`. This list is probably not exhaustive.

  According to https://numpy.org/doc/stable/reference/security.html#advice-for-using-numpy-on-untrusted-data, the whole `numpy.f2py` should be considered unsafe when loading a pickle.

  ### PoC

  ```python
  from numpy.f2py.crackfortran import getlincoef

  class EvilClass:
      def __reduce__(self):
          payload = "__import__('os').system('echo \"successful attack\"')"
          return getlincoef, (payload, [])
  ```

  ### Impact

  Who is impacted? Any organization or individual relying on `picklescan` to detect malicious pickle files from untrusted sources.
  What is the impact? Attackers can embed malicious code in pickle file that remains undetected but executes when the pickle file is loaded.
  Supply Chain Attack: Attackers can distribute infected pickle files across ML models, APIs, or saved Python objects.

  ### Note

  The problem was originally reported to the joblib project, but this was deemed unrelated to joblib itself. However, I checked that `picklescan` was indeed vulnerable.
severities:
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-r8g5-cgf2-4m4m
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan/commit/70c1c6c31beb6baaf52c8db1b6c3c0e84a6f9dab
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan/pull/53
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan/releases/tag/v0.0.33
  - score: HIGH
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan/security/advisories/GHSA-r8g5-cgf2-4m4m
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/mmaitre314/picklescan/security/advisories/GHSA-r8g5-cgf2-4m4m
weaknesses:
  - CWE-502
references:
  - url: https://github.com/mmaitre314/picklescan
    reference_type:
    reference_id:
  - url: https://github.com/mmaitre314/picklescan/commit/70c1c6c31beb6baaf52c8db1b6c3c0e84a6f9dab
    reference_type:
    reference_id:
  - url: https://github.com/mmaitre314/picklescan/pull/53
    reference_type:
    reference_id:
  - url: https://github.com/mmaitre314/picklescan/releases/tag/v0.0.33
    reference_type:
    reference_id:
  - url: https://github.com/mmaitre314/picklescan/security/advisories/GHSA-r8g5-cgf2-4m4m
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-r8g5-cgf2-4m4m
    reference_type:
    reference_id: GHSA-r8g5-cgf2-4m4m
