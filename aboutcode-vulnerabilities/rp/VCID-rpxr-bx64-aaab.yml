vulnerability_id: VCID-rpxr-bx64-aaab
aliases:
  - CVE-2021-46957
summary: "In the Linux kernel, the following vulnerability has been resolved:\n\nriscv/kprobe:\
  \ fix kernel panic when invoking sys_read traced by kprobe\n\nThe execution of sys_read end\
  \ up hitting a BUG_ON() in __find_get_block\nafter installing kprobe at sys_read, the BUG\
  \ message like the following:\n\n[   65.708663] ------------[ cut here ]------------\n[  \
  \ 65.709987] kernel BUG at fs/buffer.c:1251!\n[   65.711283] Kernel BUG [#1]\n[   65.712032]\
  \ Modules linked in:\n[   65.712925] CPU: 0 PID: 51 Comm: sh Not tainted 5.12.0-rc4 #1\n[\
  \   65.714407] Hardware name: riscv-virtio,qemu (DT)\n[   65.715696] epc : __find_get_block+0x218/0x2c8\n\
  [   65.716835]  ra : __getblk_gfp+0x1c/0x4a\n[   65.717831] epc : ffffffe00019f11e ra : ffffffe00019f56a\
  \ sp : ffffffe002437930\n[   65.719553]  gp : ffffffe000f06030 tp : ffffffe0015abc00 t0 :\
  \ ffffffe00191e038\n[   65.721290]  t1 : ffffffe00191e038 t2 : 000000000000000a s0 : ffffffe002437960\n\
  [   65.723051]  s1 : ffffffe00160ad00 a0 : ffffffe00160ad00 a1 : 000000000000012a\n[   65.724772]\
  \  a2 : 0000000000000400 a3 : 0000000000000008 a4 : 0000000000000040\n[   65.726545]  a5 :\
  \ 0000000000000000 a6 : ffffffe00191e000 a7 : 0000000000000000\n[   65.728308]  s2 : 000000000000012a\
  \ s3 : 0000000000000400 s4 : 0000000000000008\n[   65.730049]  s5 : 000000000000006c s6 :\
  \ ffffffe00240f800 s7 : ffffffe000f080a8\n[   65.731802]  s8 : 0000000000000001 s9 : 000000000000012a\
  \ s10: 0000000000000008\n[   65.733516]  s11: 0000000000000008 t3 : 00000000000003ff t4 :\
  \ 000000000000000f\n[   65.734434]  t5 : 00000000000003ff t6 : 0000000000040000\n[   65.734613]\
  \ status: 0000000000000100 badaddr: 0000000000000000 cause: 0000000000000003\n[   65.734901]\
  \ Call Trace:\n[   65.735076] [<ffffffe00019f11e>] __find_get_block+0x218/0x2c8\n[   65.735417]\
  \ [<ffffffe00020017a>] __ext4_get_inode_loc+0xb2/0x2f6\n[   65.735618] [<ffffffe000201b6c>]\
  \ ext4_get_inode_loc+0x3a/0x8a\n[   65.735802] [<ffffffe000203380>] ext4_reserve_inode_write+0x2e/0x8c\n\
  [   65.735999] [<ffffffe00020357a>] __ext4_mark_inode_dirty+0x4c/0x18e\n[   65.736208] [<ffffffe000206bb0>]\
  \ ext4_dirty_inode+0x46/0x66\n[   65.736387] [<ffffffe000192914>] __mark_inode_dirty+0x12c/0x3da\n\
  [   65.736576] [<ffffffe000180dd2>] touch_atime+0x146/0x150\n[   65.736748] [<ffffffe00010d762>]\
  \ filemap_read+0x234/0x246\n[   65.736920] [<ffffffe00010d834>] generic_file_read_iter+0xc0/0x114\n\
  [   65.737114] [<ffffffe0001f5d7a>] ext4_file_read_iter+0x42/0xea\n[   65.737310] [<ffffffe000163f2c>]\
  \ new_sync_read+0xe2/0x15a\n[   65.737483] [<ffffffe000165814>] vfs_read+0xca/0xf2\n[   65.737641]\
  \ [<ffffffe000165bae>] ksys_read+0x5e/0xc8\n[   65.737816] [<ffffffe000165c26>] sys_read+0xe/0x16\n\
  [   65.737973] [<ffffffe000003972>] ret_from_syscall+0x0/0x2\n[   65.738858] ---[ end trace\
  \ fe93f985456c935d ]---\n\nA simple reproducer looks like:\n\techo 'p:myprobe sys_read fd=%a0\
  \ buf=%a1 count=%a2' > /sys/kernel/debug/tracing/kprobe_events\n\techo 1 > /sys/kernel/debug/tracing/events/kprobes/myprobe/enable\n\
  \tcat /sys/kernel/debug/tracing/trace\n\nHere's what happens to hit that BUG_ON():\n\n1) After\
  \ installing kprobe at entry of sys_read, the first instruction\n   is replaced by 'ebreak'\
  \ instruction on riscv64 platform.\n\n2) Once kernel reach the 'ebreak' instruction at the\
  \ entry of sys_read,\n   it trap into the riscv breakpoint handler, where it do something\
  \ to\n   setup for coming single-step of origin instruction, including backup\n   the 'sstatus'\
  \ in pt_regs, followed by disable interrupt during single\n   stepping via clear 'SIE' bit\
  \ of 'sstatus' in pt_regs.\n\n3) Then kernel restore to the instruction slot contains two\
  \ instructions,\n   one is original instruction at entry of sys_read, the other is 'ebreak'.\n\
  \   Here it trigger a 'Instruction page fault' exception (value at 'scause'\n   is '0xc'),\
  \ if PF is not filled into PageTabe for that slot yet.\n\n4) Again kernel trap into page fault\
  \ exception handler, where it choose\n   different policy according to the state of running\
  \ kprobe. Because\n   afte 2) the state is KPROBE_HIT_SS, so kernel reset the current kp\n\
  ---truncated---"
severities:
  - score: '4.4'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-46957.json
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09902'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.11287'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10302'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10364'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10366'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10377'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10429'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10484'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00052'
    scoring_system: epss
    scoring_elements: '0.13358'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00052'
    scoring_system: epss
    scoring_elements: '0.1322'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00052'
    scoring_system: epss
    scoring_elements: '0.13186'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00052'
    scoring_system: epss
    scoring_elements: '0.13344'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00052'
    scoring_system: epss
    scoring_elements: '0.13395'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00052'
    scoring_system: epss
    scoring_elements: '0.13436'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18661'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18667'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18659'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18646'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18625'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18618'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18632'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18639'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.1866'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18654'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.1551'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.15511'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.15533'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.15574'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.15577'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.15544'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.15521'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.1547'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18479'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18551'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18605'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00059'
    scoring_system: epss
    scoring_elements: '0.18669'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00084'
    scoring_system: epss
    scoring_elements: '0.21792'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '0.00239'
    scoring_system: epss
    scoring_elements: '0.31879'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/b1ebaa0e1318494a7637099a26add50509e37964
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-02-28T19:51:51Z/
    published_at: None
    url: https://git.kernel.org/stable/c/b1ebaa0e1318494a7637099a26add50509e37964
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://git.kernel.org/stable/c/fd0f06590d35c99f98d12c7984897ec4201a6263
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-02-28T19:51:51Z/
    published_at: None
    url: https://git.kernel.org/stable/c/fd0f06590d35c99f98d12c7984897ec4201a6263
weaknesses:
  - CWE-20
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-46957.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-46957
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b1ebaa0e1318494a7637099a26add50509e37964
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/fd0f06590d35c99f98d12c7984897ec4201a6263
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2266463
    reference_type:
    reference_id: 2266463
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-46957
    reference_type:
    reference_id: CVE-2021-46957
