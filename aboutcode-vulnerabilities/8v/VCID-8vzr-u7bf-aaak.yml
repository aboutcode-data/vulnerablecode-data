vulnerability_id: VCID-8vzr-u7bf-aaak
aliases:
  - CVE-2024-41003
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  bpf: Fix reg_set_min_max corruption of fake_reg

  Juan reported that after doing some changes to buzzer [0] and implementing
  a new fuzzing strategy guided by coverage, they noticed the following in
  one of the probes:

    [...]
    13: (79) r6 = *(u64 *)(r0 +0)         ; R0=map_value(ks=4,vs=8) R6_w=scalar()
    14: (b7) r0 = 0                       ; R0_w=0
    15: (b4) w0 = -1                      ; R0_w=0xffffffff
    16: (74) w0 >>= 1                     ; R0_w=0x7fffffff
    17: (5c) w6 &= w0                     ; R0_w=0x7fffffff R6_w=scalar(smin=smin32=0,smax=umax=umax32=0x7fffffff,var_off=(0x0; 0x7fffffff))
    18: (44) w6 |= 2                      ; R6_w=scalar(smin=umin=smin32=umin32=2,smax=umax=umax32=0x7fffffff,var_off=(0x2; 0x7ffffffd))
    19: (56) if w6 != 0x7ffffffd goto pc+1
    REG INVARIANTS VIOLATION (true_reg2): range bounds violation u64=[0x7fffffff, 0x7ffffffd] s64=[0x7fffffff, 0x7ffffffd] u32=[0x7fffffff, 0x7ffffffd] s32=[0x7fffffff, 0x7ffffffd] var_off=(0x7fffffff, 0x0)
    REG INVARIANTS VIOLATION (false_reg1): range bounds violation u64=[0x7fffffff, 0x7ffffffd] s64=[0x7fffffff, 0x7ffffffd] u32=[0x7fffffff, 0x7ffffffd] s32=[0x7fffffff, 0x7ffffffd] var_off=(0x7fffffff, 0x0)
    REG INVARIANTS VIOLATION (false_reg2): const tnum out of sync with range bounds u64=[0x0, 0xffffffffffffffff] s64=[0x8000000000000000, 0x7fffffffffffffff] u32=[0x0, 0xffffffff] s32=[0x80000000, 0x7fffffff] var_off=(0x7fffffff, 0x0)
    19: R6_w=0x7fffffff
    20: (95) exit

    from 19 to 21: R0=0x7fffffff R6=scalar(smin=umin=smin32=umin32=2,smax=umax=smax32=umax32=0x7ffffffe,var_off=(0x2; 0x7ffffffd)) R7=map_ptr(ks=4,vs=8) R9=ctx() R10=fp0 fp-24=map_ptr(ks=4,vs=8) fp-40=mmmmmmmm
    21: R0=0x7fffffff R6=scalar(smin=umin=smin32=umin32=2,smax=umax=smax32=umax32=0x7ffffffe,var_off=(0x2; 0x7ffffffd)) R7=map_ptr(ks=4,vs=8) R9=ctx() R10=fp0 fp-24=map_ptr(ks=4,vs=8) fp-40=mmmmmmmm
    21: (14) w6 -= 2147483632             ; R6_w=scalar(smin=umin=umin32=2,smax=umax=0xffffffff,smin32=0x80000012,smax32=14,var_off=(0x2; 0xfffffffd))
    22: (76) if w6 s>= 0xe goto pc+1      ; R6_w=scalar(smin=umin=umin32=2,smax=umax=0xffffffff,smin32=0x80000012,smax32=13,var_off=(0x2; 0xfffffffd))
    23: (95) exit

    from 22 to 24: R0=0x7fffffff R6_w=14 R7=map_ptr(ks=4,vs=8) R9=ctx() R10=fp0 fp-24=map_ptr(ks=4,vs=8) fp-40=mmmmmmmm
    24: R0=0x7fffffff R6_w=14 R7=map_ptr(ks=4,vs=8) R9=ctx() R10=fp0 fp-24=map_ptr(ks=4,vs=8) fp-40=mmmmmmmm
    24: (14) w6 -= 14                     ; R6_w=0
    [...]

  What can be seen here is a register invariant violation on line 19. After
  the binary-or in line 18, the verifier knows that bit 2 is set but knows
  nothing about the rest of the content which was loaded from a map value,
  meaning, range is [2,0x7fffffff] with var_off=(0x2; 0x7ffffffd). When in
  line 19 the verifier analyzes the branch, it splits the register states
  in reg_set_min_max() into the registers of the true branch (true_reg1,
  true_reg2) and the registers of the false branch (false_reg1, false_reg2).

  Since the test is w6 != 0x7ffffffd, the src_reg is a known constant.
  Internally, the verifier creates a "fake" register initialized as scalar
  to the value of 0x7ffffffd, and then passes it onto reg_set_min_max(). Now,
  for line 19, it is mathematically impossible to take the false branch of
  this program, yet the verifier analyzes it. It is impossible because the
  second bit of r6 will be set due to the prior or operation and the
  constant in the condition has that bit unset (hex(fd) == binary(1111 1101).

  When the verifier first analyzes the false / fall-through branch, it will
  compute an intersection between the var_off of r6 and of the constant. This
  is because the verifier creates a "fake" register initialized to the value
  of the constant. The intersection result later refines both registers in
  regs_refine_cond_op():

    [...]
    t = tnum_intersect(tnum_subreg(reg1->var_off), tnum_subreg(reg2->var_off));
    reg1->var_o
  ---truncated---
severities:
  - score: '4.4'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-41003.json
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.083'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08267'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.0825'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08255'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08265'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08324'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08349'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08394'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08431'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08445'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08381'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08276'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00034'
    scoring_system: epss
    scoring_elements: '0.08223'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.11287'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10484'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09902'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10302'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10364'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10366'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10377'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10429'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.0012'
    scoring_system: epss
    scoring_elements: '0.28007'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.0012'
    scoring_system: epss
    scoring_elements: '0.28048'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.0012'
    scoring_system: epss
    scoring_elements: '0.28027'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.0012'
    scoring_system: epss
    scoring_elements: '0.28014'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.0012'
    scoring_system: epss
    scoring_elements: '0.28'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.0012'
    scoring_system: epss
    scoring_elements: '0.27851'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.0012'
    scoring_system: epss
    scoring_elements: '0.27901'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.29944'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.30013'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.29985'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.29962'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.29939'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.30014'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.29984'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00134'
    scoring_system: epss
    scoring_elements: '0.29948'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '0.00526'
    scoring_system: epss
    scoring_elements: '0.49962'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-99
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-41003.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-41003
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/41e8ab428a9964df378fa45760a660208712145b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/92424801261d1564a0bb759da3cf3ccd69fdf5a2
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2297587
    reference_type:
    reference_id: 2297587
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-41003
    reference_type:
    reference_id: CVE-2024-41003
  - url: https://usn.ubuntu.com/6999-1/
    reference_type:
    reference_id: USN-6999-1
  - url: https://usn.ubuntu.com/6999-2/
    reference_type:
    reference_id: USN-6999-2
  - url: https://usn.ubuntu.com/7004-1/
    reference_type:
    reference_id: USN-7004-1
  - url: https://usn.ubuntu.com/7005-1/
    reference_type:
    reference_id: USN-7005-1
  - url: https://usn.ubuntu.com/7005-2/
    reference_type:
    reference_id: USN-7005-2
  - url: https://usn.ubuntu.com/7008-1/
    reference_type:
    reference_id: USN-7008-1
  - url: https://usn.ubuntu.com/7029-1/
    reference_type:
    reference_id: USN-7029-1
