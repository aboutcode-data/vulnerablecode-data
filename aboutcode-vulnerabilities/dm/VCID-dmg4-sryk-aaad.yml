vulnerability_id: VCID-dmg4-sryk-aaad
aliases:
  - CVE-2021-47222
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net: bridge: fix vlan tunnel dst refcnt when egressing

  The egress tunnel code uses dst_clone() and directly sets the result
  which is wrong because the entry might have 0 refcnt or be already deleted,
  causing number of problems. It also triggers the WARN_ON() in dst_hold()[1]
  when a refcnt couldn't be taken. Fix it by using dst_hold_safe() and
  checking if a reference was actually taken before setting the dst.

  [1] dmesg WARN_ON log and following refcnt errors
   WARNING: CPU: 5 PID: 38 at include/net/dst.h:230 br_handle_egress_vlan_tunnel+0x10b/0x134 [bridge]
   Modules linked in: 8021q garp mrp bridge stp llc bonding ipv6 virtio_net
   CPU: 5 PID: 38 Comm: ksoftirqd/5 Kdump: loaded Tainted: G        W         5.13.0-rc3+ #360
   Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.14.0-1.fc33 04/01/2014
   RIP: 0010:br_handle_egress_vlan_tunnel+0x10b/0x134 [bridge]
   Code: e8 85 bc 01 e1 45 84 f6 74 90 45 31 f6 85 db 48 c7 c7 a0 02 19 a0 41 0f 94 c6 31 c9 31 d2 44 89 f6 e8 64 bc 01 e1 85 db 75 02 <0f> 0b 31 c9 31 d2 44 89 f6 48 c7 c7 70 02 19 a0 e8 4b bc 01 e1 49
   RSP: 0018:ffff8881003d39e8 EFLAGS: 00010246
   RAX: 0000000000000000 RBX: 0000000000000000 RCX: 0000000000000000
   RDX: 0000000000000000 RSI: 0000000000000001 RDI: ffffffffa01902a0
   RBP: ffff8881040c6700 R08: 0000000000000000 R09: 0000000000000001
   R10: 2ce93d0054fe0d00 R11: 54fe0d00000e0000 R12: ffff888109515000
   R13: 0000000000000000 R14: 0000000000000001 R15: 0000000000000401
   FS:  0000000000000000(0000) GS:ffff88822bf40000(0000) knlGS:0000000000000000
   CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
   CR2: 00007f42ba70f030 CR3: 0000000109926000 CR4: 00000000000006e0
   Call Trace:
    br_handle_vlan+0xbc/0xca [bridge]
    __br_forward+0x23/0x164 [bridge]
    deliver_clone+0x41/0x48 [bridge]
    br_handle_frame_finish+0x36f/0x3aa [bridge]
    ? skb_dst+0x2e/0x38 [bridge]
    ? br_handle_ingress_vlan_tunnel+0x3e/0x1c8 [bridge]
    ? br_handle_frame_finish+0x3aa/0x3aa [bridge]
    br_handle_frame+0x2c3/0x377 [bridge]
    ? __skb_pull+0x33/0x51
    ? vlan_do_receive+0x4f/0x36a
    ? br_handle_frame_finish+0x3aa/0x3aa [bridge]
    __netif_receive_skb_core+0x539/0x7c6
    ? __list_del_entry_valid+0x16e/0x1c2
    __netif_receive_skb_list_core+0x6d/0xd6
    netif_receive_skb_list_internal+0x1d9/0x1fa
    gro_normal_list+0x22/0x3e
    dev_gro_receive+0x55b/0x600
    ? detach_buf_split+0x58/0x140
    napi_gro_receive+0x94/0x12e
    virtnet_poll+0x15d/0x315 [virtio_net]
    __napi_poll+0x2c/0x1c9
    net_rx_action+0xe6/0x1fb
    __do_softirq+0x115/0x2d8
    run_ksoftirqd+0x18/0x20
    smpboot_thread_fn+0x183/0x19c
    ? smpboot_unregister_percpu_thread+0x66/0x66
    kthread+0x10a/0x10f
    ? kthread_mod_delayed_work+0xb6/0xb6
    ret_from_fork+0x22/0x30
   ---[ end trace 49f61b07f775fd2b ]---
   dst_release: dst:00000000c02d677a refcnt:-1
   dst_release underflow
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47222.json
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11214'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11518'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11609'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11632'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11700'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11696'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11709'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11764'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11819'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12119'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12177'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12271'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11828'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11841'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12225'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11891'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30555'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26286'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30597'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30565'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26237'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.2639'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26409'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26419'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26421'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26379'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26352'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26358'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26392'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.2643'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26396'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26387'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.26362'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30505'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30569'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30635'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30681'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30685'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.3062'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30603'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30596'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30587'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00109'
    scoring_system: epss
    scoring_elements: '0.30616'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '0.00463'
    scoring_system: epss
    scoring_elements: '0.47176'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses: []
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47222.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-47222
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47222
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/25053a8404ba17ca48f5553d487afc1882e9f56c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/42020f7f37a90d24b9551f5f7eba3f7c7c102968
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/79855be6445b6592bddb7bd7167083ec8cdbd73f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/84fc1c944e45ab317e2e70a0e7f76fa2a5e43b6e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cfc579f9d89af4ada58c69b03bcaa4887840f3b3
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/fc7fdd8c5c2ad2fe3e297698be9d4dbe4a4e0579
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2282596
    reference_type:
    reference_id: 2282596
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47222
    reference_type:
    reference_id: CVE-2021-47222
