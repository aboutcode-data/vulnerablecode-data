vulnerability_id: VCID-bs57-c3ag-aaas
aliases:
  - CVE-2021-47597
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  inet_diag: fix kernel-infoleak for UDP sockets

  KMSAN reported a kernel-infoleak [1], that can exploited
  by unpriv users.

  After analysis it turned out UDP was not initializing
  r->idiag_expires. Other users of inet_sk_diag_fill()
  might make the same mistake in the future, so fix this
  in inet_sk_diag_fill().

  [1]
  BUG: KMSAN: kernel-infoleak in instrument_copy_to_user include/linux/instrumented.h:121 [inline]
  BUG: KMSAN: kernel-infoleak in copyout lib/iov_iter.c:156 [inline]
  BUG: KMSAN: kernel-infoleak in _copy_to_iter+0x69d/0x25c0 lib/iov_iter.c:670
   instrument_copy_to_user include/linux/instrumented.h:121 [inline]
   copyout lib/iov_iter.c:156 [inline]
   _copy_to_iter+0x69d/0x25c0 lib/iov_iter.c:670
   copy_to_iter include/linux/uio.h:155 [inline]
   simple_copy_to_iter+0xf3/0x140 net/core/datagram.c:519
   __skb_datagram_iter+0x2cb/0x1280 net/core/datagram.c:425
   skb_copy_datagram_iter+0xdc/0x270 net/core/datagram.c:533
   skb_copy_datagram_msg include/linux/skbuff.h:3657 [inline]
   netlink_recvmsg+0x660/0x1c60 net/netlink/af_netlink.c:1974
   sock_recvmsg_nosec net/socket.c:944 [inline]
   sock_recvmsg net/socket.c:962 [inline]
   sock_read_iter+0x5a9/0x630 net/socket.c:1035
   call_read_iter include/linux/fs.h:2156 [inline]
   new_sync_read fs/read_write.c:400 [inline]
   vfs_read+0x1631/0x1980 fs/read_write.c:481
   ksys_read+0x28c/0x520 fs/read_write.c:619
   __do_sys_read fs/read_write.c:629 [inline]
   __se_sys_read fs/read_write.c:627 [inline]
   __x64_sys_read+0xdb/0x120 fs/read_write.c:627
   do_syscall_x64 arch/x86/entry/common.c:51 [inline]
   do_syscall_64+0x54/0xd0 arch/x86/entry/common.c:82
   entry_SYSCALL_64_after_hwframe+0x44/0xae

  Uninit was created at:
   slab_post_alloc_hook mm/slab.h:524 [inline]
   slab_alloc_node mm/slub.c:3251 [inline]
   __kmalloc_node_track_caller+0xe0c/0x1510 mm/slub.c:4974
   kmalloc_reserve net/core/skbuff.c:354 [inline]
   __alloc_skb+0x545/0xf90 net/core/skbuff.c:426
   alloc_skb include/linux/skbuff.h:1126 [inline]
   netlink_dump+0x3d5/0x16a0 net/netlink/af_netlink.c:2245
   __netlink_dump_start+0xd1c/0xee0 net/netlink/af_netlink.c:2370
   netlink_dump_start include/linux/netlink.h:254 [inline]
   inet_diag_handler_cmd+0x2e7/0x400 net/ipv4/inet_diag.c:1343
   sock_diag_rcv_msg+0x24a/0x620
   netlink_rcv_skb+0x447/0x800 net/netlink/af_netlink.c:2491
   sock_diag_rcv+0x63/0x80 net/core/sock_diag.c:276
   netlink_unicast_kernel net/netlink/af_netlink.c:1319 [inline]
   netlink_unicast+0x1095/0x1360 net/netlink/af_netlink.c:1345
   netlink_sendmsg+0x16f3/0x1870 net/netlink/af_netlink.c:1916
   sock_sendmsg_nosec net/socket.c:704 [inline]
   sock_sendmsg net/socket.c:724 [inline]
   sock_write_iter+0x594/0x690 net/socket.c:1057
   do_iter_readv_writev+0xa7f/0xc70
   do_iter_write+0x52c/0x1500 fs/read_write.c:851
   vfs_writev fs/read_write.c:924 [inline]
   do_writev+0x63f/0xe30 fs/read_write.c:967
   __do_sys_writev fs/read_write.c:1040 [inline]
   __se_sys_writev fs/read_write.c:1037 [inline]
   __x64_sys_writev+0xe5/0x120 fs/read_write.c:1037
   do_syscall_x64 arch/x86/entry/common.c:51 [inline]
   do_syscall_64+0x54/0xd0 arch/x86/entry/common.c:82
   entry_SYSCALL_64_after_hwframe+0x44/0xae

  Bytes 68-71 of 312 are uninitialized
  Memory access of size 312 starts at ffff88812ab54000
  Data copied to user address 0000000020001440

  CPU: 1 PID: 6365 Comm: syz-executor801 Not tainted 5.16.0-rc3-syzkaller #0
  Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
severities:
  - score: '6.1'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:L
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47597.json
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09009'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09056'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09079'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09103'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09135'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09107'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09091'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.0908'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09071'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09083'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09033'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09058'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.09044'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.08923'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.0004'
    scoring_system: epss
    scoring_elements: '0.08908'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12398'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12264'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12318'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12421'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12491'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12495'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.1247'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12428'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12414'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12395'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12397'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12413'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12415'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12409'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17142'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17069'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17041'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16947'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17329'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17226'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17164'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17147'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.16666'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17338'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17624'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17315'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17350'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17830'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17732'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00045'
    scoring_system: epss
    scoring_elements: '0.17645'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '0.00169'
    scoring_system: epss
    scoring_elements: '0.24904'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
  - score: '3.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-47597
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-47597
weaknesses:
  - CWE-908
  - CWE-402
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47597.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-47597
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47597
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3a4f6dba1eb98101abc012ef968a8b10dac1ce50
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/71ddeac8cd1d217744a0e060ff520e147c9328d1
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7b5596e531253ce84213d9daa7120b71c9d83198
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e5d28205bf1de7082d904ed277ceb2db2879e302
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2293229
    reference_type:
    reference_id: 2293229
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47597
    reference_type:
    reference_id: CVE-2021-47597
