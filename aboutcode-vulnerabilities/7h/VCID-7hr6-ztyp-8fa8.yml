vulnerability_id: VCID-7hr6-ztyp-8fa8
aliases:
  - CVE-2025-22123
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  f2fs: fix to avoid accessing uninitialized curseg

  syzbot reports a f2fs bug as below:

  F2FS-fs (loop3): Stopped filesystem due to reason: 7
  kworker/u8:7: attempt to access beyond end of device
  BUG: unable to handle page fault for address: ffffed1604ea3dfa
  RIP: 0010:get_ckpt_valid_blocks fs/f2fs/segment.h:361 [inline]
  RIP: 0010:has_curseg_enough_space fs/f2fs/segment.h:570 [inline]
  RIP: 0010:__get_secs_required fs/f2fs/segment.h:620 [inline]
  RIP: 0010:has_not_enough_free_secs fs/f2fs/segment.h:633 [inline]
  RIP: 0010:has_enough_free_secs+0x575/0x1660 fs/f2fs/segment.h:649
   <TASK>
   f2fs_is_checkpoint_ready fs/f2fs/segment.h:671 [inline]
   f2fs_write_inode+0x425/0x540 fs/f2fs/inode.c:791
   write_inode fs/fs-writeback.c:1525 [inline]
   __writeback_single_inode+0x708/0x10d0 fs/fs-writeback.c:1745
   writeback_sb_inodes+0x820/0x1360 fs/fs-writeback.c:1976
   wb_writeback+0x413/0xb80 fs/fs-writeback.c:2156
   wb_do_writeback fs/fs-writeback.c:2303 [inline]
   wb_workfn+0x410/0x1080 fs/fs-writeback.c:2343
   process_one_work kernel/workqueue.c:3236 [inline]
   process_scheduled_works+0xa66/0x1840 kernel/workqueue.c:3317
   worker_thread+0x870/0xd30 kernel/workqueue.c:3398
   kthread+0x7a9/0x920 kernel/kthread.c:464
   ret_from_fork+0x4b/0x80 arch/x86/kernel/process.c:148
   ret_from_fork_asm+0x1a/0x30 arch/x86/entry/entry_64.S:244

  Commit 8b10d3653735 ("f2fs: introduce FAULT_NO_SEGMENT") allows to trigger
  no free segment fault in allocator, then it will update curseg->segno to
  NULL_SEGNO, though, CP_ERROR_FLAG has been set, f2fs_write_inode() missed
  to check the flag, and access invalid curseg->segno directly in below call
  path, then resulting in panic:

  - f2fs_write_inode
   - f2fs_is_checkpoint_ready
    - has_enough_free_secs
     - has_not_enough_free_secs
      - __get_secs_required
       - has_curseg_enough_space
        - get_ckpt_valid_blocks
        : access invalid curseg->segno

  To avoid this issue, let's:
  - check CP_ERROR_FLAG flag in prior to f2fs_is_checkpoint_ready() in
  f2fs_write_inode().
  - in has_curseg_enough_space(), save curseg->segno into a temp variable,
  and verify its validation before use.
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-22123.json
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03277'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03268'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03279'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03264'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03263'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04937'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04901'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04923'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04919'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04929'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04931'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04944'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses: []
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2025-22123.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2025-22123
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7f90e5d423cd2d4c74b2abb527872f335108637f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/986c50f6bca109c6cf362b4e2babcb85aba958f6
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2360272
    reference_type:
    reference_id: 2360272
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-22123
    reference_type:
    reference_id: CVE-2025-22123
