vulnerability_id: VCID-u8z2-ujs5-aaan
aliases:
  - CVE-2024-32649
  - GHSA-5jrj-52x8-m64h
  - PYSEC-2024-209
summary: "vyper performs double eval of the argument of sqrt\n### Summary\nUsing the `sqrt`\
  \ builtin can result in multiple eval evaluation of side effects when the argument has side-effects.\
  \ The bug is more difficult (but not impossible!) to trigger as of 0.3.4, when the unique\
  \ symbol fence was introduced (https://github.com/vyperlang/vyper/pull/2914).\n\nA contract\
  \ search was performed and no vulnerable contracts were found in production.\n\n### Details\n\
  It can be seen that the `build_IR` function of the `sqrt` builtin doesn't cache the argument\
  \ to the stack: \nhttps://github.com/vyperlang/vyper/blob/4595938734d9988f8e46e8df38049ae0559abedb/vyper/builtins/functions.py#L2151\n\
  \nAs such, it can be evaluated multiple times (instead of retrieving the value from the stack).\n\
  \n### PoC\nWith at least Vyper version `0.2.15+commit.6e7dba7` the following contract:\n```vyper\n\
  c: uint256\n\n@internal\ndef some_decimal() -> decimal:\n    self.c += 1\n    return 1.0\n\
  \n@external\ndef foo() -> uint256:\n    k: decimal = sqrt(self.some_decimal())\n    return\
  \ self.c\n```\npasses the following test:\n```solidity\n// SPDX-License-Identifier: MIT\n\
  pragma solidity >=0.8.13;\n\nimport \"../../lib/ds-test/test.sol\";\nimport \"../../lib/utils/Console.sol\"\
  ;\nimport \"../../lib/utils/VyperDeployer.sol\";\n\nimport \"../ITest.sol\";\n\ncontract ConTest\
  \ is DSTest {\n    VyperDeployer vyperDeployer = new VyperDeployer();\n\n    ITest t;\n\n\
  \    function setUp() public {\n        t = ITest(vyperDeployer.deployContract(\"Test\"));\n\
  \    }\n\n    function testFoo() public {\n        uint256 val = t.foo();\n        console.log(val);\n\
  \        assert (val == 4);\n    }\n}\n```\n \n\n### Impact\nNo vulnerable production contracts\
  \ were found."
severities:
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10429'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10484'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10377'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09902'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10302'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10364'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10366'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00046'
    scoring_system: epss
    scoring_elements: '0.19104'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26279'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26257'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26275'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26239'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26174'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26255'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26249'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26265'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26285'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26235'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26324'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26323'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.00086'
    scoring_system: epss
    scoring_elements: '0.26242'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63783'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63694'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63672'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63767'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.6377'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63789'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63803'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63782'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63781'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.6376'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63775'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63794'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63792'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63786'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.0051'
    scoring_system: epss
    scoring_elements: '0.63772'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: '0.01061'
    scoring_system: epss
    scoring_elements: '0.64206'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/advisories/GHSA-5jrj-52x8-m64h
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/pypa/advisory-database/tree/main/vulns/vyper/PYSEC-2024-209.yaml
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/pypa/advisory-database/tree/main/vulns/vyper/PYSEC-2024-209.yaml
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/vyperlang/vyper
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vyperlang/vyper
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/vyperlang/vyper/pull/2914
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vyperlang/vyper/pull/2914
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/vyperlang/vyper/security/advisories/GHSA-5jrj-52x8-m64h
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/vyperlang/vyper/security/advisories/GHSA-5jrj-52x8-m64h
  - score: MODERATE
    scoring_system: cvssv3.1_qr
    scoring_elements:
    published_at: None
    url: https://github.com/vyperlang/vyper/security/advisories/GHSA-5jrj-52x8-m64h
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/vyperlang/vyper/security/advisories/GHSA-5jrj-52x8-m64h
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-32649
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-32649
weaknesses:
  - CWE-937
  - CWE-1035
  - CWE-95
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-32649
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/vyper/PYSEC-2024-209.yaml
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper/pull/2914
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper/security/advisories/GHSA-5jrj-52x8-m64h
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-32649
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:a:vyperlang:vyper:*:*:*:*:*:python:*:*
    reference_type:
    reference_id: cpe:2.3:a:vyperlang:vyper:*:*:*:*:*:python:*:*
  - url: https://github.com/advisories/GHSA-5jrj-52x8-m64h
    reference_type:
    reference_id: GHSA-5jrj-52x8-m64h
