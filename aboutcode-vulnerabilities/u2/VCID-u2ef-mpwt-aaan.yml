vulnerability_id: VCID-u2ef-mpwt-aaan
aliases:
  - CVE-2021-47256
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mm/memory-failure: make sure wait for page writeback in memory_failure

  Our syzkaller trigger the "BUG_ON(!list_empty(&inode->i_wb_list))" in
  clear_inode:

    kernel BUG at fs/inode.c:519!
    Internal error: Oops - BUG: 0 [#1] SMP
    Modules linked in:
    Process syz-executor.0 (pid: 249, stack limit = 0x00000000a12409d7)
    CPU: 1 PID: 249 Comm: syz-executor.0 Not tainted 4.19.95
    Hardware name: linux,dummy-virt (DT)
    pstate: 80000005 (Nzcv daif -PAN -UAO)
    pc : clear_inode+0x280/0x2a8
    lr : clear_inode+0x280/0x2a8
    Call trace:
      clear_inode+0x280/0x2a8
      ext4_clear_inode+0x38/0xe8
      ext4_free_inode+0x130/0xc68
      ext4_evict_inode+0xb20/0xcb8
      evict+0x1a8/0x3c0
      iput+0x344/0x460
      do_unlinkat+0x260/0x410
      __arm64_sys_unlinkat+0x6c/0xc0
      el0_svc_common+0xdc/0x3b0
      el0_svc_handler+0xf8/0x160
      el0_svc+0x10/0x218
    Kernel panic - not syncing: Fatal exception

  A crash dump of this problem show that someone called __munlock_pagevec
  to clear page LRU without lock_page: do_mmap -> mmap_region -> do_munmap
  -> munlock_vma_pages_range -> __munlock_pagevec.

  As a result memory_failure will call identify_page_state without
  wait_on_page_writeback.  And after truncate_error_page clear the mapping
  of this page.  end_page_writeback won't call sb_clear_inode_writeback to
  clear inode->i_wb_list.  That will trigger BUG_ON in clear_inode!

  Fix it by checking PageWriteback too to help determine should we skip
  wait_on_page_writeback.
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47256.json
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11214'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11518'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11609'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11632'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11700'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11696'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11709'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11764'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11819'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12119'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12177'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12271'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11828'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11841'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.12225'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.11891'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27717'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23799'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27741'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27722'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23735'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23887'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23911'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23918'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23923'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23876'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23845'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23861'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23922'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23908'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23866'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.2385'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.23823'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27695'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27757'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.278'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.2784'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27834'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27786'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27768'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27753'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27749'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27763'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0.00396'
    scoring_system: epss
    scoring_elements: '0.43564'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
  - score: '0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:N
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-567
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2021-47256.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2021-47256
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47256
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/28788dc5c70597395b6b451dae4549bbaa8e2c56
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/566345aaabac853aa866f53a219c4b02a6beb527
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6d210d547adc2218ef8b5bcf23518c5f2f1fd872
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9e379da727a7a031be9b877cde7b9c34a0fb8306
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d05267fd27a5c4f54e06daefa3035995d765ca0c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e8675d291ac007e1c636870db880f837a9ea112a
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2282554
    reference_type:
    reference_id: 2282554
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47256
    reference_type:
    reference_id: CVE-2021-47256
