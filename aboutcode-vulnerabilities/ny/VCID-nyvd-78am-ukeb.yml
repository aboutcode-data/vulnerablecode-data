vulnerability_id: VCID-nyvd-78am-ukeb
aliases:
  - CVE-2024-58098
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  bpf: track changes_pkt_data property for global functions

  When processing calls to certain helpers, verifier invalidates all
  packet pointers in a current state. For example, consider the
  following program:

      __attribute__((__noinline__))
      long skb_pull_data(struct __sk_buff *sk, __u32 len)
      {
          return bpf_skb_pull_data(sk, len);
      }

      SEC("tc")
      int test_invalidate_checks(struct __sk_buff *sk)
      {
          int *p = (void *)(long)sk->data;
          if ((void *)(p + 1) > (void *)(long)sk->data_end) return TCX_DROP;
          skb_pull_data(sk, 0);
          *p = 42;
          return TCX_PASS;
      }

  After a call to bpf_skb_pull_data() the pointer 'p' can't be used
  safely. See function filter.c:bpf_helper_changes_pkt_data() for a list
  of such helpers.

  At the moment verifier invalidates packet pointers when processing
  helper function calls, and does not traverse global sub-programs when
  processing calls to global sub-programs. This means that calls to
  helpers done from global sub-programs do not invalidate pointers in
  the caller state. E.g. the program above is unsafe, but is not
  rejected by verifier.

  This commit fixes the omission by computing field
  bpf_subprog_info->changes_pkt_data for each sub-program before main
  verification pass.
  changes_pkt_data should be set if:
  - subprogram calls helper for which bpf_helper_changes_pkt_data
    returns true;
  - subprogram calls a global function,
    for which bpf_subprog_info->changes_pkt_data should be set.

  The verifier.c:check_cfg() pass is modified to compute this
  information. The commit relies on depth first instruction traversal
  done by check_cfg() and absence of recursive function calls:
  - check_cfg() would eventually visit every call to subprogram S in a
    state when S is fully explored;
  - when S is fully explored:
    - every direct helper call within S is explored
      (and thus changes_pkt_data is set if needed);
    - every call to subprogram S1 called by S was visited with S1 fully
      explored (and thus S inherits changes_pkt_data from S1).

  The downside of such approach is that dead code elimination is not
  taken into account: if a helper call inside global function is dead
  because of current configuration, verifier would conservatively assume
  that the call occurs for the purpose of the changes_pkt_data
  computation.
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-58098.json
  - score: '6.0'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-58098.json
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01741'
    published_at: '2026-01-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00013'
    scoring_system: epss
    scoring_elements: '0.01763'
    published_at: '2026-01-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02537'
    published_at: '2025-05-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00017'
    scoring_system: epss
    scoring_elements: '0.02526'
    published_at: '2025-05-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03121'
    published_at: '2025-05-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03133'
    published_at: '2025-05-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00018'
    scoring_system: epss
    scoring_elements: '0.03169'
    published_at: '2025-05-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.0002'
    scoring_system: epss
    scoring_elements: '0.0399'
    published_at: '2025-10-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.0002'
    scoring_system: epss
    scoring_elements: '0.03917'
    published_at: '2025-10-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.0002'
    scoring_system: epss
    scoring_elements: '0.03882'
    published_at: '2025-10-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.0002'
    scoring_system: epss
    scoring_elements: '0.03918'
    published_at: '2025-10-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.0002'
    scoring_system: epss
    scoring_elements: '0.04022'
    published_at: '2025-10-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00021'
    scoring_system: epss
    scoring_elements: '0.0419'
    published_at: '2025-10-01 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04384'
    published_at: '2025-06-01 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04366'
    published_at: '2025-06-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04303'
    published_at: '2025-06-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.043'
    published_at: '2025-05-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04329'
    published_at: '2025-05-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04317'
    published_at: '2025-05-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04375'
    published_at: '2025-05-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.0437'
    published_at: '2025-05-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04421'
    published_at: '2025-05-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04387'
    published_at: '2025-05-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04341'
    published_at: '2025-05-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04349'
    published_at: '2025-05-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04327'
    published_at: '2025-05-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04304'
    published_at: '2025-05-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04297'
    published_at: '2025-05-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04292'
    published_at: '2025-05-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04296'
    published_at: '2025-05-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04298'
    published_at: '2025-05-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04277'
    published_at: '2025-05-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00022'
    scoring_system: epss
    scoring_elements: '0.04289'
    published_at: '2025-05-31 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05071'
    published_at: '2025-10-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04787'
    published_at: '2025-06-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04792'
    published_at: '2025-06-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04803'
    published_at: '2025-06-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04761'
    published_at: '2025-06-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04735'
    published_at: '2025-06-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04806'
    published_at: '2025-06-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04818'
    published_at: '2025-06-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04778'
    published_at: '2025-06-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04855'
    published_at: '2025-07-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04752'
    published_at: '2025-07-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04779'
    published_at: '2025-07-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05091'
    published_at: '2025-10-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05098'
    published_at: '2025-11-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05111'
    published_at: '2025-10-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05081'
    published_at: '2025-10-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05054'
    published_at: '2025-10-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05017'
    published_at: '2025-10-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.0503'
    published_at: '2025-10-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05012'
    published_at: '2025-10-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.04999'
    published_at: '2025-10-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.0499'
    published_at: '2025-10-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05003'
    published_at: '2025-10-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05018'
    published_at: '2025-10-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00024'
    scoring_system: epss
    scoring_elements: '0.05122'
    published_at: '2025-11-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.05065'
    published_at: '2025-08-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.05154'
    published_at: '2025-07-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.04977'
    published_at: '2025-08-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.0498'
    published_at: '2025-08-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.04989'
    published_at: '2025-08-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.04988'
    published_at: '2025-08-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.05024'
    published_at: '2025-08-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.04939'
    published_at: '2025-08-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.0503'
    published_at: '2025-07-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.05036'
    published_at: '2025-07-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.05117'
    published_at: '2025-07-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.05112'
    published_at: '2025-07-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.05108'
    published_at: '2025-07-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00025'
    scoring_system: epss
    scoring_elements: '0.05116'
    published_at: '2025-07-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07862'
    published_at: '2025-09-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07824'
    published_at: '2025-09-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07893'
    published_at: '2025-09-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.0788'
    published_at: '2025-09-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.08052'
    published_at: '2025-09-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.08034'
    published_at: '2025-09-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.08042'
    published_at: '2025-09-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07822'
    published_at: '2025-09-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07588'
    published_at: '2025-09-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.0757'
    published_at: '2025-09-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07595'
    published_at: '2025-09-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07698'
    published_at: '2025-09-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07673'
    published_at: '2025-09-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '0.00032'
    scoring_system: epss
    scoring_elements: '0.07784'
    published_at: '2025-09-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-665
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2024-58098.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-58098
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-58098
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/1d572c60488b52882b719ed273767ee3b280413d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/51081a3f25c742da5a659d7fc6fd77ebfdd555be
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/79751e9227a5910c0e5a2c7186877d91821d957d
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2364096
    reference_type:
    reference_id: 2364096
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-58098
    reference_type:
    reference_id: CVE-2024-58098
