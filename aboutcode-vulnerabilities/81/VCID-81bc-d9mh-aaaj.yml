vulnerability_id: VCID-81bc-d9mh-aaaj
aliases:
  - CVE-2023-52803
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  SUNRPC: Fix RPC client cleaned up the freed pipefs dentries

  RPC client pipefs dentries cleanup is in separated rpc_remove_pipedir()
  workqueue,which takes care about pipefs superblock locking.
  In some special scenarios, when kernel frees the pipefs sb of the
  current client and immediately alloctes a new pipefs sb,
  rpc_remove_pipedir function would misjudge the existence of pipefs
  sb which is not the one it used to hold. As a result,
  the rpc_remove_pipedir would clean the released freed pipefs dentries.

  To fix this issue, rpc_remove_pipedir should check whether the
  current pipefs sb is consistent with the original pipefs sb.

  This error can be catched by KASAN:
  =========================================================
  [  250.497700] BUG: KASAN: slab-use-after-free in dget_parent+0x195/0x200
  [  250.498315] Read of size 4 at addr ffff88800a2ab804 by task kworker/0:18/106503
  [  250.500549] Workqueue: events rpc_free_client_work
  [  250.501001] Call Trace:
  [  250.502880]  kasan_report+0xb6/0xf0
  [  250.503209]  ? dget_parent+0x195/0x200
  [  250.503561]  dget_parent+0x195/0x200
  [  250.503897]  ? __pfx_rpc_clntdir_depopulate+0x10/0x10
  [  250.504384]  rpc_rmdir_depopulate+0x1b/0x90
  [  250.504781]  rpc_remove_client_dir+0xf5/0x150
  [  250.505195]  rpc_free_client_work+0xe4/0x230
  [  250.505598]  process_one_work+0x8ee/0x13b0
  ...
  [   22.039056] Allocated by task 244:
  [   22.039390]  kasan_save_stack+0x22/0x50
  [   22.039758]  kasan_set_track+0x25/0x30
  [   22.040109]  __kasan_slab_alloc+0x59/0x70
  [   22.040487]  kmem_cache_alloc_lru+0xf0/0x240
  [   22.040889]  __d_alloc+0x31/0x8e0
  [   22.041207]  d_alloc+0x44/0x1f0
  [   22.041514]  __rpc_lookup_create_exclusive+0x11c/0x140
  [   22.041987]  rpc_mkdir_populate.constprop.0+0x5f/0x110
  [   22.042459]  rpc_create_client_dir+0x34/0x150
  [   22.042874]  rpc_setup_pipedir_sb+0x102/0x1c0
  [   22.043284]  rpc_client_register+0x136/0x4e0
  [   22.043689]  rpc_new_client+0x911/0x1020
  [   22.044057]  rpc_create_xprt+0xcb/0x370
  [   22.044417]  rpc_create+0x36b/0x6c0
  ...
  [   22.049524] Freed by task 0:
  [   22.049803]  kasan_save_stack+0x22/0x50
  [   22.050165]  kasan_set_track+0x25/0x30
  [   22.050520]  kasan_save_free_info+0x2b/0x50
  [   22.050921]  __kasan_slab_free+0x10e/0x1a0
  [   22.051306]  kmem_cache_free+0xa5/0x390
  [   22.051667]  rcu_core+0x62c/0x1930
  [   22.051995]  __do_softirq+0x165/0x52a
  [   22.052347]
  [   22.052503] Last potentially related work creation:
  [   22.052952]  kasan_save_stack+0x22/0x50
  [   22.053313]  __kasan_record_aux_stack+0x8e/0xa0
  [   22.053739]  __call_rcu_common.constprop.0+0x6b/0x8b0
  [   22.054209]  dentry_free+0xb2/0x140
  [   22.054540]  __dentry_kill+0x3be/0x540
  [   22.054900]  shrink_dentry_list+0x199/0x510
  [   22.055293]  shrink_dcache_parent+0x190/0x240
  [   22.055703]  do_one_tree+0x11/0x40
  [   22.056028]  shrink_dcache_for_umount+0x61/0x140
  [   22.056461]  generic_shutdown_super+0x70/0x590
  [   22.056879]  kill_anon_super+0x3a/0x60
  [   22.057234]  rpc_kill_sb+0x121/0x200
severities:
  - score: '5.5'
    scoring_system: cvssv3
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2023-52803.json
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14083'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14371'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14461'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14482'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14548'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14541'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14556'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14611'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14691'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14976'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.15033'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.15128'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14714'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14726'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.15080'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00044'
    scoring_system: epss
    scoring_elements: '0.14767'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.3797'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.37954'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.38023'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.38094'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.38138'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.38142'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.38043'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.3804'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.38047'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.38041'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.38022'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.38037'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.38026'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00161'
    scoring_system: epss
    scoring_elements: '0.37998'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.4788'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47843'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47826'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47872'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47857'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47729'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47707'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47839'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47838'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47853'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47863'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47836'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47806'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47829'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.00272'
    scoring_system: epss
    scoring_elements: '0.47851'
    published_at: '2025-04-09 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '0.01141'
    scoring_system: epss
    scoring_elements: '0.65416'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
  - score: '6.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
weaknesses:
  - CWE-416
references:
  - url: https://access.redhat.com/hydra/rest/securitydata/cve/CVE-2023-52803.json
    reference_type:
    reference_id:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2023-52803
    reference_type:
    reference_id:
  - url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-52803
    reference_type:
    reference_id:
  - url: https://ftp.suse.com/pub/projects/security/yaml/suse-cvss-scores.yaml
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/17866066b8ac1cc38fb449670bc15dc9fee4b40a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/194454afa6aa9d6ed74f0c57127bc8beb27c20df
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/1cdb52ffd6600a37bd355d8dce58ecd03e55e618
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7749fd2dbef72a52b5c9ffdbf877691950ed4680
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7d61d1da2ed1f682c41cae0c8d4719cdaccee5c5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/bfca5fb4e97c46503ddfc582335917b0cc228264
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cc2e7ebbeb1d0601f7f3c8d93b78fcc03a95e44a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/dedf2a0eb9448ae73b270743e6ea9b108189df46
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2282727
    reference_type:
    reference_id: 2282727
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-52803
    reference_type:
    reference_id: CVE-2023-52803
  - url: https://access.redhat.com/errata/RHSA-2024:5101
    reference_type:
    reference_id: RHSA-2024:5101
  - url: https://access.redhat.com/errata/RHSA-2024:5102
    reference_type:
    reference_id: RHSA-2024:5102
  - url: https://usn.ubuntu.com/7003-1/
    reference_type:
    reference_id: USN-7003-1
  - url: https://usn.ubuntu.com/7003-2/
    reference_type:
    reference_id: USN-7003-2
  - url: https://usn.ubuntu.com/7003-3/
    reference_type:
    reference_id: USN-7003-3
  - url: https://usn.ubuntu.com/7003-4/
    reference_type:
    reference_id: USN-7003-4
  - url: https://usn.ubuntu.com/7003-5/
    reference_type:
    reference_id: USN-7003-5
  - url: https://usn.ubuntu.com/7006-1/
    reference_type:
    reference_id: USN-7006-1
