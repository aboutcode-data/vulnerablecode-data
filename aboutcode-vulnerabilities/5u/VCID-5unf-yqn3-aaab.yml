vulnerability_id: VCID-5unf-yqn3-aaab
aliases:
  - CVE-2024-38351
  - GHSA-m93w-4fxv-r35v
summary: |
  PocketBase performs password auth and OAuth2 unverified email linking
  **In order to be exploited you must have both OAuth2 and Password auth methods enabled.**

  A possible attack scenario could be:
  - a malicious actor register with the targeted user's email (it is unverified)
  - at some later point in time the targeted user stumble on your app and decides to sign-up with OAuth2 (_this step could be also initiated by the attacker by sending an invite email to the targeted user_)
  - on successful OAuth2 auth we search for an existing PocketBase user matching with the OAuth2 user's email and associate them
  - because we haven't changed the password of the existing PocketBase user during the linking, the malicious actor has access to the targeted user account and will be able to login with the initially created email/password

  To prevent this for happening we now reset the password for this specific case if the previously created user wasn't verified (an exception to this is if the linking is explicit/manual, aka. when you send `Authorization:TOKEN` with the OAuth2 auth call).

  Additionally to warn existing users we now send an email alert in case the user has logged in with password but has at least one OAuth2 account linked. It looks something like:

  _Hello,
  Just to let you know that someone has logged in to your Acme account using a password while you already have OAuth2 GitLab auth linked.
  If you have recently signed in with a password, you may disregard this email.
  **If you don't recognize the above action, you should immediately change your Acme account password.**
  Thanks,
  Acme team_

  The flow will be further improved with the [ongoing refactoring](https://github.com/pocketbase/pocketbase/discussions/4355) and we will start sending emails for "unrecognized device" logins (OTP and MFA is already implemented and will be available with the next v0.23.0 release in the near future).
severities:
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10377'
    published_at: '2024-11-26 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10429'
    published_at: '2024-11-28 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10484'
    published_at: '2024-12-03 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10788'
    published_at: '2024-12-11 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10843'
    published_at: '2024-12-13 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10939'
    published_at: '2024-12-15 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10859'
    published_at: '2024-12-17 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10875'
    published_at: '2024-12-19 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10932'
    published_at: '2024-12-27 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.11287'
    published_at: '2025-01-16 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.09902'
    published_at: '2024-11-01 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10184'
    published_at: '2024-11-18 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10278'
    published_at: '2024-11-20 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10302'
    published_at: '2024-11-21 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10364'
    published_at: '2024-11-23 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00043'
    scoring_system: epss
    scoring_elements: '0.10366'
    published_at: '2024-11-24 00:00:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27766'
    published_at: '2025-04-16 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27727'
    published_at: '2025-04-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27732'
    published_at: '2025-04-27 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27753'
    published_at: '2025-04-26 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27775'
    published_at: '2025-04-25 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27763'
    published_at: '2025-04-24 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27769'
    published_at: '2025-04-23 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27765'
    published_at: '2025-04-22 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.2778'
    published_at: '2025-04-21 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27798'
    published_at: '2025-04-20 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27845'
    published_at: '2025-04-19 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27851'
    published_at: '2025-04-18 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27811'
    published_at: '2025-04-17 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00094'
    scoring_system: epss
    scoring_elements: '0.27705'
    published_at: '2025-04-15 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00099'
    scoring_system: epss
    scoring_elements: '0.16479'
    published_at: '2025-03-29 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00119'
    scoring_system: epss
    scoring_elements: '0.27675'
    published_at: '2025-03-28 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00119'
    scoring_system: epss
    scoring_elements: '0.2779'
    published_at: '2025-04-03 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00119'
    scoring_system: epss
    scoring_elements: '0.27776'
    published_at: '2025-04-02 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00119'
    scoring_system: epss
    scoring_elements: '0.27629'
    published_at: '2025-03-30 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00129'
    scoring_system: epss
    scoring_elements: '0.29234'
    published_at: '2025-04-08 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00129'
    scoring_system: epss
    scoring_elements: '0.29267'
    published_at: '2025-04-12 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00129'
    scoring_system: epss
    scoring_elements: '0.29296'
    published_at: '2025-04-10 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00129'
    scoring_system: epss
    scoring_elements: '0.29297'
    published_at: '2025-04-11 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00129'
    scoring_system: epss
    scoring_elements: '0.29252'
    published_at: '2025-04-13 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00129'
    scoring_system: epss
    scoring_elements: '0.29271'
    published_at: '2025-04-04 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00129'
    scoring_system: epss
    scoring_elements: '0.29306'
    published_at: '2025-04-05 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00129'
    scoring_system: epss
    scoring_elements: '0.29264'
    published_at: '2025-04-06 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00129'
    scoring_system: epss
    scoring_elements: '0.29228'
    published_at: '2025-04-07 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '0.00151'
    scoring_system: epss
    scoring_elements: '0.32529'
    published_at: '2025-04-14 12:55:00+00:00'
    url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
  - score: '5.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N
    published_at: None
    url: https://github.com/pocketbase/pocketbase
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/pocketbase/pocketbase
  - score: '5.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N
    published_at: None
    url: https://github.com/pocketbase/pocketbase/commit/58ace5d5e7b9b979490019cf8d1b88491e5daec5
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/pocketbase/pocketbase/commit/58ace5d5e7b9b979490019cf8d1b88491e5daec5
  - score: '5.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N
    published_at: None
    url: https://github.com/pocketbase/pocketbase/discussions/4355
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/pocketbase/pocketbase/discussions/4355
  - score: '5.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N
    published_at: None
    url: https://github.com/pocketbase/pocketbase/security/advisories/GHSA-m93w-4fxv-r35v
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://github.com/pocketbase/pocketbase/security/advisories/GHSA-m93w-4fxv-r35v
  - score: '5.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-38351
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-38351
weaknesses:
  - CWE-287
references:
  - url: https://api.first.org/data/v1/epss?cve=CVE-2024-38351
    reference_type:
    reference_id:
  - url: https://github.com/pocketbase/pocketbase
    reference_type:
    reference_id:
  - url: https://github.com/pocketbase/pocketbase/commit/58ace5d5e7b9b979490019cf8d1b88491e5daec5
    reference_type:
    reference_id:
  - url: https://github.com/pocketbase/pocketbase/discussions/4355
    reference_type:
    reference_id:
  - url: https://github.com/pocketbase/pocketbase/security/advisories/GHSA-m93w-4fxv-r35v
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-38351
    reference_type:
    reference_id:
